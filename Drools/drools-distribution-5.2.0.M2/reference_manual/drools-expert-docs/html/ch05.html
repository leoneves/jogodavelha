<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory">Chapter 5. The Rule Language</title><link rel="stylesheet" href="css/jbossorg.css" type="text/css"/><meta xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" name="generator" content="DocBook XSL-NS Stylesheets V1.74.0"/><link rel="home" href="index.html" title="Drools Expert User Guide"/><link rel="up" href="index.html" title="Drools Expert User Guide"/><link rel="prev" href="ch04.html" title="Chapter 4. User Guide"/><link rel="next" href="ch06.html" title="Chapter 6. Authoring"/></head><body><p xmlns:d="http://docbook.org/ns/docbook" id="title"><a href="http://www.jboss.org" class="site_href"><strong>JBoss.org</strong></a><a href="http://docs.jboss.org/" class="doc_href"><strong>Community Documentation</strong></a></p><ul xmlns:d="http://docbook.org/ns/docbook" class="docnav"><li class="previous"><a accesskey="p" href="ch04.html"><strong>Prev</strong></a></li><li class="next"><a accesskey="n" href="ch06.html"><strong>Next</strong></a></li></ul><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e2769"/>Chapter 5. The Rule Language</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="ch05.html#d0e2772">5.1. Overview</a></span></dt><dd><dl><dt><span class="section"><a href="ch05.html#d0e2780">5.1.1. A rule file</a></span></dt><dt><span class="section"><a href="ch05.html#d0e2813">5.1.2. What makes a rule</a></span></dt></dl></dd><dt><span class="section"><a href="ch05.html#d0e2849">5.2. Keywords</a></span></dt><dt><span class="section"><a href="ch05.html#d0e3062">5.3. Comments</a></span></dt><dd><dl><dt><span class="section"><a href="ch05.html#d0e3067">5.3.1. Single line comment</a></span></dt><dt><span class="section"><a href="ch05.html#d0e3080">5.3.2. Multi-line comment</a></span></dt></dl></dd><dt><span class="section"><a href="ch05.html#d0e3093">5.4. Error Messages</a></span></dt><dd><dl><dt><span class="section"><a href="ch05.html#d0e3102">5.4.1. Message format</a></span></dt><dt><span class="section"><a href="ch05.html#d0e3133">5.4.2. Error Messages Description</a></span></dt><dt><span class="section"><a href="ch05.html#d0e3288">5.4.3. Other Messages</a></span></dt></dl></dd><dt><span class="section"><a href="ch05.html#d0e3293">5.5. Package</a></span></dt><dd><dl><dt><span class="section"><a href="ch05.html#d0e3316">5.5.1. import</a></span></dt><dt><span class="section"><a href="ch05.html#d0e3330">5.5.2. global</a></span></dt></dl></dd><dt><span class="section"><a href="ch05.html#d0e3373">5.6. Function</a></span></dt><dt><span class="section"><a href="ch05.html#d0e3407">5.7. Type Declaration</a></span></dt><dd><dl><dt><span class="section"><a href="ch05.html#d0e3435">5.7.1. Declaring New Types</a></span></dt><dt><span class="section"><a href="ch05.html#d0e3541">5.7.2. Declaring Metadata</a></span></dt><dt><span class="section"><a href="ch05.html#d0e3612">5.7.3. Declaring Metadata for Existing Types</a></span></dt><dt><span class="section"><a href="ch05.html#d0e3655">5.7.4. Accessing Declared Types from the Application Code</a></span></dt></dl></dd><dt><span class="section"><a href="ch05.html#d0e3704">5.8. Rule</a></span></dt><dd><dl><dt><span class="section"><a href="ch05.html#d0e3746">5.8.1. Rule Attributes</a></span></dt><dt><span class="section"><a href="ch05.html#d0e3898">5.8.2. Timers and Calendars</a></span></dt><dt><span class="section"><a href="ch05.html#RuleLanguage-ConditionalElements">5.8.3. Left Hand Side (when) Conditional Elements</a></span></dt><dt><span class="section"><a href="ch05.html#d0e5321">5.8.4. The Right Hand Side (then)</a></span></dt><dt><span class="section"><a href="ch05.html#d0e5560">5.8.5. A Note on Auto-boxing and Primitive Types</a></span></dt></dl></dd><dt><span class="section"><a href="ch05.html#d0e5565">5.9. Query</a></span></dt><dt><span class="section"><a href="ch05.html#d0e5600">5.10. Domain Specific Languages</a></span></dt><dd><dl><dt><span class="section"><a href="ch05.html#d0e5610">5.10.1. When to Use a DSL</a></span></dt><dt><span class="section"><a href="ch05.html#d0e5617">5.10.2. DSL Basics</a></span></dt><dt><span class="section"><a href="ch05.html#d0e5687">5.10.3. Adding Constraints to Facts</a></span></dt><dt><span class="section"><a href="ch05.html#d0e5732">5.10.4. Developing a DSL</a></span></dt><dt><span class="section"><a href="ch05.html#d0e5745">5.10.5. DSL and DSLR Reference</a></span></dt></dl></dd><dt><span class="section"><a href="ch05.html#d0e5948">5.11. XML Rule Language</a></span></dt><dd><dl><dt><span class="section"><a href="ch05.html#d0e5957">5.11.1. When to use XML</a></span></dt><dt><span class="section"><a href="ch05.html#d0e5968">5.11.2. The XML format</a></span></dt><dt><span class="section"><a href="ch05.html#d0e6014">5.11.3. Legacy Drools 2.x XML rule format</a></span></dt><dt><span class="section"><a href="ch05.html#d0e6019">5.11.4. Automatic transforming between formats (XML and DRL)</a></span></dt></dl></dd></dl></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e2772"/>5.1. Overview</h2></div></div></div><p>Drools has a "native" rule language. 
  This format is very light in terms of punctuation, and supports
  natural and domain specific languages via "expanders" that allow the
  language to morph to your problem domain. This chapter is mostly concerted
  with this native rule format. The diagrams used to present the syntax are
  known as "railroad" diagrams, and they are basically flow charts for the
  language terms. The
  technically very keen may also refer to <code class="filename">DRL.g</code> which is 
  the Antlr3
  grammar for the rule language. If you use the Rule Workbench, a lot of the
  rule structure is done for you with content assistance, for example, type
  "ru" and press ctrl+space, and it will build the rule structure for
  you.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e2780"/>5.1.1. A rule file</h3></div></div></div><p>A rule file is typically a file with a .drl extension. In a DRL file
    you can have multiple rules, queries and functions, as well as some
    resource declarations like imports, globals and attributes that are
    assigned and used by your rules and queries. However, you are also able to
    spread your rules across multiple rule files (in that case, the extension
    .rule is suggested, but not required) - spreading rules across files can
    help with managing large numbers of rules. A DRL file is simply a text
    file.</p><p>The overall structure of a rule file is:</p><div class="example"><a id="d0e2787"/><p class="title"><b>Example 5.1. Rules file</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class=""><span xmlns="http://www.w3.org/1999/xhtml" class="bold"><strong>package </strong></span><em xmlns="http://www.w3.org/1999/xhtml" class="replaceable"><code>package-name</code></em>

<em xmlns="http://www.w3.org/1999/xhtml" class="replaceable"><code>imports</code></em>

<em xmlns="http://www.w3.org/1999/xhtml" class="replaceable"><code>globals</code></em>

<em xmlns="http://www.w3.org/1999/xhtml" class="replaceable"><code>functions</code></em>

<em xmlns="http://www.w3.org/1999/xhtml" class="replaceable"><code>queries</code></em>

<em xmlns="http://www.w3.org/1999/xhtml" class="replaceable"><code>rules</code></em>
</pre></div></div><br class="example-break"/><p>The order in which the elements are declared is not important,
    except for the package name that, if declared, must be the first element
    in the rules file. All elements are optional, so you will use only those
    you need. We will discuss each of them in the following sections.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e2813"/>5.1.2. What makes a rule</h3></div></div></div><p>For the inpatients, just as an early view, a rule has the following
    rough structure:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class=""><span xmlns="http://www.w3.org/1999/xhtml" class="bold"><strong>rule</strong></span> <em xmlns="http://www.w3.org/1999/xhtml" class="replaceable"><code>"name"</code></em>
    <em xmlns="http://www.w3.org/1999/xhtml" class="replaceable"><code>attributes</code></em>
    <span xmlns="http://www.w3.org/1999/xhtml" class="bold"><strong>when</strong></span>
        <em xmlns="http://www.w3.org/1999/xhtml" class="replaceable"><code>LHS</code></em>
    <span xmlns="http://www.w3.org/1999/xhtml" class="bold"><strong>then</strong></span>
        <em xmlns="http://www.w3.org/1999/xhtml" class="replaceable"><code>RHS</code></em>
<span xmlns="http://www.w3.org/1999/xhtml" class="bold"><strong>end</strong></span>
</pre><p>It's really that simple. Mostly punctuation is not needed,
    even the double quotes for "name" are optional, as are newlines.
    Attributes are simple (always optional) hints to how the rule should
    behave. LHS is the conditional parts of the rule, which follows a certain
    syntax which is covered below. RHS is basically a block that allows
    dialect specific semantic code to be executed.</p><p>It is important to note that white space is not important,
      <span class="emphasis"><em>except</em></span> in
    the case of domain specific languages, where lines are processed
    one by one and spaces may be significant to the domain language.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e2849"/>5.2. Keywords</h2></div></div></div><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>
        <em class="replaceable"><code>(updated to Drools 5.0)</code></em>
      </p></div><p>Drools 5 introduces the concept of <span class="emphasis"><em>hard</em></span> and
    <span class="emphasis"><em>soft</em></span> keywords.</p><p>Hard keywords are reserved, you cannot use any hard keyword when
    naming your domain objects, properties, methods, functions and other
    elements that are used in the rule text.</p><p>Here is the list of hard keywords that must be avoided as identifiers
    when writing rules:</p><div class="itemizedlist"><ul><li><p><code class="literal">true</code></p></li><li><p><code class="literal">false</code></p></li><li><p><code class="literal">accumulate</code></p></li><li><p><code class="literal">collect</code></p></li><li><p><code class="literal">from</code></p></li><li><p><code class="literal">null</code></p></li><li><p><code class="literal">over</code></p></li><li><p><code class="literal">then</code></p></li><li><p><code class="literal">when</code></p></li></ul></div><p>Soft keywords are just recognized in their context, enabling you to
    use these words in any other place you wish. Here is a list of the soft
    keywords:</p><div class="itemizedlist"><ul><li><p><code class="literal">lock-on-active</code></p></li><li><p><code class="literal">date-effective</code></p></li><li><p><code class="literal">date-expires</code></p></li><li><p><code class="literal">no-loop</code></p></li><li><p><code class="literal">auto-focus</code></p></li><li><p><code class="literal">activation-group</code></p></li><li><p><code class="literal">agenda-group</code></p></li><li><p><code class="literal">ruleflow-group</code></p></li><li><p><code class="literal">entry-point</code></p></li><li><p><code class="literal">duration</code></p></li><li><p><code class="literal">package</code></p></li><li><p><code class="literal">import</code></p></li><li><p><code class="literal">dialect</code></p></li><li><p><code class="literal">salience</code></p></li><li><p><code class="literal">enabled</code></p></li><li><p><code class="literal">attributes</code></p></li><li><p><code class="literal">rule</code></p></li><li><p><code class="literal">extend</code></p></li><li><p><code class="literal">template</code></p></li><li><p><code class="literal">query</code></p></li><li><p><code class="literal">declare</code></p></li><li><p><code class="literal">function</code></p></li><li><p><code class="literal">global</code></p></li><li><p><code class="literal">eval</code></p></li><li><p><code class="literal">not</code></p></li><li><p><code class="literal">in</code></p></li><li><p><code class="literal">or</code></p></li><li><p><code class="literal">and</code></p></li><li><p><code class="literal">exists</code></p></li><li><p><code class="literal">forall</code></p></li><li><p><code class="literal">action</code></p></li><li><p><code class="literal">reverse</code></p></li><li><p><code class="literal">result</code></p></li><li><p><code class="literal">end</code></p></li><li><p><code class="literal">init</code></p></li></ul></div><p>Of course, you can have these (hard and soft) words as part of a
    method name in camel case, like notSomething() or accumulateSomething() -
    there are no issues with that scenario.</p><p>Another improvement of the DRL language is the ability to escape hard
    keywords on rule text. This feature enables you to use your existing
    domain objects without worrying about keyword collision. To escape a word,
    simply enclose it in grave accents, like this:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Holiday( `when` == "july" )</pre><p>The escape should be used everywehere in rule text, except within code
    expressions in the LHS or RHS code block. Here are examples of proper
    usage:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">rule "validate holiday by eval" 
dialect "mvel"
when
    h1 : Holiday( )
    eval( h1.when == "july" )
then
    System.out.println(h1.name + ":" + h1.when);
end
</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">rule "validate holiday" 
dialect "mvel"
when
    h1 : Holiday( `when` == "july" )
then
    System.out.println(h1.name + ":" + h1.when);
end
</pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e3062"/>5.3. Comments</h2></div></div></div><p>Comments are sections of text that are ignored by the rule engine.
  They are stripped out when they are encountered, except inside semantic code
  blocks, like the RHS of a rule.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e3067"/>5.3.1. Single line comment</h3></div></div></div><div class="figure"><a id="d0e3070"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Rule_Language/single_line_comment.png" align="middle" alt="Single line comment"/></div></div><p class="title"><b>Figure 5.1. Single line comment</b></p></div><br class="figure-break"/><p>To create single line comments, you can use either '#' or '//'. The
    parser will ignore anything in the line after the comment symbol.
    Example:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">rule "Testing Comments"
when
    # this is a single line comment
    // this is also a single line comment
    eval( true ) # this is a comment in the same line of a pattern
then
    // this is a comment inside a semantic code block
    # this is another comment in a semantic code block
end
</pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e3080"/>5.3.2. Multi-line comment</h3></div></div></div><div class="figure"><a id="d0e3083"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Rule_Language/multi_line_comment.png" align="middle" alt="Multi-line comment"/></div></div><p class="title"><b>Figure 5.2. Multi-line comment</b></p></div><br class="figure-break"/><p>Multi-line comments are used to comment blocks of text, both in and
    outside semantic code blocks. Example:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">rule "Test Multi-line Comments"
when
    /* this is a multi-line comment
       in the left hand side of a rule */
    eval( true )
then
    /* and this is a multi-line comment
       in the right hand side of a rule */
end </pre></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e3093"/>5.4. Error Messages</h2></div></div></div><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p><em class="replaceable"><code>(updated to Drools 5.0)</code></em></p></div><p>Drools 5 introduces standardized error messages. This standardization
  aims to help users to find and resolve problems in a easier and faster way.
  In this section you will learn how to identify and interpret those error
  messages, and you will also receive some tips on how to solve the problems
  associated with them.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e3102"/>5.4.1. Message format</h3></div></div></div><p>The standardization includes the error message format and to better
    explain this format, let's use the following example:</p><div class="figure"><a id="d0e3107"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Rule_Language/error_message.png" align="middle" alt="Error Message Format"/></div></div><p class="title"><b>Figure 5.3. Error Message Format</b></p></div><br class="figure-break"/><p><span class="bold"><strong>1st Block:</strong></span> This area identifies the
    error code.</p><p><span class="bold"><strong>2nd Block:</strong></span> Line and column
    information.</p><p><span class="bold"><strong>3rd Block:</strong></span> Some text describing the
    problem.</p><p><span class="bold"><strong>4th Block:</strong></span> This is the first
    context. Usually indicates the rule, function, template or query where the
    error occurred. This block is not mandatory.</p><p><span class="bold"><strong>5th Block:</strong></span> Identifies the pattern
    where the error occurred. This block is not mandatory.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e3133"/>5.4.2. Error Messages Description</h3></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e3136"/>5.4.2.1. 101: No viable alternative</h4></div></div></div><p>Indicates the most common errors, where the parser came to a
      decision point but  couldn't identify an alternative. Here are some
      examples:</p><div class="example"><a id="d0e3141"/><p class="title"><b>Example 5.2. </b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">1: rule one
2:   when
3:     exists Foo()
4:     <span xmlns="http://www.w3.org/1999/xhtml" class="bold"><strong>exits</strong></span> Bar()
5:   then
6: end
</pre></div></div><br class="example-break"/><p>The above example generates this message:</p><div class="itemizedlist"><ul><li><p>[ERR 101] Line 4:4 no viable alternative at input 'exits' in
          rule one</p></li></ul></div><p>At first glance this seems to be valid syntax, but it is not (exits
      != exists). Let's take a look at next example:</p><div class="example"><a id="d0e3155"/><p class="title"><b>Example 5.3. </b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">1: package org.drools;
2: rule
3:   when
4:     Object()
5:   then
6:     System.out.println("A RHS");
7: end
</pre></div></div><br class="example-break"/><p>Now the above code generates this message:</p><div class="itemizedlist"><ul><li><p>[ERR 101] Line 3:2 no viable alternative at input
          'WHEN'</p></li></ul></div><p>This message means that the parser encountered the token
      <span class="bold"><strong>WHEN</strong></span>, actually a hard keyword, but
      it's in the wrong place since the the rule name is missing.</p><p>The error "no viable alternative" also occurs when you make
      a simple lexical mistake. Here is a sample of a lexical problem:</p><div class="example"><a id="d0e3171"/><p class="title"><b>Example 5.4. </b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">1: rule simple_rule
2:   when
3:     Student( name == "Andy )
4:   then
5: end
</pre></div></div><br class="example-break"/><p>The above code misses to close the quotes and because of this the
      parser generates this error message:</p><div class="itemizedlist"><ul><li><p>[ERR 101] Line 0:-1 no viable alternative at input
          '&lt;eof&gt;' in rule simple_rule in pattern Student</p></li></ul></div><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>Usually the Line and Column information are accurate, but in
        some cases (like unclosed quotes), the parser generates a 0:-1
        position. In this case you should check whether you didn't forget to close
        quotes, apostrophes or parentheses.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e3184"/>5.4.2.2. 102: Mismatched input</h4></div></div></div><p>This error indicates that the parser was looking for a particular
      symbol that it didn’t ﬁnd at the current input position. Here are some
      samples:</p><div class="example"><a id="d0e3189"/><p class="title"><b>Example 5.5. </b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">1: rule simple_rule
2:   when
3:     foo3 : Bar(
</pre></div></div><br class="example-break"/><p>The above example generates this message:</p><div class="itemizedlist"><ul><li><p>[ERR 102] Line 0:-1 mismatched input '&lt;eof&gt;' expecting
          ')' in rule simple_rule in pattern Bar</p></li></ul></div><p>To fix this problem, it is necessary to complete the rule
      statement.</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>Usually when you get a 0:-1 position, it means that parser
        reached the end of source.</p></div><p>The following code generates more than one error message:</p><div class="example"><a id="d0e3205"/><p class="title"><b>Example 5.6. </b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">1: package org.drools;
2:
3: rule "Avoid NPE on wrong syntax"
4:   when
5:     not( Cheese( ( type == "stilton", price == 10 ) || ( type == "brie", price == 15 ) ) from $cheeseList )
6:   then
7:     System.out.println("OK");
8: end
</pre></div></div><br class="example-break"/><p>These are the errors associated with this source:</p><div class="itemizedlist"><ul><li><p>[ERR 102] Line 5:36 mismatched input ',' expecting ')' in rule
          "Avoid NPE on wrong syntax" in pattern Cheese</p></li><li><p>[ERR 101] Line 5:57 no viable alternative at input 'type' in
          rule "Avoid NPE on wrong syntax"</p></li><li><p>[ERR 102] Line 5:106 mismatched input ')' expecting 'then' in
          rule "Avoid NPE on wrong syntax"</p></li></ul></div><p>Note that the second problem is related to the first. To fix it,
      just replace the commas (',') by AND operator ('&amp;&amp;').</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>In some situations you can get more than one error message. Try to
        fix one by one, starting at the first one. Some error messages are
        generated merely as consequences of other errors.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e3225"/>5.4.2.3. 103: Failed predicate</h4></div></div></div><p>A validating semantic predicate evaluated to false. Usually these
      semantic predicates are used to identify soft keywords. This sample
      shows exactly this situation:</p><div class="example"><a id="d0e3230"/><p class="title"><b>Example 5.7. </b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class=""> 1: package nesting;
 2: dialect "mvel"
 3:
 4: import org.drools.Person
 5: import org.drools.Address
 6: 
 7: <span xmlns="http://www.w3.org/1999/xhtml" class="bold"><strong>fdsfdsfds</strong></span>
 8: 
 9: rule "test something"
10:   when
11:     p: Person( name=="Michael" )
12:   then
13:     p.name = "other";
14:     System.out.println(p.name);
15: end
</pre></div></div><br class="example-break"/><p>With this sample, we get this error message:</p><div class="itemizedlist"><ul><li><p>[ERR 103] Line 7:0 rule 'rule_key' failed predicate:
          {(validateIdentifierKey(DroolsSoftKeywords.RULE))}? in rule</p></li></ul></div><p>The <span class="bold"><strong>fdsfdsfds</strong></span> text is invalid and
      the parser couldn’t identify it as the soft keyword <code class="literal">rule</code>.</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>This error is very similar to 102: Mismatched input, but usually
        involves soft keywords.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e3253"/>5.4.2.4. 104: Trailing semi-colon not allowed</h4></div></div></div><p>This error is associated with the <code class="literal">eval</code> clause, where its
      expression may not be terminated with a semicolon. Check this
  example:</p><div class="example"><a id="d0e3261"/><p class="title"><b>Example 5.8. </b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">1: rule simple_rule
2:   when
3:     eval(abc();)
4:   then
5: end
</pre></div></div><br class="example-break"/><p>Due to the trailing semicolon within eval, we get this error
      message:</p><div class="itemizedlist"><ul><li><p>[ERR 104] Line 3:4 trailing semi-colon not allowed in rule
          simple_rule</p></li></ul></div><p>This problem is simple to fix: just remove the
      semi-colon.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e3272"/>5.4.2.5. 105: Early Exit</h4></div></div></div><p>The recognizer came to a subrule in the grammar that must match an
      alternative at least once, but the subrule did not match anything.
      Simply put: the parser has entered a branch from where there is no
      way out. This example illustrates it:</p><div class="example"><a id="d0e3277"/><p class="title"><b>Example 5.9. </b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">1: template test_error
2:   aa s  11;
3: end
</pre></div></div><br class="example-break"/><p>This is the message associated to the above sample:</p><div class="itemizedlist"><ul><li><p>[ERR 105] Line 2:2 required (...)+ loop did not match anything
          at input 'aa' in template test_error</p></li></ul></div><p>To fix this problem it is necessary to remove the numeric value
      as it is neither a valid data type which might begin a new template
      slot nor a possible start for any other rule file construct.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e3288"/>5.4.3. Other Messages</h3></div></div></div><p>Any other message means that something bad has happened, so
    please contact the development team.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e3293"/>5.5. Package</h2></div></div></div><p>A package is a collection of rules and other related constructs, such
  as imports and globals. The package members are typically related to each
  other - perhaps HR rules, for instance. A package represents a namespace,
  which ideally is kept unique for a given grouping of rules. The package name
  itself is the namespace, and is not related to files or folders in any
  way.</p><p>It is possible to assemble rules from multiple rule sources, and have
  one top level package configuration that all the rules are kept under (when
  the rules are assembled). Although, it is not possible to merge into the
  same package resources declared under different names. A single Rulebase
  may, however, contain multiple packages built on it. A common structure is to
  have all the rules for a package in the same file as the package declaration
  (so that is it entirely self-contained).</p><p>The following railroad diagram shows all the components that may make
  up a package. Note that a package <span class="emphasis"><em>must</em></span> have a namespace and be declared
  using standard Java conventions for package names; i.e., no spaces, unlike
  rule names which allow spaces. In terms of the order of elements, they can
  appear in any order in the rule file, with the exception of the <code class="literal">package</code>
  statement, which must be at the top of the file. In all cases, the semicolons are
  optional.</p><div class="figure"><a id="d0e3308"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Rule_Language/package.png" align="middle" alt="package"/></div></div><p class="title"><b>Figure 5.4. package</b></p></div><br class="figure-break"/><p>Notice that any rule atttribute (as described the section Rule Attributes)
  may also be written at package level, superseding the attribute's default value.
  The modified default may still be replaced by an attribute setting within
  a rule.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e3316"/>5.5.1. import</h3></div></div></div><div class="figure"><a id="d0e3319"/><div class="figure-contents"><div class="mediaobject"><img src="images/Chapter-Rule_Language/import.png" alt="import"/></div></div><p class="title"><b>Figure 5.5. import</b></p></div><br class="figure-break"/><p>Import statements work like import statements in Java. You need to
    specify the fully qualified paths and type names for any objects you want
    to use in the rules. Drools automatically imports classes from the
    Java package of the same name, and also from the package
    <code class="code">java.lang</code>.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e3330"/>5.5.2. global</h3></div></div></div><div class="figure"><a id="d0e3333"/><div class="figure-contents"><div class="mediaobject"><img src="images/Chapter-Rule_Language/global.png" alt="global"/></div></div><p class="title"><b>Figure 5.6. global</b></p></div><br class="figure-break"/><p>With <code class="literal">global</code> you define global variables. They are used to make
    application objects available to the rules. Typically, they are used
    to provide data or services that the rules use, especially application
    services used in rule consequences, and to return data from the rules,
    like logs or values added in rule consequences, or for the rules to
    interact with the application, doing callbacks. Globals are not 
    inserted into the Working Memory, and therefore a global should never be
    used to establish conditions in rules except when it has a
    constant immutable value. The engine cannot be notified about value
    changes of globals and does not track their changes. Incorrect use
    of globals in constraints may yield surprising results - surprising
    in a bad way.</p><p>If multiple packages declare globals with the same identifier they
    must be of the same type and all of them will reference the same global
    value.</p><p>In order to use globals you must:</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>Declare your global variable in your rules file and use it in
        rules. Example:</p><pre xmlns="" class="">global java.util.List myGlobalList;

rule "Using a global"
when
    eval( true )
then
    myGlobalList.add( "Hello World" );
end
</pre></li><li><p>Set the global value on your working memory. It is a best
        practice to set all global values before asserting any fact to the
        working memory. Example:</p><pre xmlns="" class="JAVA"><!-- <br/> --><span class="java_type">List</span><!-- <br/> --><span class="java_plain">&nbsp;list&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">new</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">ArrayList</span><!-- <br/> --><span class="java_separator">();</span>
<!--  --><br/><span class="java_type">WorkingMemory</span><span class="java_plain">&nbsp;wm&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;rulebase</span><span class="java_separator">.</span><span class="java_plain">newStatefulSession</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">wm</span><span class="java_separator">.</span><span class="java_plain">setGlobal</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;myGlobalList&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;list&nbsp;</span><span class="java_separator">);</span>
</pre></li></ol></div><p>Note that these are just named instances of objects that you pass in
    from your application to the working memory. This means you can pass in
    any object you want: you could pass in a service locator, or perhaps a
    service itself. With the new <code class="literal">from</code> element it is now common to pass a
    Hibernate session as a global, to allow <code class="literal">from</code> to pull data from a named
    Hibernate query.</p><p>One example may be an instance of a Email service. In your
    integration code that is calling the rule engine, you obtain your
    emailService object, and then set it in the working memory. In the DRL,
    you declare that you have a global of type EmailService, and give it the
    name "email". Then in your rule consequences, you can use things like
    email.sendSMS(number, message).</p><p>Globals are not designed to share data between rules and they should
    never be used for that purpose. Rules always reason and react to the
    working memory state, so if you want to pass data from rule to rule, assert
    the data as facts into the working memory.</p><p>It is strongly discouraged to set or change a global value from
    inside your rules. We recommend to you always set the value from your
    application using the working memory interface.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e3373"/>5.6. Function</h2></div></div></div><div class="figure"><a id="d0e3376"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Rule_Language/function.png" align="middle" alt="function"/></div></div><p class="title"><b>Figure 5.7. function</b></p></div><br class="figure-break"/><p>Functions are a way to put semantic code in your rule source file, as
  opposed to in normal Java classes. They can't do anything more than what you
  can do with helper classes. (In fact, the compiler generates the helper class
  for you behind the scenes.) The main advantage of using functions in a rule
  is that you can keep the logic all in one place, and you can change the
  functions as needed (which can be a good or a bad thing). Functions are most
  useful for invoking actions on the consequence (<code class="literal">then</code>) part of a rule,
  especially if that particular action is used over and over again, perhaps
  with only differing parameters for each rule.</p><p>A typical function declaration looks like:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">function String hello(String name) {
    return "Hello "+name+"!";
}
</pre><p>Note that the <code class="literal">function</code> keyword is used, even though its not really
  part of Java. Parameters to the function are defined as for a method, and
  you don't have to have parameters if they are not needed. The return type
  is defined just like in a regular method.</p><p>Alternatively, you could use a static method in a helper class,
  e.g., <code class="code">Foo.hello()</code>. Drools supports the use of
  function imports, so all you would need to do is:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">import function my.package.Foo.hello</pre><p>Irrespective of the way the function is defined or imported, you
  use a function by calling it by its name, in the consequence or inside
  a semantic code block. Example:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">rule "using a static function"
when 
    eval( true )
then
    System.out.println( hello( "Bob" ) );
end
</pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e3407"/>5.7. Type Declaration</h2></div></div></div><div class="figure"><a id="d0e3410"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Rule_Language/meta_data.png" align="middle" alt="meta_data"/></div></div><p class="title"><b>Figure 5.8. meta_data</b></p></div><br class="figure-break"/><div class="figure"><a id="d0e3416"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Rule_Language/type_declaration.png" align="middle" alt="type_declaration"/></div></div><p class="title"><b>Figure 5.9. type_declaration</b></p></div><br class="figure-break"/><p>Type declarations have two main goals in the rules engine: to allow
  the declaration of new types, and to allow the declaration of metadata for
  types.</p><div class="itemizedlist"><ul><li><p><span class="bold"><strong>Declaring new types:</strong></span> Drools works
      out of the box with plain Java objects as facts. Sometimes, however, users
      may want to define the model directly to the rules engine, without
      worrying about creating models in a lower level language like Java. At
      other times, there is a domain model already built, but eventually the
      user wants or needs to complement this model with additional entities
      that are used mainly during the reasoning process.</p></li><li><p><span class="bold"><strong>Declaring metadata:</strong></span> facts may
      have meta information associated to them. Examples of meta information
      include any kind of data that is not represented by the fact attributes
      and is consistent among all instances of that fact type. This meta
      information may be queried at runtime by the engine and used in the
      reasoning process.</p></li></ul></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e3435"/>5.7.1. Declaring New Types</h3></div></div></div><p>To declare a new type, all you need to do is use the keyword
    <code class="literal">declare</code>, followed by the list of fields,  and the keyword
    <code class="literal">end</code>.</p><div class="example"><a id="d0e3446"/><p class="title"><b>Example 5.10. Declaring a new fact type: Address</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class=""><span xmlns="http://www.w3.org/1999/xhtml" class="bold"><strong>declare</strong></span> Address
   number : int
   streetName : String
   city : String
<span xmlns="http://www.w3.org/1999/xhtml" class="bold"><strong>end</strong></span>
</pre></div></div><br class="example-break"/><p>The previous example declares a new fact type called
    <code class="code">Address</code>. This fact type will have three attributes:
    <code class="code">number</code>, <code class="code">streetName</code> and <code class="code">city</code>.
    Each attribute has a type that can be any valid
    Java type, including any other class created by the user or even other
    fact types previously declared.</p><p>For instance, we may want to declare another fact type
    <code class="code">Person</code>:</p><div class="example"><a id="d0e3475"/><p class="title"><b>Example 5.11. declaring a new fact type: Person</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class=""><span xmlns="http://www.w3.org/1999/xhtml" class="bold"><strong>declare</strong></span> Person
    name : String
    dateOfBirth : java.util.Date
    address : Address
<span xmlns="http://www.w3.org/1999/xhtml" class="bold"><strong>end</strong></span>
</pre></div></div><br class="example-break"/><p>As we can see on the previous example,
    <code class="code">dateOfBirth</code> is of type <code class="code">java.util.Date</code>,
    from the Java API, while <code class="code">address</code> is of the previously
    defined fact type Address.</p><p>You may avoid having to write the fully qualified name of a class
    every time you write it by using the <code class="literal">import</code> clause, as previously
    discussed.</p><div class="example"><a id="d0e3501"/><p class="title"><b>Example 5.12. Avoiding the need to use fully qualified class names by using
        import</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class=""><span xmlns="http://www.w3.org/1999/xhtml" class="bold"><strong>import</strong></span> java.util.Date

<span xmlns="http://www.w3.org/1999/xhtml" class="bold"><strong>declare</strong></span> Person
    name : String
    dateOfBirth : Date
    address : Address
<span xmlns="http://www.w3.org/1999/xhtml" class="bold"><strong>end</strong></span></pre></div></div><br class="example-break"/><p>When you declare a new fact type, Drools will, at compile time,
    generate bytecode that implements a Java class representing the fact
    type. The
    generated Java class will be a one-to-one Java Bean mapping of the type
    definition. So, for the previous example, the generated Java class would
    be:</p><div class="example"><a id="d0e3515"/><p class="title"><b>Example 5.13. generated Java class for the previous Person fact type
        declaration</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">class</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Person</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">implements</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Serializable</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;java</span><span class="java_separator">.</span><span class="java_plain">util</span><span class="java_separator">.</span><span class="java_type">Date</span><span class="java_plain">&nbsp;dateOfBirth</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Address</span><span class="java_plain">&nbsp;address</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;getters&nbsp;and&nbsp;setters</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;equals</span><span class="java_operator">/</span><span class="java_plain">hashCode</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;toString</span>
<!--  --><br/><span class="java_separator">}</span>
</pre></div></div><br class="example-break"/><p>Since the generated class is a simple Java class, it can
      be used transparently in the rules, like any other fact.</p><div class="example"><a id="d0e3522"/><p class="title"><b>Example 5.14. Using the declared types in rules</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class=""><span xmlns="http://www.w3.org/1999/xhtml" class="bold"><strong>rule</strong></span> "Using a declared Type"
<span xmlns="http://www.w3.org/1999/xhtml" class="bold"><strong>when</strong></span> 
    $p : Person( name == "Bob" )
<span xmlns="http://www.w3.org/1999/xhtml" class="bold"><strong>then</strong></span>
    <span xmlns="http://www.w3.org/1999/xhtml" class="emphasis"><em>// Insert Mark, who is Bob's mate.</em></span>
    Person mark = new Person();
    mark.setName("Mark");
    insert( mark );
<span xmlns="http://www.w3.org/1999/xhtml" class="bold"><strong>end</strong></span>
</pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e3541"/>5.7.2. Declaring Metadata</h3></div></div></div><p>Metadata may be assigned to several different constructions in
    Drools: fact types, fact attributes and rules. Drools uses the
    at sign ('@') to introduce metadata, and it always uses the form:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">@<span xmlns="http://www.w3.org/1999/xhtml" class="emphasis"><em>metadata_key</em></span>( <span xmlns="http://www.w3.org/1999/xhtml" class="emphasis"><em>metadata_value</em></span> )</pre><p>The parenthesized <span class="emphasis"><em>metadata_value</em></span> is optional.</p><p>For instance, if you want to declare a metadata attribute like
    <code class="code">author</code>, whose value is <span class="emphasis"><em>Bob</em></span>, you
    could simply write:</p><div class="example"><a id="d0e3567"/><p class="title"><b>Example 5.15. Declaring a metadata attribute</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">@author( Bob )</pre></div></div><br class="example-break"/><p>Drools allows the declaration of any arbitrary metadata attribute,
    but some will have special meaning to the engine, while others are simply
    available for querying at runtime. Drools allows the declaration of
    metadata both for fact types and for fact attributes. Any metadata that is
    declared before the fields of a fact type are assigned to the fact type,
    while metadata declared after an attribute are assigned to that
    particular attribute.</p><div class="example"><a id="d0e3574"/><p class="title"><b>Example 5.16. Declaring metadata attributes for fact types and
      attributes</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class=""><span xmlns="http://www.w3.org/1999/xhtml" class="bold"><strong>import</strong></span> java.util.Date

<span xmlns="http://www.w3.org/1999/xhtml" class="bold"><strong>declare</strong></span> Person
    <span xmlns="http://www.w3.org/1999/xhtml" class="emphasis"><em>@author</em></span>( Bob )
    <span xmlns="http://www.w3.org/1999/xhtml" class="emphasis"><em>@dateOfCreation</em></span>( 01-Feb-2009 )

    name : String <span xmlns="http://www.w3.org/1999/xhtml" class="emphasis"><em>@key @maxLength</em></span>( 30 )
    dateOfBirth : Date 
    address : Address
<span xmlns="http://www.w3.org/1999/xhtml" class="bold"><strong>end</strong></span></pre></div></div><br class="example-break"/><p>In the previous example, there are two metadata items declared for the
    fact type (<code class="code">@author</code> and <code class="code">@dateOfCreation</code>) and two 
    more defined for the name attribute (<code class="code">@key</code> and
    <code class="code">@maxLength</code>). Please note that the <code class="code">@key</code> metadata
    has no value, and so the parentheses and the value were omitted.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e3612"/>5.7.3. Declaring Metadata for Existing Types</h3></div></div></div><p>Drools allows the declaration of metadata attributes for existing
    types in the same way as when declaring metadata attributes for new fact
    types. The only difference is that there are no fields in that
    declaration.</p><p>For instance, if there is a class org.drools.examples.Person, and
    one wants to declare metadata for it, it's possible to write the following
    code:</p><div class="example"><a id="d0e3619"/><p class="title"><b>Example 5.17. Declaring metadata for an existing type</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class=""><span xmlns="http://www.w3.org/1999/xhtml" class="bold"><strong>import</strong></span> org.drools.examples.Person

<span xmlns="http://www.w3.org/1999/xhtml" class="bold"><strong>declare</strong></span> Person
    <span xmlns="http://www.w3.org/1999/xhtml" class="emphasis"><em>@author</em></span>( Bob )
    <span xmlns="http://www.w3.org/1999/xhtml" class="emphasis"><em>@dateOfCreation</em></span>( 01-Feb-2009 )
<span xmlns="http://www.w3.org/1999/xhtml" class="bold"><strong>end</strong></span>
</pre></div></div><br class="example-break"/><p>Instead of using the import, it is also possible to reference the
    class by its fully qualified name, but since the class will also be
    referenced in the rules, it is usually shorter to add the import and use
    the short class name everywhere.</p><div class="example"><a id="d0e3640"/><p class="title"><b>Example 5.18. Declaring metadata using the fully qualified class name</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class=""><span xmlns="http://www.w3.org/1999/xhtml" class="bold"><strong>declare</strong></span> org.drools.examples.Person
    <span xmlns="http://www.w3.org/1999/xhtml" class="emphasis"><em>@author</em></span>( Bob )
    <span xmlns="http://www.w3.org/1999/xhtml" class="emphasis"><em>@dateOfCreation</em></span>( 01-Feb-2009 )
<span xmlns="http://www.w3.org/1999/xhtml" class="bold"><strong>end</strong></span></pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e3655"/>5.7.4. Accessing Declared Types from the Application Code</h3></div></div></div><p>Declared types are usually used inside rules files, while Java
    models are used when sharing the model between rules and applications.
    Although, sometimes, the application may need to access and handle facts
    from the declared types, especially when the application is wrapping the
    rules engine and providing higher level, domain specific user interfaces
    for rules management.</p><p>In such cases, the generated classes can be handled as usual with
    the Java Reflection API, but, as we know, that usually requires a lot of
    work for small results. Therefore, Drools provides a simplified API for the
    most common fact handling the application may want to do.</p><p>The first important thing to realize is that a declared fact will
    belong to the package where it was declared. So, for instance, in the
    example below, <code class="code">Person</code> will belong to the
    <code class="code">org.drools.examples</code> package, and so the
    fully qualified name of the generated class will be
    <code class="code">org.drools.examples.Person</code>.</p><div class="example"><a id="d0e3673"/><p class="title"><b>Example 5.19. Declaring a type in the org.drools.examples package</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class=""><span xmlns="http://www.w3.org/1999/xhtml" class="bold"><strong>package</strong></span> org.drools.examples

<span xmlns="http://www.w3.org/1999/xhtml" class="bold"><strong>import</strong></span> java.util.Date

<span xmlns="http://www.w3.org/1999/xhtml" class="bold"><strong>declare</strong></span> Person
    name : String
    dateOfBirth : Date
    address : Address
<span xmlns="http://www.w3.org/1999/xhtml" class="bold"><strong>end</strong></span></pre></div></div><br class="example-break"/><p>Declared types, as discussed previously, are generated at knowledge
    base compilation time, i.e., the application will only have access to them
    at application run time. Therefore, these classes are not available for
    direct reference from the application.</p><p>Drools then provides an interface through which users can handle
    declared types from the application code:
    <code class="code">org.drools.definition.type.FactType</code>. Through this interface, the user can
    instantiate, read and write fields in the declared fact types.</p><div class="example"><a id="d0e3695"/><p class="title"><b>Example 5.20. Handling declared fact types through the API</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// get a reference to a knowledge base with a declared type:
KnowledgeBase kbase = ...

// get the declared FactType
FactType personType = kbase.getFactType( "org.drools.examples",
                                         "Person" );

// handle the type as necessary:
// create instances:
Object bob = personType.newInstance();

// set attributes values
personType.set( bob,
                "name",
                "Bob" );
personType.set( bob,
                "age",
                42 );

// insert fact into a session
StatefulKnowledgeSession ksession = ...
ksession.insert( bob );
ksession.fireAllRules();

// read attributes
String name = personType.get( bob, "name" );
int age = personType.get( bob, "age" );

</pre></div></div><br class="example-break"/><p>The API also includes other helpful methods, like setting all the
    attributes at once, reading values from a Map, or reading all attributes at
    once, into a Map.</p><p>Although the API is similar to Java reflection (yet much simpler to
    use), it does not use reflection underneath, relying on much more
    performant accessors implemented in generated bytecode.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e3704"/>5.8. Rule</h2></div></div></div><div class="figure"><a id="d0e3707"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Rule_Language/rule.png" align="middle" alt="rule"/></div></div><p class="title"><b>Figure 5.10. rule</b></p></div><br class="figure-break"/><p>A rule specifies that <span class="emphasis"><em>when</em></span> a particular set of
  conditions occur, specified in the Left Hand Side (LHS),
  <span class="emphasis"><em>then</em></span> do what is specified as a list of actions in the
  Right Hand Side (RHS). A common question from users is "Why use when instead
  of if?" "When" was chosen over "if" because "if" is normally part of a
  procedural execution flow, where, at a specific point in time, a condition
  is to be checked. In contrast, "when" indicates that the condition
  evaluation is not tied to a specific evaluation sequence or point in time,
  but that it happens continually, at any time during the life time of the
  engine; whenever the condition is met, the actions are executed.</p><p>A rule must have a name, unique within its rule package. If you define
  a rule twice in the same DRL it produces an error while loading. If you add
  a DRL that includes a rule name already in the package, it replaces the
  previous rule. If a rule name is to have spaces, then it will need to be
  enclosd in double quotes (it is best to always use double quotes).</p><p>Attributes - described below - are optional. They are best written one
  per line.</p><p>The LHS of the rule follows the <code class="literal">when</code> keyword
  (ideally on a new line), similarly the RHS follows the
  <code class="literal">then</code> keyword (again, ideally on a newline). The rule is
  terminated by the keyword <code class="literal">end</code>. Rules cannot be
  nested.</p><div class="example"><a id="d0e3736"/><p class="title"><b>Example 5.21. Rule Syntax Overview</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">rule "&lt;name&gt;"
    &lt;attribute&gt;*
when
    &lt;conditional element&gt;*
then
    &lt;action&gt;*
end</pre></div></div><br class="example-break"/><div class="example"><a id="d0e3741"/><p class="title"><b>Example 5.22. A simple rule</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">rule "Approve if not rejected"
  salience -100 
  agenda-group "approval"
    when
        not Rejection() 
        p : Policy(approved == false, policyState:status)
        exists Driver(age &gt; 25)
        Process(status == policyState)
    then
        log("APPROVED: due to no objections."); 
        p.setApproved(true);
end</pre></div></div><br class="example-break"/><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e3746"/>5.8.1. Rule Attributes</h3></div></div></div><p>Rule attributes provide a declarative way to influence the behavior
    of the rule. Some are quite simple, while others are part of complex
    subsystems such as ruleflow. To get the most from Drools you should make
    sure you have a proper understanding of each attribute.</p><div class="figure"><a id="d0e3751"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Rule_Language/rule_attributes.png" align="middle" alt="rule attributes"/></div></div><p class="title"><b>Figure 5.11. rule attributes</b></p></div><br class="figure-break"/><div class="variablelist"><dl><dt><span class="term"><code class="literal">no-loop</code></span></dt><dd><p>default value: false</p><p>type: Boolean</p><p>When the rule's consequence modifies a fact it may cause the
          Rule to activate again, causing recursion. Setting no-loop to true
          means the attempt to create the Activation for the current set of
          data will be ignored.</p></dd><dt><span class="term"><code class="literal">ruleflow-group</code></span></dt><dd><p>default value: N/A</p><p>type: String</p><p>Ruleflow is a Drools feature that lets you exercise control
          over the firing of rules. Rules that are assembled by the same
          ruleflow-group identifier fire only when their group is
          active.</p></dd><dt><span class="term"><code class="literal">lock-on-active</code></span></dt><dd><p>default value: false</p><p>type: Boolean</p><p>Whenever a ruleflow-group becomes active or an agenda-group
          receives the focus, any rule within that group that has
          lock-on-active set to true will not be activated any more;
          irrespective of the origin of the update, the activation of a
          matching rule is discarded. This is a stronger version of no-loop,
          because the change could now be caused not only by the rule itself.
          It's ideal for calculation rules where you have a number of rules
          that modify a fact and you don't want any rule re-matching and
          firing again. Only when the ruleflow-group is no longer active or
          the agenda-group loses the focus those rules with lock-on-active set
          to true become eligible again for their activations to be placed
          onto the agenda.</p></dd><dt><span class="term"><code class="literal">salience</code></span></dt><dd><p>default value: 0</p><p>type: integer</p><p>Each rule has a salience attribute that can be assigned an
          integer number, which defaults to zero and can be negative or
          positive. Salience is a form of priority where rules with higher
          salience values are given higher priority when ordered in the
          Activation queue.</p><p>Drools also supports dynamic salience where you can use
          an expression involving bound variables.</p><div class="example"><a id="d0e3804"/><p class="title"><b>Example 5.23. Dynamic Salience</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">rule "Fire in rank order 1,2,.."
          salience( -$rank )
          when
              Element( $rank : rank,... )
          then
              ...
        end</pre></div></div><br class="example-break"/></dd><dt><span class="term"><code class="literal">agenda-group</code></span></dt><dd><p>default value: MAIN</p><p>type: String</p><p>Agenda groups allow the user to partition the Agenda providing
          more execution control. Only rules in the agenda group that has
          acquired the focus are allowed to fire.</p></dd><dt><span class="term"><code class="literal">auto-focus</code></span></dt><dd><p>default value: false</p><p>type: Boolean</p><p>When a rule is activated where the <code class="code">auto-focus</code>
          value is true and the rule's agenda group does not have focus yet,
          then it is given focus, allowing the rule to potentially
          fire.</p></dd><dt><span class="term"><code class="literal">activation-group</code></span></dt><dd><p>default value: N/A</p><p>type: String</p><p>Rules that belong to the same activation-group, identified by
          this attribute's string value, will only fire exclusively. In other
          words, the first rule in an activation-group to fire will cancel the
          other rules' activations, i.e., stop them from firing.</p><p>Note: This used to be called Xor group, but technically it's
          not quite an Xor. You may still hear people mention Xor group; just
          swap that term in your mind with activation-group.</p></dd><dt><span class="term"><code class="literal">dialect</code></span></dt><dd><p>default value: as specified by the package</p><p>type: String</p><p>possible values: "java" or "mvel"</p><p>The dialect species the language to be used for any code
          expressions in the LHS or the RHS code block. Currently two dialects
          are available, Java and MVEL. While the dialect can be specified at
          the package level, this attribute allows the package definition to
          be overridden for a rule.</p></dd><dt><span class="term"><code class="literal">date-effective</code></span></dt><dd><p>default value: N/A</p><p>type: String, containing a date and time definition</p><p>A rule can only activate if the current date and time is after
          date-effective attribute.</p></dd><dt><span class="term"><code class="literal">date-expires</code></span></dt><dd><p>default value: N/A</p><p>type: String, containing a date and time definition</p><p>A rule cannot activate if the current date and time is after
          the date-expires attribute.</p></dd><dt><span class="term"><code class="literal">duration</code></span></dt><dd><p>default value: no default value</p><p>type: long</p><p>The duration dictates that the rule will fire after a
          specified duration, if it is still true.</p></dd></dl></div><div class="example"><a id="d0e3893"/><p class="title"><b>Example 5.24. Some attribute examples</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">rule "my rule"
  salience 42
  agenda-group "number 1"
    when ...
</pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e3898"/>5.8.2. Timers and Calendars</h3></div></div></div><p>Rule's now suport both interval and cron based timers, which replace
    the now deprecated duration attribute.</p><div class="example"><a id="d0e3903"/><p class="title"><b>Example 5.25. Sample timer attribute uses</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">timer&nbsp;</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">int</span><!-- <br/> --><span class="java_operator">:</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_operator">&lt;</span><!-- <br/> --><span class="java_plain">initial&nbsp;delay</span><!-- <br/> --><span class="java_operator">&gt;</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_operator">&lt;</span><!-- <br/> --><span class="java_plain">repeat&nbsp;interval</span><!-- <br/> --><span class="java_operator">&gt;?</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">timer&nbsp;</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_operator">:</span><span class="java_plain">&nbsp;</span><span class="java_literal">30</span><span class="java_plain">s&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">timer&nbsp;</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_operator">:</span><span class="java_plain">&nbsp;</span><span class="java_literal">30</span><span class="java_plain">s&nbsp;</span><span class="java_literal">5</span><span class="java_plain">m&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">timer&nbsp;</span><span class="java_separator">(</span><span class="java_plain">&nbsp;cron</span><span class="java_operator">:</span><span class="java_plain">&nbsp;</span><span class="java_operator">&lt;</span><span class="java_plain">cron&nbsp;expression</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">timer&nbsp;</span><span class="java_separator">(</span><span class="java_plain">&nbsp;cron</span><span class="java_operator">:*</span><span class="java_plain">&nbsp;</span><span class="java_literal">0</span><span class="java_operator">/</span><span class="java_literal">15</span><span class="java_plain">&nbsp;</span><span class="java_operator">*</span><span class="java_plain">&nbsp;</span><span class="java_operator">*</span><span class="java_plain">&nbsp;</span><span class="java_operator">*</span><span class="java_plain">&nbsp;</span><span class="java_operator">?</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span></pre></div></div><br class="example-break"/><p>Interval "int:" timers follow the JDK semantics for initial delay
    optionally followed by a repeat interval. Cron "cron:" timers follow
    standard cron expressions:</p><div class="example"><a id="d0e3910"/><p class="title"><b>Example 5.26. A Cron Example</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">rule&nbsp;</span><!-- <br/> --><span class="java_literal">&quot;Send&nbsp;SMS&nbsp;every&nbsp;15&nbsp;minutes&quot;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;timer&nbsp;</span><span class="java_separator">(</span><span class="java_plain">cron</span><span class="java_operator">:*</span><span class="java_plain">&nbsp;</span><span class="java_literal">0</span><span class="java_operator">/</span><span class="java_literal">15</span><span class="java_plain">&nbsp;</span><span class="java_operator">*</span><span class="java_plain">&nbsp;</span><span class="java_operator">*</span><span class="java_plain">&nbsp;</span><span class="java_operator">*</span><span class="java_plain">&nbsp;</span><span class="java_operator">?</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">when</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;$a&nbsp;</span><span class="java_operator">:</span><span class="java_plain">&nbsp;</span><span class="java_type">Alarm</span><span class="java_separator">(</span><span class="java_plain">&nbsp;on&nbsp;</span><span class="java_operator">==</span><span class="java_plain">&nbsp;</span><span class="java_literal">true</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">then</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;channels</span><span class="java_separator">[</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;sms&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">].</span><span class="java_plain">insert</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">Sms</span><span class="java_separator">(</span><span class="java_plain">&nbsp;$a</span><span class="java_separator">.</span><span class="java_plain">mobileNumber</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;The&nbsp;alarm&nbsp;is&nbsp;still&nbsp;on&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">end</span></pre></div></div><br class="example-break"/><p>Calendars may now be used to control when rules can fire. The Calendar API is
    modelled on <a class="link" href="http://www.quartz-scheduler.org/" target="">Quartz
    http://www.quartz-scheduler.org/</a> :</p><div class="example"><a id="d0e3920"/><p class="title"><b>Example 5.27. Adapting a Quartz Calendar</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">Calendar</span><!-- <br/> --><span class="java_plain">&nbsp;weekDayCal&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">QuartzHelper</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">quartzCalendarAdapter</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">org</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">quartz</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_type">Calendar</span><!-- <br/> --><span class="java_plain">&nbsp;quartzCal</span><!-- <br/> --><span class="java_separator">)</span></pre></div></div><br class="example-break"/><p>Calendars are registered with the StatefulKnowledgeSession:</p><div class="example"><a id="d0e3927"/><p class="title"><b>Example 5.28. Registering a Calendar</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">ksession</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">getCalendars</span><!-- <br/> --><span class="java_separator">().</span><!-- <br/> --><span class="java_plain">set</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_literal">&quot;week&nbsp;day&quot;</span><!-- <br/> --><span class="java_separator">,</span><!-- <br/> --><span class="java_plain">&nbsp;weekDayCal&nbsp;</span><!-- <br/> --><span class="java_separator">);</span></pre></div></div><br class="example-break"/><p>They can be used in conjunction with normal rules and rules
    including timers. The rule calendar attribute can have one or more comma
    calendar names.</p><div class="example"><a id="d0e3934"/><p class="title"><b>Example 5.29. Using Calendars and Timers together</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">rule&nbsp;</span><!-- <br/> --><span class="java_literal">&quot;weekdays&nbsp;are&nbsp;high&nbsp;priority&quot;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;calendars&nbsp;</span><span class="java_literal">&quot;weekday&quot;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;timer&nbsp;</span><span class="java_separator">(</span><span class="java_type">int</span><span class="java_operator">:</span><span class="java_literal">0</span><span class="java_plain">&nbsp;</span><span class="java_literal">1</span><span class="java_plain">h</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">when&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Alarm</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">then</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;send</span><span class="java_separator">(</span><span class="java_plain">&nbsp;&quot;priority&nbsp;high&nbsp;</span><span class="java_operator">-</span><span class="java_plain">&nbsp;we&nbsp;have&nbsp;an&nbsp;alarm&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">end&nbsp;</span>
</span>
<!--  --><br/><span class="java_plain">rule&nbsp;</span><span class="java_literal">&quot;weekend&nbsp;are&nbsp;low&nbsp;priority&quot;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;calendars&nbsp;</span><span class="java_literal">&quot;weekend&quot;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;timer&nbsp;</span><span class="java_separator">(</span><span class="java_type">int</span><span class="java_operator">:</span><span class="java_literal">0</span><span class="java_plain">&nbsp;</span><span class="java_literal">4</span><span class="java_plain">h</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">when&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Alarm</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">then</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;send</span><span class="java_separator">(</span><span class="java_plain">&nbsp;&quot;priority&nbsp;low&nbsp;</span><span class="java_operator">-</span><span class="java_plain">&nbsp;we&nbsp;have&nbsp;an&nbsp;alarm&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">end</span></pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="RuleLanguage-ConditionalElements"/>5.8.3. Left Hand Side (when) Conditional Elements</h3></div></div></div><p>The Left Hand Side (LHS) is a common name for the conditional part
    of the rule. It consists of zero or more Conditional Elements. If the LHS
    is left empty, it is re-written as <code class="code">eval(true)</code>, which means
    that the rule's condition is always true. It will be activated, once, when
    a new Working Memory session is created.</p><div class="figure"><a id="d0e3947"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Rule_Language/lhs.png" align="middle" alt="Left Hand Side"/></div></div><p class="title"><b>Figure 5.12. Left Hand Side</b></p></div><br class="figure-break"/><div class="example"><a id="d0e3953"/><p class="title"><b>Example 5.30. Rule without a Conditional Element</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">rule "no CEs"
when
then
    &lt;action&gt;*
end

# The above rule is internally rewritten as:

rule "eval(true)"
when
    eval( true )
then
    &lt;action&gt;*
end</pre></div></div><br class="example-break"/><p>Conditional elements work on one or more
    <span class="emphasis"><em>patterns</em></span> (which are described below). The most common
    one is <code class="literal">and</code>, which is implicit when you have multiple
    patterns in the LHS of a rule that are not connected in any way. Note that
    an <code class="literal">and</code> cannot have a leading declaration binding like
    <code class="literal">or</code>. This is obvious, since a declaration can only
    reference a single fact, and when the <code class="literal">and</code> is satisfied
    it matches more than one fact - so which fact would the declaration bind
    to?</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e3975"/>5.8.3.1. Pattern</h4></div></div></div><p>The pattern element is the most important Conditional Element. The
      entity relationship diagram below provides an overview of the various
      parts that make up the pattern's constraints and how they work together;
      each is then covered in more detail with railroad diagrams and
      examples.</p><div class="figure"><a id="d0e3980"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Rule_Language/patternER.png" align="middle" alt="Pattern Entity Relationship Diagram"/></div></div><p class="title"><b>Figure 5.13. Pattern Entity Relationship Diagram</b></p></div><br class="figure-break"/><p>At the top of the ER diagram you can see that the pattern consists
      of zero or more constraints and has an optional pattern binding. The
      railroad diagram below shows the syntax for this.</p><div class="figure"><a id="d0e3988"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Rule_Language/pattern.png" align="middle" alt="Pattern"/></div></div><p class="title"><b>Figure 5.14. Pattern</b></p></div><br class="figure-break"/><p>In its simplest form, with no constraints, a pattern matches
      against a fact of the given type. In the following case the type is
      <code class="code">Cheese</code>, which means that the pattern will match against all
      <code class="code">Cheese</code> objects in the Working Memory.</p><p>Notice that the type need not be the actual class of some fact
      object. Patterns may refer to superclasses or even interfaces, thereby
      potentially matching facts from many different classes.</p><div class="example"><a id="d0e4004"/><p class="title"><b>Example 5.31. Simple Pattern</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Cheese()</pre></div></div><br class="example-break"/><p>For referring to the matched object, use a pattern binding
      variable such as <code class="code">$c</code>. The prefixed dollar symbol ('$') is
      optional; it can be useful in complex rules where it helps to more
      easily differentiate between variables and fields.</p><div class="example"><a id="d0e4014"/><p class="title"><b>Example 5.32. Pattern with a binding variable</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">$c : Cheese()</pre></div></div><br class="example-break"/><p>Inside of the pattern parenthesis is where all the action happens.
      A constraint can be either a Field Constraint, Inline Eval, or a
      Constraint Group. Constraints can be separated by the following symbols:
      ',', '&amp;&amp;' or '||'.</p><div class="figure"><a id="d0e4021"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Rule_Language/constraints.png" align="middle" alt="Constraints"/></div></div><p class="title"><b>Figure 5.15. Constraints</b></p></div><br class="figure-break"/><div class="figure"><a id="d0e4027"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Rule_Language/constraint.png" align="middle" alt="Constraint"/></div></div><p class="title"><b>Figure 5.16. Constraint</b></p></div><br class="figure-break"/><div class="figure"><a id="d0e4033"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Rule_Language/constraintGroup.png" align="middle" alt="constraintGroup"/></div></div><p class="title"><b>Figure 5.17. constraintGroup</b></p></div><br class="figure-break"/><p>The comma character (',') is used to separate constraint groups.
      It has implicit and connective semantics.</p><div class="example"><a id="d0e4041"/><p class="title"><b>Example 5.33. Constraint Group connective ','</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class=""># Cheese type is stilton and price &lt; 10 and age is mature.
Cheese( type == "stilton", price &lt; 10, age == "mature" )</pre></div></div><p><br class="example-break"/>The above example has three constraint groups, each with a
      single constraint:</p><div class="itemizedlist"><ul><li><p>Group 1 - <code class="code">type == "stilton"</code> requires that the
          type is stilton.</p></li><li><p>Group 2 - <code class="code">price &lt; 10</code> demands a price less than
          10.</p></li><li><p>Group 3 - <code class="code">age == "mature"</code> accepts only mature
          cheese.</p></li></ul></div><p>The '&amp;&amp;' (and) and '||' (or) constraint connectives allow
      constraint groups to have multiple constraints. Example:</p><div class="example"><a id="d0e4068"/><p class="title"><b>Example 5.34. &amp;&amp; and || Constraint Connectives</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// Cheese type is "stilton" and price &lt; 10, and age is mature
Cheese( type == "stilton" &amp;&amp; price &lt; 10, age == "mature" )
// Cheese type is "stilton" or price &lt; 10, and age is mature
Cheese( type == "stilton" || price &lt; 10, age == "mature" )</pre></div></div><br class="example-break"/><p>The above example has two constraint groups. The first has two
      constraints and the second has one constraint.</p><p>The connectives are evaluated in the following order, from first
      to last:</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>&amp;&amp;</p></li><li><p>||</p></li><li><p>,</p></li></ol></div><p>It is possible to change the evaluation priority by using
      parentheses, as in any logic or mathematical expression. Example:</p><div class="example"><a id="d0e4089"/><p class="title"><b>Example 5.35. Using parentheses to change evaluation priority</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class=""># Cheese type is stilton and ( price is less than 20 or age is mature ).
Cheese( type == "stilton" &amp;&amp; ( price &lt; 20 || age == "mature" ) ) </pre></div></div><br class="example-break"/><p>In the above example, the use of parentheses evaluates the
      connective '||' before the connective '&amp;&amp;'.</p><p>Also, it is important to note that besides having the same
      semantics, the connectives '&amp;&amp;' and ',' are resolved with
      different priorities, and ',' cannot be embedded in a composite
      constraint expression.</p><div class="example"><a id="d0e4098"/><p class="title"><b>Example 5.36. Not Equivalent connectives</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// invalid as ',' cannot be embedded in an expression:
Cheese( ( type == "stilton", price &lt; 10 ) || age == "mature" )
// valid as '&amp;&amp;' can be embedded in an expression:
Cheese( ( type == "stilton" &amp;&amp; price &lt; 10 ) || age == "mature")</pre></div></div><br class="example-break"/><div class="section" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="d0e4103"/>5.8.3.1.1. Field Constraints</h5></div></div></div><p>A Field constraint specifies a restriction to be used on a named
        field; the field name can have an optional variable binding.</p><div class="figure"><a id="d0e4108"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Rule_Language/fieldConstraint.png" align="middle" alt="fieldConstraint"/></div></div><p class="title"><b>Figure 5.18. fieldConstraint</b></p></div><br class="figure-break"/><p>There are three types of restrictions: Single Value Restriction,
        Compound Value Restriction, and Multi Restriction.</p><div class="figure"><a id="d0e4116"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Rule_Language/restriction.png" align="middle" alt="restriction"/></div></div><p class="title"><b>Figure 5.19. restriction</b></p></div><br class="figure-break"/><div class="section" lang="en-US"><div class="titlepage"><div><div><h6 class="title"><a id="d0e4122"/>5.8.3.1.1.1. JavaBeans as facts</h6></div></div></div><p>A field is derived from an accessible method of the object. If
          your model objects follow the Java Bean pattern, then fields are
          exposed using "getXXX" or "isXXX" methods, where these methods take
          no arguments, and return something. Within patterns, fields can be
          accessed using the bean naming convention, so that "getType" would
          be accessed as "type". Drools uses the standard JDK Introspector
          class to do this mapping.</p><p>For example, referring to our Cheese class, the pattern
          <code class="code">Cheese(type == "brie")</code> applies the getType() method to
          a Cheese instance. If a field name cannot be found, the compiler
          will resort to using the name as a method without arguments. Thus,
          the method <code class="code">toString()</code> is called due to a constraint
          <code class="code">Cheese(toString == "cheddar")</code>. In this case, you use
          the full name of the method with correct capitalization, but still
          without parentheses. Do please make sure that you are accessing
          methods that take no parameters, and that are in fact
          <span class="emphasis"><em>accessors</em></span> which don't change the state of the
          object in a way that may effect the rules. Remember that the rule
          engine effectively caches the results of its matching in between
          invocations to make it faster.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h6 class="title"><a id="d0e4141"/>5.8.3.1.1.2. Values</h6></div></div></div><p>The field constraints can take a number of values; including
          literal, qualifiedIdentifier (enum), variable and
          returnValue.</p><div class="figure"><a id="d0e4146"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Rule_Language/literal.png" align="middle" alt="literal"/></div></div><p class="title"><b>Figure 5.20. literal</b></p></div><br class="figure-break"/><div class="figure"><a id="d0e4152"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Rule_Language/qualifiedIdentifier.png" align="middle" alt="qualifiedIdentifier"/></div></div><p class="title"><b>Figure 5.21. qualifiedIdentifier</b></p></div><br class="figure-break"/><div class="figure"><a id="d0e4158"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Rule_Language/identifier.png" align="middle" alt="variable"/></div></div><p class="title"><b>Figure 5.22. variable</b></p></div><br class="figure-break"/><div class="figure"><a id="d0e4164"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Rule_Language/returnValue.png" align="middle" alt="returnValue"/></div></div><p class="title"><b>Figure 5.23. returnValue</b></p></div><br class="figure-break"/><p>You can do checks against fields that are or may be null,
          using '==' and '!=' as you would expect, and the literal
          <code class="literal">null</code> keyword, as in <code class="code">Cheese(type !=
          null)</code>, where the evaluator will not throw an exception and
          return true if the value is null. Type coercion is always attempted
          if the field and the value are of different types; exceptions will
          be thrown if a bad coercion is attempted. For instance, if "ten" is
          provided as a string in a numeric evaluator, an exception is thrown,
          whereas "10" would coerce to a numeric 10. Coercion is always in
          favor of the field type and not the value type.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h6 class="title"><a id="d0e4178"/>5.8.3.1.1.3. Single Value Restriction</h6></div></div></div><div class="figure"><a id="d0e4181"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Rule_Language/singleValueRestriction.png" align="middle" alt="singleValueRestriction"/></div></div><p class="title"><b>Figure 5.24. singleValueRestriction</b></p></div><br class="figure-break"/><p>A Single Value Restriction is a binary relation, applying a
          binary operator to the field value and another value, which may be a
          literal, a variable, a parenthesized expression ("return value"), or
          a qualified identifier, i.e., an enum constant.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h6 class="title"><a id="d0e4189"/>5.8.3.1.1.3.1. Operators</h6></div></div></div><div class="figure"><a id="d0e4192"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Rule_Language/operator.png" align="middle" alt="Operators"/></div></div><p class="title"><b>Figure 5.25. Operators</b></p></div><br class="figure-break"/><p>The operators '==' and '!=' are valid for all types. Other
            relational operatory may be used whenever the type values are
            ordered; for date fields, '&lt;' means "before". The pair
            <code class="literal">matches</code> and <code class="literal">not matches</code> is
            only applicable to string fields, <code class="literal">contains</code> and
            <code class="literal">not contains</code> require the field to be of some
            Collection type. Coercion to the correct value for the evaluator
            and the field will be attempted, as mentioned in the "Values"
            section.</p><div class="simplesect" lang="en-US"><div class="titlepage"><div><div><h6 class="title"><a id="d0e4212"/>The Operator <code class="literal">matches</code></h6></div></div></div><p>Matches a field against any valid Java <a id="d0e4219" class="indexterm"/>Regular Expression. Typically that regexp is a
              string literal, but variables that resolve to a valid regexp are
              also allowed. It is important to note that, <span class="emphasis"><em>different
              from Java</em></span>, within regular expressions written as
              string literals <span class="emphasis"><em>you don't need to escape
              '\'</em></span>. Example:</p><div class="example"><a id="d0e4229"/><p class="title"><b>Example 5.37. Regular Expression Constraint</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Cheese( type matches "(Buffalo)?\S*Mozarella" )</pre></div></div><br class="example-break"/></div><div class="simplesect" lang="en-US"><div class="titlepage"><div><div><h6 class="title"><a id="d0e4234"/>The Operator <code class="literal">not matches</code></h6></div></div></div><p>The operator returns true if the string does not match the
              regular expression. The same rules apply as for the
              <code class="literal">matches</code> operator. Example:</p><div class="example"><a id="d0e4244"/><p class="title"><b>Example 5.38. Regular Expression Constraint</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Cheese( type not matches "(Buffulo)?\S*Mozarella" )</pre></div></div><br class="example-break"/></div><div class="simplesect" lang="en-US"><div class="titlepage"><div><div><h6 class="title"><a id="d0e4249"/>The Operator <code class="literal">contains</code></h6></div></div></div><p>The operator <code class="literal">contains</code> is used to check
              whether a field that is a <a id="d0e4259" class="indexterm"/>Collection or array contains the specified
              value.</p><div class="example"><a id="d0e4263"/><p class="title"><b>Example 5.39. Contains with Collections</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">CheeseCounter( cheeses contains "stilton" ) // contains with a String literal
CheeseCounter( cheeses contains $var ) // contains with a variable</pre></div></div><br class="example-break"/></div><div class="simplesect" lang="en-US"><div class="titlepage"><div><div><h6 class="title"><a id="d0e4268"/>The Operator <code class="literal">not contains</code></h6></div></div></div><p>The operator <code class="literal">not contains</code> is used to
              check whether a field that is a <a id="d0e4278" class="indexterm"/>Collection or array does <span class="emphasis"><em>not</em></span>
              contain the specified value.</p><div class="example"><a id="d0e4285"/><p class="title"><b>Example 5.40. Literal Constraint with Collections</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">CheeseCounter( cheeses not contains "cheddar" ) // not contains with a String literal
CheeseCounter( cheeses not contains $var ) // not contains with a variable</pre></div></div><br class="example-break"/><div class="blockquote"><blockquote class="blockquote"><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>For backward compatibility, the
                  <code class="literal">excludes</code> operator is supported as a
                  synonym for <code class="literal">not contains</code>.</p></div></blockquote></div></div><div class="simplesect" lang="en-US"><div class="titlepage"><div><div><h6 class="title"><a id="d0e4300"/>The Operator <code class="literal">memberOf</code></h6></div></div></div><p>The operator <code class="literal">memberOf</code> is used to check
              whether a field is a member of a collection or array; that
              collection must be a variable.</p><div class="example"><a id="d0e4310"/><p class="title"><b>Example 5.41. Literal Constraint with Collections</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">CheeseCounter( cheese memberOf $matureCheeses )</pre></div></div><br class="example-break"/></div><div class="simplesect" lang="en-US"><div class="titlepage"><div><div><h6 class="title"><a id="d0e4315"/>The Operator <code class="literal">not memberOf</code></h6></div></div></div><p>The operator <code class="literal">not memberOf</code> is used to
              check whether a field is not a member of a collection or array;
              that collection must be a variable.</p><div class="example"><a id="d0e4325"/><p class="title"><b>Example 5.42. Literal Constraint with Collections</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">CheeseCounter( cheese not memberOf $matureCheeses )</pre></div></div><br class="example-break"/></div><div class="simplesect" lang="en-US"><div class="titlepage"><div><div><h6 class="title"><a id="d0e4330"/>The Operator <code class="literal">soundslike</code></h6></div></div></div><p>This operator is similar to <code class="literal">matches</code>,
              but it checks whether a word has almost the same sound (using
              English pronounciation) as the given value. This is based on the
              Soundex algorithm (see
              <code class="code">http://en.wikipedia.org/wiki/Soundex</code>).</p><div class="example"><a id="d0e4343"/><p class="title"><b>Example 5.43. Test with soundslike</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// match cheese "fubar" or "foobar"
Cheese( name soundslike 'foobar' )</pre></div></div><br class="example-break"/></div><div class="simplesect" lang="en-US"><div class="titlepage"><div><div><h6 class="title"><a id="d0e4348"/>The Operator <code class="literal">str</code></h6></div></div></div><p>This operator <code class="literal">str</code> is used to
              check whether a field that is a <a id="d0e4358" class="indexterm"/>String starts with or ends with with a certain value. It can also be used to check
                the length of the String.
              </p><div class="example"><a id="d0e4362"/><p class="title"><b>Example 5.44. Test with str</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">$m : Message( routingValue str[startsWith] "R1" )
                        $m : Message( routingValue str[endsWith] "R2" )
                        $m : Message( routingValue str[length] 17 )
                </pre></div></div><p><br class="example-break"/>
              </p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h6 class="title"><a id="d0e4368"/>5.8.3.1.1.3.2. Literal Restrictions</h6></div></div></div><p>Literal restrictions are the simplest form of restrictions
            and evaluate a field against a specified literal, which may be
            numeric or a date, a string or a boolean.</p><div class="figure"><a id="d0e4373"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Rule_Language/literalRestriction.png" align="middle" alt="literalRestriction"/></div></div><p class="title"><b>Figure 5.26. literalRestriction</b></p></div><br class="figure-break"/><p>Literal Restrictions using the operator '==' provide for
            faster execution as we can index using hashing to improve
            performance.</p><div class="simplesect" lang="en-US"><div class="titlepage"><div><div><h6 class="title"><a id="d0e4381"/>Numeric</h6></div></div></div><p>All standard Java numeric primitives are supported.</p><div class="example"><a id="d0e4386"/><p class="title"><b>Example 5.45. Numeric Literal Restriction</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Cheese( quantity == 5 )</pre></div></div><br class="example-break"/></div><div class="simplesect" lang="en-US"><div class="titlepage"><div><div><h6 class="title"><a id="d0e4391"/>Date</h6></div></div></div><p>The date format "dd-mmm-yyyy" is supported by default. You
              can customize this by providing an alternative date format mask
              as the System property named <code class="code">drools.dateformat</code>. If
              more control is required, use the inline-eval constraint.</p><div class="example"><a id="d0e4399"/><p class="title"><b>Example 5.46. Date Literal Restriction</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Cheese( bestBefore &lt; "27-Oct-2009" )</pre></div></div><br class="example-break"/></div><div class="simplesect" lang="en-US"><div class="titlepage"><div><div><h6 class="title"><a id="d0e4404"/>String</h6></div></div></div><p>Any valid Java String is allowed.</p><div class="example"><a id="d0e4409"/><p class="title"><b>Example 5.47. String Literal Restriction</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Cheese( type == "stilton" )</pre></div></div><br class="example-break"/></div><div class="simplesect" lang="en-US"><div class="titlepage"><div><div><h6 class="title"><a id="d0e4414"/>Boolean</h6></div></div></div><p>Only <code class="code">true</code> or <code class="code">false</code> can be used;
              0 and 1 are not acceptable. A boolean field alone (as in
              <code class="code">Cheese( smelly )</code> is not permitted; you must compare
              this to a boolean literal.</p><div class="example"><a id="d0e4428"/><p class="title"><b>Example 5.48. Boolean Literal Restriction</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Cheese( smelly == true )</pre></div></div><br class="example-break"/></div><div class="simplesect" lang="en-US"><div class="titlepage"><div><div><h6 class="title"><a id="d0e4433"/>Qualified Identifier</h6></div></div></div><p>Enums can be used as well, both JDK 1.4 and 5 style enums
              are supported. For the latter you must be executing on a JDK 5
              environment.</p><div class="example"><a id="d0e4438"/><p class="title"><b>Example 5.49. Boolean Literal Restriction</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Cheese( smelly == SomeClass.TRUE )</pre></div></div><br class="example-break"/></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h6 class="title"><a id="d0e4443"/>5.8.3.1.1.3.3. Bound Variable Restriction</h6></div></div></div><div class="figure"><a id="d0e4446"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Rule_Language/variableRestriction.png" align="middle" alt="variableRestriction"/></div></div><p class="title"><b>Figure 5.27. variableRestriction</b></p></div><br class="figure-break"/><p>Variables can be bound to facts and their fields and then
            used in subsequent Field Constraints. A bound variable is called a
            <a id="d0e4454" class="indexterm"/>Declaration. Valid operators are determined by the
            type of the field being constrained; coercion will be attempted
            where possible. Bound Variable Restrictions using the operator
            '==' provide for very fast execution as we can use hashing to
            improve performance.</p><div class="example"><a id="d0e4458"/><p class="title"><b>Example 5.50. Bound Field using the operator '=='</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Person( likes : favouriteCheese )
Cheese( type == likes )</pre></div></div><br class="example-break"/><p>Here, <code class="code">likes</code> is the variable that is bound in
            its declaration to the field <code class="code">favouriteCheese</code> of any
            matching Person instance. It is then used to constrain the type of
            Cheese in the following pattern. Any valid Java variable name can
            be used, and it may be prefixed with a '$', which you will often
            see used to help differentiate declarations from fields. The
            example below shows a declaration for <code class="code">$stilton</code>, bound
            to the object matching the first pattern and used with a
            <code class="code">contains</code> operator. - Note the optional use of
            '$'.</p><div class="example"><a id="d0e4477"/><p class="title"><b>Example 5.51. Bound Fact using 'contains' operator</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">$stilton : Cheese( type == "stilton" )
Cheesery( cheeses contains $stilton )</pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h6 class="title"><a id="d0e4482"/>5.8.3.1.1.3.4. Return Value Restriction</h6></div></div></div><div class="figure"><a id="d0e4485"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Rule_Language/returnValueRestriction.png" align="middle" alt="returnValueRestriction"/></div></div><p class="title"><b>Figure 5.28. returnValueRestriction</b></p></div><br class="figure-break"/><p>A <a id="d0e4493" class="indexterm"/>Return Value restriction is a parenthesized
            expression composed from literals, any valid Java primitive or
            object, previously bound variables, function calls, and operators.
            Functions used in a Return Value must return results that do not
            depend on time.</p><div class="example"><a id="d0e4497"/><p class="title"><b>Example 5.52. Return Value Restriction</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Person( girlAge : age, sex == "F" )
Person( age == ( girlAge + 2) ), sex == 'M' )
</pre></div></div><br class="example-break"/></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h6 class="title"><a id="d0e4502"/>5.8.3.1.1.4. Compound Value Restriction</h6></div></div></div><p>The compound value restriction is used where there is more
          than one possible value to match. Currently only the
          <code class="literal">in</code> and <code class="literal">not in</code> evaluators
          support this. The second operand of this operator must be a
          comma-separated list of values, enclosed in parentheses. Values may
          be given as variables, literals, return values or qualified
          identifiers. Both evaluators are actually "syntactic sugar",
          internally rewritten as a list of multiple restrictions using the
          operators '!=' and '=='.</p><div class="figure"><a id="d0e4513"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Rule_Language/compoundValueRestriction.png" align="middle" alt="compoundValueRestriction"/></div></div><p class="title"><b>Figure 5.29. compoundValueRestriction</b></p></div><br class="figure-break"/><p/><div class="example"><a id="d0e4520"/><p class="title"><b>Example 5.53. Compound Restriction using "in"</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Person( $cheese : favouriteCheese )
Cheese( type in ( "stilton", "cheddar", $cheese )
</pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h6 class="title"><a id="d0e4525"/>5.8.3.1.1.5. Multi Restriction</h6></div></div></div><p>Multi restriction allows you to place more than one
          restriction on a field using the restriction connectives
          '&amp;&amp;' or '||'. Grouping via parentheses is permitted,
          resulting in a recursive syntax pattern.</p><div class="figure"><a id="d0e4530"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Rule_Language/multiRestriction.png" align="middle" alt="multiRestriction"/></div></div><p class="title"><b>Figure 5.30. multiRestriction</b></p></div><br class="figure-break"/><div class="figure"><a id="d0e4536"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Rule_Language/restrictionGroup.png" align="middle" alt="restrictionGroup"/></div></div><p class="title"><b>Figure 5.31. restrictionGroup</b></p></div><br class="figure-break"/><p/><div class="example"><a id="d0e4543"/><p class="title"><b>Example 5.54. Multi Restriction</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// Simple multi restriction using a single &amp;&amp;
Person( age &gt; 30 &amp;&amp; &lt; 40 )
// Complex multi restriction using groupings of multi restrictions
Person( age ( (&gt; 30 &amp;&amp; &lt; 40) ||
              (&gt; 20 &amp;&amp; &lt; 25) ) )
// Mixing muti restrictions with constraint connectives
Person( age &gt; 30 &amp;&amp; &lt; 40 || location == "london" )</pre></div></div><br class="example-break"/></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="d0e4548"/>5.8.3.1.2. Inline Eval Constraints</h5></div></div></div><div class="figure"><a id="d0e4551"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Rule_Language/inlineEvalConstraint.png" align="middle" alt="Inline Eval Expression"/></div></div><p class="title"><b>Figure 5.32. Inline Eval Expression</b></p></div><br class="figure-break"/><p>An <a id="d0e4559" class="indexterm"/>inline eval constraint can use any valid dialect
        expression as long as it results to a primitive boolean. The
        expression must be constant over time. Any previously bound variable,
        from the current or previous pattern, can be used; autovivification is
        also used to auto-create field binding variables. When an identifier
        is found that is not a current variable, the builder looks to see if
        the identifier is a field on the current object type, if it is, the
        field binding is auto-created as a variable of the same name. This is
        called autovivification of field variables inside of inline
        evals.</p><p>This example will find all male-female pairs where the male is 2
        years older than the female; the variable <code class="code">age</code> is
        auto-created in the second pattern by the autovivification
        process.</p><div class="example"><a id="d0e4568"/><p class="title"><b>Example 5.55. Return Value operator</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Person( girlAge : age, sex = "F" )
Person( eval( age == girlAge + 2 ), sex = 'M' )
</pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="d0e4573"/>5.8.3.1.3. Nested Accessors</h5></div></div></div><p>Drools permits <span class="emphasis"><em>nested accessors</em></span> in in the
        field constraints using the MVEL accessor graph notation. Field
        constraints involving nested accessors are actually re-written as an
        MVEL dialect inline-eval. Care should be taken when using nested
        accessors as the Working Memory is not aware of any of the nested
        values, and does not know when they change; they should be considered
        immutable while any of their parent references are inserted into the
        Working Memory. If you wish to modify a nested value you should remove
        the parent objects first and re-assert afterwards. If you only have a
        single parent at the root of the graph, when in the MVEL dialect, you
        can use the <code class="literal">modify</code> construct and its block setters
        to write the nested accessor assignments while retracting and
        inserting the the root parent object as required. Nested accessors can
        be used on either side of the operator symbol.</p><div class="example"><a id="d0e4584"/><p class="title"><b>Example 5.56. Nested Accessors</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// Find a pet older than its owners first-born child
$p : Person( ) 
Pet( owner == $p, age &gt; $p.children[0].age )</pre><p>This is internally rewriten as an MVEL inline eval:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// Find a pet older than its owners first-born child
$p : Person( ) 
Pet( owner == $p, eval( age &gt; $p.children[0].age ) ) </pre></div></div><br class="example-break"/><p class="remark"><i><span class="remark"><span class="bold"><strong>Note: </strong></span>Nested accessors have a
        much greater performance cost than direct field accesses, so use them
        carefully.</span></i></p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e4597"/>5.8.3.2. Conditional Element <code class="literal">and</code></h4></div></div></div><p>The Conditional Element <code class="literal">and</code> is used to group
      other Conditional Elements into a logical conjunction. The root element
      of the LHS is an implicit prefix <code class="literal">and</code> and doesn't need
      to be specified. Drools supports both prefix <code class="literal">and</code> and
      infix <code class="literal">and</code>, but prefix is the preferred option as its
      implicit grouping avoids confusion.</p><div class="figure"><a id="d0e4616"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Rule_Language/prefixAnd.png" align="middle" alt="prefixAnd"/></div></div><p class="title"><b>Figure 5.33. prefixAnd</b></p></div><br class="figure-break"/><p/><div class="example"><a id="d0e4623"/><p class="title"><b>Example 5.57. prefixAnd</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">(and Cheese( cheeseType : type )
     Person( favouriteCheese == cheeseType ) )
</pre></div></div><br class="example-break"/><div class="example"><a id="d0e4628"/><p class="title"><b>Example 5.58. implicit root prefixAnd</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">when
     Cheese( cheeseType : type )
     Person( favouriteCheese == cheeseType )</pre></div></div><br class="example-break"/><p>Infix <code class="literal">and</code> is supported along with explicit
      grouping with parentheses, should it be needed. The symbol '&amp;&amp;',
      as an alternative to <code class="literal">and</code>, is deprecated although it
      is still supported in the syntax for legacy support reasons.</p><div class="figure"><a id="d0e4641"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Rule_Language/infixAnd.png" align="middle" alt="infixAnd"/></div></div><p class="title"><b>Figure 5.34. infixAnd</b></p></div><br class="figure-break"/><div class="example"><a id="d0e4647"/><p class="title"><b>Example 5.59. infixAnd</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">//infixAnd
Cheese( cheeseType : type ) and Person( favouriteCheese == cheeseType )
//infixAnd with grouping
( Cheese( cheeseType : type ) and
  ( Person( favouriteCheese == cheeseType ) or 
    Person( favouriteCheese == cheeseType ) )</pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e4652"/>5.8.3.3. Conditional Element <code class="literal">or</code></h4></div></div></div><p>The Conditional Element <code class="literal">or</code> is used to group
      other Conditional Elements into a logical disjunction. Drools supports
      both prefix <code class="literal">or</code> and infix <code class="literal">or</code>, but
      prefix is the preferred option as its implicit grouping avoids
      confusion. The behavior of the Conditional Element <code class="literal">or</code>
      is different from the connective '||' for constraints and restrictions
      in field constraints. The engine actually has no understanding of the
      Conditional Element <code class="literal">or</code>; instead, via a number of
      different logic transformations, a rule with <code class="literal">or</code> is
      rewritten as a number of subrules. This process ultimately results in a
      rule that has a single <code class="literal">or</code> as the root node and one
      subrule for each of its CEs. Each subrule can activate and fire like any
      normal rule; there is no special behavior or interaction between these
      subrules. - This can be most confusing to new rule authors.</p><div class="figure"><a id="d0e4680"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Rule_Language/prefixOr.png" align="middle" alt="prefixOr"/></div></div><p class="title"><b>Figure 5.35. prefixOr</b></p></div><br class="figure-break"/><div class="example"><a id="d0e4686"/><p class="title"><b>Example 5.60. prefixOr</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">(or Person( sex == "f", age &gt; 60 )
    Person( sex == "m", age &gt; 65 )
</pre></div></div><br class="example-break"/><p>Infix <code class="literal">or</code> is supported along with explicit
      grouping with parentheses, should it be needed. The symbol '||', as an
      alternative to <code class="literal">or</code>, is deprecated although it is still
      supported in the syntax for legacy support reasons.</p><div class="figure"><a id="d0e4699"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Rule_Language/infixOr.png" align="middle" alt="infixOr"/></div></div><p class="title"><b>Figure 5.36. infixOr</b></p></div><br class="figure-break"/><div class="example"><a id="d0e4705"/><p class="title"><b>Example 5.61. infixOr</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">//infixOr
Cheese( cheeseType : type ) or Person( favouriteCheese == cheeseType )
//infixOr with grouping
( Cheese( cheeseType : type ) or
  ( Person( favouriteCheese == cheeseType ) and
    Person( favouriteCheese == cheeseType ) )</pre></div></div><br class="example-break"/><p>The Conditional Element <code class="literal">or</code> also allows for
      optional pattern binding. This means that each resulting subrule will
      bind its pattern to the pattern binding. Each pattern must be bound
      separately, using eponymous variables:</p><div class="example"><a id="d0e4715"/><p class="title"><b>Example 5.62. or with binding</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">(or pensioner : Person( sex == "f", age &gt; 60 ) 
    pensioner : Person( sex == "m", age &gt; 65 ) )</pre></div></div><br class="example-break"/><p>Since the conditional element <code class="literal">or</code> results in
      multiple subrule generation, one for each possible logically outcome,
      the example above would result in the internal generation of two rules.
      These two rules work independently within the Working Memory, which
      means both can match, activate and fire - there is no
      shortcutting.</p><p>The best way to think of the conditional element
      <code class="literal">or</code> is as a shortcut for generating two or more
      similar rules. When you think of it that way, it's clear that for a
      single rule there could be multiple activations if two or more terms of
      the disjunction are true.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e4730"/>5.8.3.4. Conditional Element <code class="literal">eval</code></h4></div></div></div><div class="figure"><a id="d0e4735"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Rule_Language/eval.png" align="middle" alt="eval"/></div></div><p class="title"><b>Figure 5.37. eval</b></p></div><br class="figure-break"/><p>The CE <code class="literal">eval</code> is essentially a catch-all which
      allows any semantic code (that returns a primitive boolean) to be
      executed. This code can refer to variables that were bound in the LHS of
      the rule, and functions in the rule package. Overuse of eval reduces the
      declarativeness of your rules and can result in a poorly performing
      engine. While <code class="literal">eval</code> can be used anywhere in the
      patterns, the best practice is to add it as the last conditional element
      in the LHS of a rule.</p><p>Evals cannot be indexed and thus are not as efficient as Field
      Constraints. However this makes them ideal for being used when functions
      return values that change over time, which is not allowed within Field
      Constraints.</p><p>For folks who are familiar with Drools 2.x lineage, the old Drools
      parameter and condition tags are equivalent to binding a variable to an
      appropriate type, and then using it in an eval node.</p><div class="example"><a id="d0e4753"/><p class="title"><b>Example 5.63. eval</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">p1 : Parameter() 
p2 : Parameter()
eval( p1.getList().containsKey(p2.getItem()) )
// call function isValid in the LHS
eval( isValid(p1, p2) )</pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e4758"/>5.8.3.5. Conditional Element <code class="literal">not</code></h4></div></div></div><div class="figure"><a id="d0e4763"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Rule_Language/not.png" align="middle" alt="not"/></div></div><p class="title"><b>Figure 5.38. not</b></p></div><br class="figure-break"/><p>The CE <code class="literal">not</code> is first order logic's
      non-existential quantifier and checks for the non-existence of something
      in the Working Memory. Think of "not" as meaning "there must be none
      of...".</p><p>The keyword <code class="literal">not</code> be followed by parentheses
      around the CEs that it applies to. In the simplest case of a single
      pattern (like below) you may optionally omit the parentheses.</p><div class="example"><a id="d0e4779"/><p class="title"><b>Example 5.64. No Busses</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">not Bus()</pre></div></div><br class="example-break"/><div class="example"><a id="d0e4784"/><p class="title"><b>Example 5.65. No red Busses</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// Brackets are optional:
not Bus(color == "red")
// Brackets are optional:
not ( Bus(color == "red", number == 42) )
// "not" with nested infix <code xmlns="http://www.w3.org/1999/xhtml" class="literal">and</code> - two patterns,
// brackets are requires:
not ( Bus(color == "red") and
      Bus(color == "blue") )</pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e4792"/>5.8.3.6. Conditional Element <code class="literal">exists</code></h4></div></div></div><div class="figure"><a id="d0e4797"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Rule_Language/exists.png" align="middle" alt="exists"/></div></div><p class="title"><b>Figure 5.39. exists</b></p></div><br class="figure-break"/><p>The CE <code class="literal">exists</code> is first order logic's
      existential quantifier and checks for the existence of something in the
      Working Memory. Think of "exists" as meaning "there is at least one..".
      It is different from just having the pattern on its own, which is more
      like saying "for each one of...". If you use <code class="literal">exists</code>
      with a pattern, the rule will only activate at most once, regardless of
      how much data there is in working memory that matches the condition
      inside of the <code class="literal">exists</code> pattern. Since only the
      existence matters, no bindings will be established.</p><p>The keyword <code class="literal">exists</code> must be followed by
      parentheses around the CEs that it applies to. In the simplest case of a
      single pattern (like below) you may omit the parentheses.</p><div class="example"><a id="d0e4819"/><p class="title"><b>Example 5.66. At least one Bus</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">exists Bus()</pre></div></div><br class="example-break"/><div class="example"><a id="d0e4824"/><p class="title"><b>Example 5.67. At least one red Bus</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">exists Bus(color == "red")
// brackets are optional:
exists ( Bus(color == "red", number == 42) )
// "exists" with nested infix <code xmlns="http://www.w3.org/1999/xhtml" class="literal">and</code>,
// brackets are required:
exists ( Bus(color == "red") and
         Bus(color == "blue") )</pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e4832"/>5.8.3.7. Conditional Element <code class="literal">forall</code></h4></div></div></div><div class="figure"><a id="d0e4837"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Rule_Language/forall.png" align="middle" alt="forall"/></div></div><p class="title"><b>Figure 5.40. forall</b></p></div><br class="figure-break"/><p>The Conditional Element <code class="literal">forall</code> completes the
      First Order Logic support in Drools. The Conditional Element
      <code class="literal">forall</code> evaluates to true when all facts that match
      the first pattern match all the remaining patterns. Example:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">rule "All English buses are red"
when
    forall( $bus : Bus( type == 'english') 
                   Bus( this == $bus, color = 'red' ) )
then
    # all english buses are red
end
</pre><p>In the above rule, we "select" all Bus objects whose type is
      "english". Then, for each fact that matches this pattern we evaluate the
      following patterns and if they match, the forall CE will evaluate to
      true.</p><p>To state that all facts of a given type in the working memory must
      match a set of constraints, <code class="literal">forall</code> can be written
      with a single pattern for simplicity. Example:</p><div class="example"><a id="d0e4860"/><p class="title"><b>Example 5.68. Single Pattern Forall</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">rule "All Buses are Red"
when
    forall( Bus( color == 'red' ) )
then
    # all asserted Bus facts are red
end
</pre></div></div><br class="example-break"/><p>Another example shows multiple patterns inside the
      <code class="literal">forall</code>:</p><div class="example"><a id="d0e4870"/><p class="title"><b>Example 5.69. Multi-Pattern Forall</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">rule "all employees have health and dental care programs"
when
    forall( $emp : Employee()
            HealthCare( employee == $emp )
            DentalCare( employee == $emp )
          )
then
    # all employees have health and dental care
end
</pre></div></div><br class="example-break"/><p>Forall can be nested inside other CEs.
      For instance, <code class="literal">forall</code> can be used inside a
      <code class="literal">not</code> CE. Note that only single patterns have optional
      parentheses, so that with a nested <code class="literal">forall</code>
      parentheses must be used:</p><div class="example"><a id="d0e4886"/><p class="title"><b>Example 5.70. Combining Forall with Not CE</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">rule "not all employees have health and dental care"
when 
    not ( forall( $emp : Employee()
                  HealthCare( employee == $emp )
                  DentalCare( employee == $emp ) ) 
        )
then
    # not all employees have health and dental care
end
</pre></div></div><br class="example-break"/><p>As a side note, <code class="code">forall( p1 p2 p3...)</code> is
      equivalent to writing:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">not(p1 and not(and p2 p3...))</pre><p>Also, it is important to note that <code class="literal">forall</code> is a
      <span class="emphasis"><em>scope delimiter</em></span>. Therefore, it can use any
      previously bound variable, but no variable bound inside it will be
      available for use outside of it.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e4906"/>5.8.3.8. Conditional Element <code class="literal">from</code></h4></div></div></div><div class="figure"><a id="d0e4911"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Rule_Language/from.png" align="middle" alt="from"/></div></div><p class="title"><b>Figure 5.41. from</b></p></div><br class="figure-break"/><p>The Conditional Element <code class="literal">from</code> enables users to
      specify an arbitrary source for data to be matched by LHS patterns. This
      allows the engine to reason over data not in the Working Memory. The
      data source could be a sub-field on a bound variable or the results of a
      method call. It is a powerful construction that allows out of the box
      integration with other application components and frameworks. One common
      example is the integration with data retrieved on-demand from databases
      using hibernate named queries.</p><p>The expression used to define the object source is any expression
      that follows regular MVEL syntax. Therefore, it allows you to easily use
      object property navigation, execute method calls and access maps and
      collections elements.</p><p>Here is a simple example of reasoning and binding on another
      pattern sub-field:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">rule "validate zipcode"
when
    Person( $personAddress : address ) 
    Address( zipcode == "23920W") from $personAddress 
then
    # zip code is ok
end
</pre><p>With all the flexibility from the new expressiveness in the Drools
      engine you can slice and dice this problem many ways. This is the same
      but shows how you can use a graph notation with the 'from':</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">rule "validate zipcode"
when
    $p : Person( ) 
    $a : Address( zipcode == "23920W") from $p.address 
then
    # zip code is ok
end
</pre><p>Previous examples were evaluations using a single pattern. The CE
      <code class="literal">from</code> also support object sources that return a
      collection of objects. In that case, <code class="literal">from</code> will
      iterate over all objects in the collection and try to match each of them
      individually. For instance, if we want a rule that applies 10% discount
      to each item in an order, we could do:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">rule "apply 10% discount to all items over US$ 100,00 in an order"
when
    $order : Order()
    $item  : OrderItem( value &gt; 100 ) from $order.items
then
    # apply discount to $item
end
</pre><p>The above example will cause the rule to fire once for each item
      whose value is greater than 100 for each given order.</p><p>You must take caution, however, when using
      <code class="literal">from</code>, especially in conjunction with the
      <code class="literal">lock-on-active</code> rule attribute as it may produce
      unexpected results. Consider the example provided earlier, but now
      slightly modified as follows:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">rule "Assign people in North Carolina (NC) to sales region 1"
ruleflow-group "test"
lock-on-active true
when
    $p : Person( ) 
    $a : Address( state == "NC") from $p.address 
then
    modify ($p) {} #Assign person to sales region 1 in a modify block
end

rule "Apply a discount to people in the city of Raleigh"
ruleflow-group "test"
lock-on-active true
when
    $p : Person( ) 
    $a : Address( city == "Raleigh") from $p.address 
then
    modify ($p) {} #Apply discount to person in a modify block
end
</pre><p>In the above example, persons in Raleigh, NC should be assigned to
      sales region 1 and receive a discount; i.e., you would expect both rules
      to activate and fire. Instead you will find that only the second rule
      fires.</p><p>If you were to turn on the audit log, you would also see that when
      the second rule fires, it deactivates the first rule. Since the rule
      attribute <code class="literal">lock-on-active</code> prevents a rule from
      creating new activations when a set of facts change, the first rule
      fails to reactivate. Though the set of facts have not changed, the use
      of <code class="literal">from</code> returns a new fact for all intents and
      purposes each time it is evaluated.</p><p>First, it's important to review why you would use the above
      pattern. You may have many rules across different rule-flow groups. When
      rules modify working memory and other rules downstream of your RuleFlow
      (in different rule-flow groups) need to be reevaluated, the use of
      <code class="literal">modify</code> is critical. You don't, however, want other
      rules in the same rule-flow group to place activations on one another
      recursively. In this case, the <code class="literal">no-loop</code> attribute is
      ineffective, as it would only prevent a rule from activating itself
      recursively. Hence, you resort to
      <code class="literal">lock-on-active</code>.</p><p>There are several ways to address this issue:</p><div class="itemizedlist"><ul><li><p>Avoid the use of <code class="literal">from</code> when you can assert
          all facts into working memory or use nested object references in
          your constraint expressions (shown below).</p></li><li><p>Place the variable assigned used in the modify block as the
          last sentence in your condition (LHS).</p></li><li><p>Avoid the use of <code class="literal">lock-on-active</code> when you
          can explicitly manage how rules within the same rule-flow group
          place activations on one another (explained below).</p></li></ul></div><p>The preferred solution is to minimize use of
      <code class="literal">from</code> when you can assert all your facts into working
      memory directly. In the example above, both the Person and Address
      instance can be asserted into working memory. In this case, because the
      graph is fairly simple, an even easier solution is to modify your rules
      as follows:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">rule "Assign people in North Carolina (NC) to sales region 1"
ruleflow-group "test"
lock-on-active true
when
    $p : Person(address.state == "NC" )  
then
    modify ($p) {} #Assign person to sales region 1 in a modify block
end

rule "Apply a discount to people in the city of Raleigh"
ruleflow-group "test"
lock-on-active true
when
    $p : Person(address.city == "Raleigh" )  
then
    modify ($p) {} #Apply discount to person in a modify block
end
</pre><p>Now, you will find that both rules fire as expected. However, it
      is not always possible to access nested facts as above. Consider an
      example where a Person holds one or more Addresses and you wish to use
      an existential quantifier to match people with at least one address that
      meets certain conditions. In this case, you would have to resort to the
      use of <code class="literal">from</code> to reason over the collection.</p><p>There are several ways to use <code class="literal">from</code> to achieve
      this and not all of them exhibit an issue with the use of
      <code class="literal">lock-on-active</code>. For example, the following use of
      <code class="literal">from</code> causes both rules to fire as expected:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">rule "Assign people in North Carolina (NC) to sales region 1"
ruleflow-group "test"
lock-on-active true
when
    $p : Person($addresses : addresses)
    exists (Address(state == "NC") from $addresses)  
then
    modify ($p) {} #Assign person to sales region 1 in a modify block
end

rule "Apply a discount to people in the city of Raleigh"
ruleflow-group "test"
lock-on-active true
when
    $p : Person($addresses : addresses)
    exists (Address(city == "Raleigh") from $addresses)  
then
    modify ($p) {} #Apply discount to person in a modify block
end
</pre><p>However, the following slightly different approach does exhibit
      the problem:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">rule "Assign people in North Carolina (NC) to sales region 1"
ruleflow-group "test"
lock-on-active true
when
    $assessment : Assessment()
    $p : Person()
    $addresses : List() from $p.addresses
    exists (Address( state == "NC") from $addresses) 
then
    modify ($assessment) {} #Modify assessment in a modify block
end

rule "Apply a discount to people in the city of Raleigh"
ruleflow-group "test"
lock-on-active true
when
    $assessment : Assessment()
    $p : Person()
    $addresses : List() from $p.addresses 
    exists (Address( city == "Raleigh") from $addresses)
then
    modify ($assessment) {} #Modify assessment in a modify block
end</pre><p>In the above example, the $addresses variable is returned from the
      use of <code class="literal">from</code>. The example also introduces a new
      object, assessment, to highlight one possible solution in this case. If
      the $assessment variable assigned in the condition (LHS) is moved to the
      last condition in each rule, both rules fire as expected.</p><p>Though the above examples demonstrate how to combine the use of
      <code class="literal">from</code> with <code class="literal">lock-on-active</code> where no
      loss of rule activations occurs, they carry the drawback of placing a
      dependency on the order of conditions on the LHS. In addition, the
      solutions present greater complexity for the rule author in terms of
      keeping track of which conditions may create issues.</p><p>A better alternative is to assert more facts into working memory.
      In this case, a person's addresses may be asserted into working memory
      and the use of <code class="literal">from</code> would not be necessary.</p><p>There are cases, however, where asserting all data into working
      memory is not practical and we need to find other solutions. Another
      option is to reevaluate the need for <code class="literal">lock-on-active</code>.
      An alternative to <code class="literal">lock-on-active</code> is to directly
      manage how rules within the same rule-flow group activate one another by
      including conditions in each rule that prevent rules from activating
      each other recursively when working memory is modified. For example, in
      the case above where a discount is applied to citizens of Raleigh, a
      condition may be added to the rule that checks whether the discount has
      already been applied. If so, the rule does not activate.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e5048"/>5.8.3.9. Conditional Element <code class="literal">collect</code></h4></div></div></div><div class="figure"><a id="d0e5053"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Rule_Language/collect.png" align="middle" alt="collect"/></div></div><p class="title"><b>Figure 5.42. collect</b></p></div><br class="figure-break"/><p>The Conditional Element <code class="literal">collect</code> allows rules to
      reason over a collection of objects obtained from the given source or
      from the working memory. In First Oder Logic terms this is the
      cardinality quantifier. A simple example:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">import java.util.ArrayList

rule "Raise priority if system has more than 3 pending alarms"
when
    $system : System()
    $alarms : ArrayList( size &gt;= 3 )
              from collect( Alarm( system == $system, status == 'pending' ) )
then
    # Raise priority, because system $system has
    # 3 or more alarms pending. The pending alarms
    # are $alarms.
end
</pre><p>In the above example, the rule will look for all pending alarms in
      the working memory for each given system and group them in ArrayLists.
      If 3 or more alarms are found for a given system, the rule will
      fire.</p><p>The result pattern of <code class="literal">collect</code> can be any
      concrete class that implements the <code class="code">java.util.Collection</code>
      interface and provides a default no-arg public constructor. This means
      that you can use Java collections like ArrayList, LinkedList, HashSet,
      etc., or your own class, as long as it implements the
      <code class="code">java.util.Collection</code> interface and provide a default no-arg
      public constructor.</p><p>Both source and result patterns can be constrained as any other
      pattern.</p><p>Variables bound before the <code class="literal">collect</code> CE are in
      the scope of both source and result patterns and therefore you can use
      them to constrain both your source and result patterns. But note that
      <code class="literal">collect</code> is a scope delimiter for bindings, so that
      any binding made inside of it is not available for use outside of
      it.</p><p>Collect accepts nested <code class="literal">from</code> CEs. The following
      example is a valid use of "collect":</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">import java.util.LinkedList;

rule "Send a message to all mothers"
when
    $town : Town( name == 'Paris' )
    $mothers : LinkedList() 
               from collect( Person( gender == 'F', children &gt; 0 ) 
                             from $town.getPeople() 
                           )
then
    # send a message to all mothers
end
</pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e5096"/>5.8.3.10. Conditional Element <code class="literal">accumulate</code></h4></div></div></div><div class="figure"><a id="d0e5101"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Rule_Language/accumulate.png" align="middle" alt="accumulate"/></div></div><p class="title"><b>Figure 5.43. accumulate</b></p></div><br class="figure-break"/><p>The Conditional Element <code class="literal">accumulate</code> is a more
      flexible and powerful form of <code class="literal">collect</code>, the sense that
      it can be used to do what <code class="literal">collect</code> does and also
      achieve things that the CE <code class="literal">collect</code> is not capable of
      doing. Basically, what it does is that it allows a rule to iterate over
      a collection of objects, executing custom actions for each of the
      elements, and at the end it returns a result object.</p><p>The general syntax of the <code class="literal">accumulate</code> CE
      is:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class=""><em xmlns="http://www.w3.org/1999/xhtml" class="replaceable"><code>&lt;result pattern&gt;</code></em> <code xmlns="http://www.w3.org/1999/xhtml" class="literal">from accumulate(</code> <em xmlns="http://www.w3.org/1999/xhtml" class="replaceable"><code>&lt;source pattern&gt;</code></em><code xmlns="http://www.w3.org/1999/xhtml" class="literal">,</code>
                                  <code xmlns="http://www.w3.org/1999/xhtml" class="literal">init(</code> <em xmlns="http://www.w3.org/1999/xhtml" class="replaceable"><code>&lt;init code&gt;</code></em> <code xmlns="http://www.w3.org/1999/xhtml" class="literal">),</code>
                                  <code xmlns="http://www.w3.org/1999/xhtml" class="literal">action(</code> <em xmlns="http://www.w3.org/1999/xhtml" class="replaceable"><code>&lt;action code&gt;</code></em> <code xmlns="http://www.w3.org/1999/xhtml" class="literal">),</code>
                                  <code xmlns="http://www.w3.org/1999/xhtml" class="literal">reverse(</code> <em xmlns="http://www.w3.org/1999/xhtml" class="replaceable"><code>&lt;reverse code&gt;</code></em> <code xmlns="http://www.w3.org/1999/xhtml" class="literal">),</code>
                                  <code xmlns="http://www.w3.org/1999/xhtml" class="literal">result(</code> <em xmlns="http://www.w3.org/1999/xhtml" class="replaceable"><code>&lt;result expression&gt;</code></em> <code xmlns="http://www.w3.org/1999/xhtml" class="literal">) )</code>
</pre><p>The meaning of each of the elements is the following:</p><div class="itemizedlist"><ul><li><p><span class="emphasis"><em>&lt;source pattern&gt;</em></span>: the source
          pattern is a regular pattern that the engine will try to match
          against each of the source objects.</p></li><li><p><span class="emphasis"><em>&lt;init code&gt;</em></span>: this is a semantic
          block of code in the selected dialect that will be executed once for
          each tuple, before iterating over the source objects.</p></li><li><p><span class="emphasis"><em>&lt;action code&gt;</em></span>: this is a semantic
          block of code in the selected dialect that will be executed for each
          of the source objects.</p></li><li><p><span class="emphasis"><em>&lt;reverse code&gt;</em></span>: this is an optional
          semantic block of code in the selected dialect that if present will
          be executed for each source object that no longer matches the source
          pattern. The objective of this code block is to undo any calculation
          done in the <span class="emphasis"><em>&lt;action code&gt;</em></span> block, so that
          the engine can do decremental calculation when a source object is
          modified or retracted, hugely improving performance of these
          operations.</p></li><li><p><span class="emphasis"><em>&lt;result expression&gt;</em></span>: this is a
          semantic expression in the selected dialect that is executed after
          all source objects are iterated.</p></li><li><p><span class="emphasis"><em>&lt;result pattern&gt;</em></span>: this is a regular
          pattern that the engine tries to match against the object returned
          from the <span class="emphasis"><em>&lt;result expression&gt;</em></span>. If it
          matches, the <code class="literal">accumulate</code> conditional element
          evaluates to <span class="emphasis"><em>true</em></span> and the engine proceeds with
          the evaluation of the next CE in the rule. If it does not matches,
          the <code class="literal">accumulate</code> CE evaluates to
          <span class="emphasis"><em>false</em></span> and the engine stops evaluating CEs for
          that rule.</p></li></ul></div><p>It is easier to understand if we look at an example:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">rule "Apply 10% discount to orders over US$ 100,00"
when
    $order : Order()
    $total : Number( doubleValue &gt; 100 ) 
             from accumulate( OrderItem( order == $order, $value : value ),
                              init( double total = 0; ),
                              action( total += $value; ),
                              reverse( total -= $value; ),
                              result( total ) )
then
    # apply discount to $order
end
</pre><p>In the above example, for each <code class="code">Order</code> in the Working
      Memory, the engine will execute the <span class="emphasis"><em>init code</em></span>
      initializing the total variable to zero. Then it will iterate over all
      <code class="code">OrderItem</code> objects for that order, executing the
      <span class="emphasis"><em>action</em></span> for each one (in the example, it will sum
      the value of all items into the total variable). After iterating over
      all <code class="code">OrderItem</code> objects, it will return the value
      corresponding to the <span class="emphasis"><em>result expression</em></span> (in the
      above example, the value of variable <code class="code">total</code>). Finally, the
      engine will try to match the result with the <code class="code">Number</code>
      pattern, and if the double value is greater than 100, the rule will
      fire.</p><p>The example used Java as the semantic dialect, and as such, note
      that the usage of the semicolon as statement delimiter is mandatory in
      the init, action and reverse code blocks. The result is an expression
      and, as such, it does not admit ';'. If the user uses any other dialect,
      he must comply to that dialect's specific syntax.</p><p>As mentioned before, the <span class="emphasis"><em>reverse code</em></span> is
      optional, but it is strongly recommended that the user writes it in
      order to benefit from the <span class="emphasis"><em>improved performance on update and
      retract</em></span>.</p><p>The <code class="literal">accumulate</code> CE can be used to execute any
      action on source objects. The following example instantiates and
      populates a custom object:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">rule "Accumulate using custom objects"
when
    $person   : Person( $likes : likes )
    $cheesery : Cheesery( totalAmount &gt; 100 )
                from accumulate( $cheese : Cheese( type == $likes ),
                                 init( Cheesery cheesery = new Cheesery(); ),
                                 action( cheesery.addCheese( $cheese ); ),
                                 reverse( cheesery.removeCheese( $cheese ); ),
                                 result( cheesery ) );
then
    // do something
end</pre><div class="section" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="d0e5272"/>5.8.3.10.1. Accumulate Functions</h5></div></div></div><p>The accumulate CE is a very powerful CE, but it gets real
        declarative and easy to use when using predefined functions that are
        known as Accumulate Functions. They work exactly like accumulate, but
        instead of explicitly writing custom code in every accumulate CE, the
        user can use predefined code for common operations.</p><p>For instance, the rule to apply discount on orders written in
        the previous section, could be written in the following way, using
        Accumulate Functions:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">rule "Apply 10% discount to orders over US$ 100,00"
when
    $order : Order()
    $total : Number( doubleValue &gt; 100 ) 
             from accumulate( OrderItem( order == $order, $value : value ),
                              sum( $value ) )
then
    # apply discount to $order
end
</pre><p>In the above example, sum is an Accumulate Function and will sum
        the $value of all OrderItems and return the result.</p><p>Drools ships with the following built-in accumulate
        functions:</p><div class="itemizedlist"><ul><li><p>average</p></li><li><p>min</p></li><li><p>max</p></li><li><p>count</p></li><li><p>sum</p></li></ul></div><p>These common functions accept any expression as input. For
        instance, if someone wants to calculate the average profit on all
        items of an order, a rule could be written using the average
        function:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">rule "Average profit"
when
    $order : Order()
    $profit : Number() 
              from accumulate( OrderItem( order == $order, $cost : cost, $price : price )
                               average( 1 - $cost / $price ) )
then
    # average profit for $order is $profit
end
</pre><p>Accumulate Functions are all pluggable. That means that if
        needed, custom, domain specific functions can easily be added to the
        engine and rules can start to use them without any restrictions. To
        implement a new Accumulate Functions all one needs to do is to create
        a Java class that implements the
        <code class="code">org.drools.base.acumulators.AccumulateFunction</code> interface
        and add a line to the configuration file or set a system property to
        let the engine know about the new function. As an example of an
        Accumulate Function implementation, the following is the
        implementation of the <code class="literal">average</code> function:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_comment">/*</span>
<!--  --><br/><span class="java_plain">&nbsp;*&nbsp;Copyright&nbsp;2007&nbsp;JBoss&nbsp;Inc</span>
<!--  --><br/><span class="java_plain">&nbsp;*&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;*&nbsp;Licensed&nbsp;under&nbsp;the&nbsp;Apache&nbsp;License,&nbsp;Version&nbsp;2.0&nbsp;(the&nbsp;&quot;License&quot;);</span>
<!--  --><br/><span class="java_plain">&nbsp;*&nbsp;you&nbsp;may&nbsp;not&nbsp;use&nbsp;this&nbsp;file&nbsp;except&nbsp;in&nbsp;compliance&nbsp;with&nbsp;the&nbsp;License.</span>
<!--  --><br/><span class="java_plain">&nbsp;*&nbsp;You&nbsp;may&nbsp;obtain&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;License&nbsp;at</span>
<!--  --><br/><span class="java_plain">&nbsp;*&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;http://www.apache.org/licenses/LICENSE-2.0</span>
<!--  --><br/><span class="java_plain">&nbsp;*&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;*&nbsp;Unless&nbsp;required&nbsp;by&nbsp;applicable&nbsp;law&nbsp;or&nbsp;agreed&nbsp;to&nbsp;in&nbsp;writing,&nbsp;software</span>
<!--  --><br/><span class="java_plain">&nbsp;*&nbsp;distributed&nbsp;under&nbsp;the&nbsp;License&nbsp;is&nbsp;distributed&nbsp;on&nbsp;an&nbsp;&quot;AS&nbsp;IS&quot;&nbsp;BASIS,</span>
<!--  --><br/><span class="java_plain">&nbsp;*&nbsp;WITHOUT&nbsp;WARRANTIES&nbsp;OR&nbsp;CONDITIONS&nbsp;OF&nbsp;ANY&nbsp;KIND,&nbsp;either&nbsp;express&nbsp;or&nbsp;implied.</span>
<!--  --><br/><span class="java_plain">&nbsp;*&nbsp;See&nbsp;the&nbsp;License&nbsp;for&nbsp;the&nbsp;specific&nbsp;language&nbsp;governing&nbsp;permissions&nbsp;and</span>
<!--  --><br/><span class="java_plain">&nbsp;*&nbsp;limitations&nbsp;under&nbsp;the&nbsp;License.</span>
<!--  --><br/><span class="java_plain">&nbsp;*</span>
<!--  --><br/><span class="java_plain">&nbsp;*&nbsp;Created&nbsp;on&nbsp;Jun&nbsp;21,&nbsp;2007</span>
<!--  --><br/><span class="java_comment">&nbsp;*/</span>
<!--  --><br/><span class="java_keyword">package</span><span class="java_plain">&nbsp;org</span><span class="java_separator">.</span><span class="java_plain">drools</span><span class="java_separator">.</span><span class="java_plain">base</span><span class="java_separator">.</span><span class="java_plain">accumulators</span><span class="java_separator">;</span>
</span>
</span>
<!--  --><br/><span class="java_javadoc_comment">/**</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;*&nbsp;An&nbsp;implementation&nbsp;of&nbsp;an&nbsp;accumulator&nbsp;capable&nbsp;of&nbsp;calculating&nbsp;average&nbsp;values</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;*/</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">AverageAccumulateFunction</span><span class="java_plain">&nbsp;</span><span class="java_keyword">implements</span><span class="java_plain">&nbsp;</span><span class="java_type">AccumulateFunction</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">protected</span><span class="java_plain">&nbsp;</span><span class="java_keyword">static</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">AverageData</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;count&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">0</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">double</span><span class="java_plain">&nbsp;total&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">0</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_comment">/*</span><span class="java_plain">&nbsp;(non-Javadoc)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@see&nbsp;org.drools.base.accumulators.AccumulateFunction#createContext()</span>
<!--  --><br/><span class="java_comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Object</span><span class="java_plain">&nbsp;createContext</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">AverageData</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_comment">/*</span><span class="java_plain">&nbsp;(non-Javadoc)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@see&nbsp;org.drools.base.accumulators.AccumulateFunction#init(java.lang.Object)</span>
<!--  --><br/><span class="java_comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;init</span><span class="java_separator">(</span><span class="java_type">Object</span><span class="java_plain">&nbsp;context</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_keyword">throws</span><span class="java_plain">&nbsp;</span><span class="java_type">Exception</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">AverageData</span><span class="java_plain">&nbsp;data&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">AverageData</span><span class="java_separator">)</span><span class="java_plain">&nbsp;context</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data</span><span class="java_separator">.</span><span class="java_plain">count&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">0</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data</span><span class="java_separator">.</span><span class="java_plain">total&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">0</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_comment">/*</span><span class="java_plain">&nbsp;(non-Javadoc)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@see&nbsp;org.drools.base.accumulators.AccumulateFunction#accumulate(java.lang.Object,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;java.lang.Object)</span>
<!--  --><br/><span class="java_comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;accumulate</span><span class="java_separator">(</span><span class="java_type">Object</span><span class="java_plain">&nbsp;context</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Object</span><span class="java_plain">&nbsp;value</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">AverageData</span><span class="java_plain">&nbsp;data&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">AverageData</span><span class="java_separator">)</span><span class="java_plain">&nbsp;context</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data</span><span class="java_separator">.</span><span class="java_plain">count</span><span class="java_operator">++</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data</span><span class="java_separator">.</span><span class="java_plain">total&nbsp;</span><span class="java_operator">+=</span><span class="java_plain">&nbsp;</span><span class="java_separator">((</span><span class="java_type">Number</span><span class="java_separator">)</span><span class="java_plain">&nbsp;value</span><span class="java_separator">).</span><span class="java_plain">doubleValue</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_comment">/*</span><span class="java_plain">&nbsp;(non-Javadoc)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@see&nbsp;org.drools.base.accumulators.AccumulateFunction#reverse(java.lang.Object,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;java.lang.Object)</span>
<!--  --><br/><span class="java_comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;reverse</span><span class="java_separator">(</span><span class="java_type">Object</span><span class="java_plain">&nbsp;context</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Object</span><span class="java_plain">&nbsp;value</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_keyword">throws</span><span class="java_plain">&nbsp;</span><span class="java_type">Exception</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">AverageData</span><span class="java_plain">&nbsp;data&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">AverageData</span><span class="java_separator">)</span><span class="java_plain">&nbsp;context</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data</span><span class="java_separator">.</span><span class="java_plain">count</span><span class="java_operator">--</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data</span><span class="java_separator">.</span><span class="java_plain">total&nbsp;</span><span class="java_operator">-=</span><span class="java_plain">&nbsp;</span><span class="java_separator">((</span><span class="java_type">Number</span><span class="java_separator">)</span><span class="java_plain">&nbsp;value</span><span class="java_separator">).</span><span class="java_plain">doubleValue</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_comment">/*</span><span class="java_plain">&nbsp;(non-Javadoc)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@see&nbsp;org.drools.base.accumulators.AccumulateFunction#getResult(java.lang.Object)</span>
<!--  --><br/><span class="java_comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Object</span><span class="java_plain">&nbsp;getResult</span><span class="java_separator">(</span><span class="java_type">Object</span><span class="java_plain">&nbsp;context</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_keyword">throws</span><span class="java_plain">&nbsp;</span><span class="java_type">Exception</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">AverageData</span><span class="java_plain">&nbsp;data&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">AverageData</span><span class="java_separator">)</span><span class="java_plain">&nbsp;context</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">Double</span><span class="java_separator">(</span><span class="java_plain">&nbsp;data</span><span class="java_separator">.</span><span class="java_plain">count&nbsp;</span><span class="java_operator">==</span><span class="java_plain">&nbsp;</span><span class="java_literal">0</span><span class="java_plain">&nbsp;</span><span class="java_operator">?</span><span class="java_plain">&nbsp;</span><span class="java_literal">0</span><span class="java_plain">&nbsp;</span><span class="java_operator">:</span><span class="java_plain">&nbsp;data</span><span class="java_separator">.</span><span class="java_plain">total&nbsp;</span><span class="java_operator">/</span><span class="java_plain">&nbsp;data</span><span class="java_separator">.</span><span class="java_plain">count&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_comment">/*</span><span class="java_plain">&nbsp;(non-Javadoc)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@see&nbsp;org.drools.base.accumulators.AccumulateFunction#supportsReverse()</span>
<!--  --><br/><span class="java_comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">boolean</span><span class="java_plain">&nbsp;supportsReverse</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;</span><span class="java_literal">true</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_separator">}</span>
</pre><p>The code for the function is very simple, as we could expect, as
        all the "dirty" integration work is done by the engine. Finally, to
        plug the function into the engine, we added it to the configuration
        file:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">drools.accumulate.function.average =
   org.drools.base.accumulators.AverageAccumulateFunction
</pre><p>Here, "drools.accumulate.function." is a prefix that must always
        be used, "average" is how the function will be used in the rule file,
        and "org.drools.base.accumulators.AverageAccumulateFunction" is the
        fully qualified name of the class that implements the function
        behavior.</p></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e5321"/>5.8.4. The Right Hand Side (then)</h3></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e5324"/>5.8.4.1. Usage</h4></div></div></div><p>The Right Hand Side (RHS) is a common name for the consequence or
      action part of the rule; this part should contain a list of actions to
      be executed. It is bad practice to use imperative or conditional code in
      the RHS of a rule; as a rule should be atomic in nature - "when this,
      then do this", not "when this, maybe do this". The RHS part of a rule
      should also be kept small, thus keeping it declarative and readable. If
      you find you need imperative and/or conditional code in the RHS, then
      maybe you should be breaking that rule down into multiple rules. The
      main purpose of the RHS is to insert, retractor modify working memory
      data. To assist with that there are a few convenience methods you can
      use to modify working memory; without having to first reference a
      working memory instance.</p><p><code class="literal">update(</code><span class="emphasis"><em>object,
      handle</em></span><code class="literal">);</code> will tell the engine that an
      object has changed (one that has been bound to something on the LHS) and
      rules may need to be reconsidered.</p><p><code class="literal">update(</code><span class="emphasis"><em>object</em></span><code class="literal">);</code>
      can also be used; here the Knowledge Helper will look up the facthandle
      for you, via an identity check, for the passed object. (Note that if you
      provide Property Change Listeners to your Java beans that you are
      inserting into the engine, you can avoid the need to call
      <code class="code">update()</code> when the object changes.)</p><p><code class="literal">insert(new</code>
      <span class="emphasis"><em>Something</em></span><code class="literal">());</code> will place a new
      object of your creation into the Working Memory.</p><p><code class="literal">insertLogical(new</code>
      <span class="emphasis"><em>Something</em></span><code class="literal">());</code> is similar to
      insert, but the object will be automatically retracted when there are no
      more facts to support the truth of the currently firing rule.</p><p><code class="literal">retract(</code><span class="emphasis"><em>handle</em></span><code class="literal">);</code>
      removes an object from Working Memory.</p><p>These convenience methods are basically macros that provide short
      cuts to the <code class="code">KnowledgeHelper</code> instance that lets you access
      your Working Memory from rules files. The predefined variable
      <code class="code">drools</code> of type <code class="code">KnowledgeHelper</code> lets you call
      several other useful methods. (Refer to the <code class="code">KnowledgeHelper</code>
      interface documentation for more advanced operations).</p><div class="itemizedlist"><ul><li><p>The call <code class="code">drools.halt()</code> terminates rule execution
          immediately. This is required for returning control to the point
          whence the current session was put to work with
          <code class="code">fireUntilHalt()</code>.</p></li><li><p>Methods <code class="code">insert(Object o)</code>, <code class="code">update(Object
          o)</code> and <code class="code">retract(Object o)</code> can be called on
          <code class="code">drools</code> as well, but due to their frequent use they can
          be called without the object reference.</p></li><li><p><code class="code">drools.getWorkingMemory()</code> returns the
          <code class="code">WorkingMemory</code> object.</p></li><li><p><code class="code">drools.setFocus( String s)</code> sets the focus to the
          specified agenda group.</p></li><li><p><code class="code">drools.getRule().getName()</code>, called from a rule's
          RHS, returns the name of the rule.</p></li><li><p><code class="code">drools.getTuple()</code> returns the Tuple that matches
          the currently executing rule, and
          <code class="code">drools.getActivation()</code> delivers the corresponding
          Activation. (These calls are useful for logging and debugging
          purposes.)</p></li></ul></div><p>The full Knowlege Runtime API is exposed through another
      predefined variable, <code class="code">kcontext</code>, of type
      <code class="code">KnowledgeContext</code>. Its method
      <code class="code">getKnowledgeRuntime()</code> delivers an object of type
      <code class="code">KnowledgeRuntime</code>, which, in turn, provides access to a
      wealth of methods, many of which are quite useful for coding RHS
      logic.</p><div class="itemizedlist"><ul><li><p>The call <code class="code">kcontext.getKnowledgeRuntime().halt()</code>
          terminates rule execution immediately.</p></li><li><p>The accessor <code class="code">getAgenda()</code> returns a reference to
          this session's <code class="code">Agenda</code>, which in turn provides access to
          the various rule groups: activation groups, agenda groups, and rule
          flow groups. A fairly common paradigm is the activation of some
          agenda group, which could be done with the lengthy call:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"></span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;give&nbsp;focus&nbsp;to&nbsp;the&nbsp;agenda&nbsp;group&nbsp;</span><span class="java_type">CleanUp</span>
<!--  --><br/><span class="java_plain">kcontext</span><span class="java_separator">.</span><span class="java_plain">getKnowledgeRuntime</span><span class="java_separator">().</span><span class="java_plain">getAgenda</span><span class="java_separator">().</span><span class="java_plain">getAgendaGroup</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;CleanUp&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">).</span><span class="java_plain">setFocus</span><span class="java_separator">();</span></pre><p>(You can achieve the same using <code class="code">drools.setFocus(
          "CleanUp" )</code>.)</p></li><li><p>To run a query, you call <code class="code">getQueryResults(String
          query)</code>, whereupon you may process the results, as explained
          in section “<span class="quote"><a class="link" href="">Query</a></span>”.</p></li><li><p>A set of methods dealing with event management lets you, among
          other things, add and remove event listeners for the Working Memory
          and the Agenda.</p></li><li><p>Method<code class="code">getKnowledgeBase()</code> returns the
          <code class="code">KnowledgeBase</code> object, the backbone of all the Knowledge
          in your system, and the originator of the current session.</p></li><li><p>You can manage globals with <code class="code">setGlobal(...)</code>,
          <code class="code">getGlobal(...)</code> and <code class="code">getGlobals()</code>.</p></li><li><p>Method <code class="code">getEnvironment()</code> returns the runtime's
          <code class="code">Environment</code> which works much like what you know as your
          operating system's environment.</p></li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e5518"/>5.8.4.2. The <code class="literal">modify</code> Statement</h4></div></div></div><p>This language extension provides a structured approach to fact
      updates. It combines the update operation with a number of setter calls
      to change the object's fields. This is the syntax schema for the
      <code class="literal">modify</code> statement:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class=""><code xmlns="http://www.w3.org/1999/xhtml" class="literal">modify ( </code><em xmlns="http://www.w3.org/1999/xhtml" class="replaceable"><code>&lt;fact-expression&gt;</code></em><code xmlns="http://www.w3.org/1999/xhtml" class="literal"> ) {</code>
    <em xmlns="http://www.w3.org/1999/xhtml" class="replaceable"><code>&lt;expression&gt;</code></em> [ <code xmlns="http://www.w3.org/1999/xhtml" class="literal">,</code> <em xmlns="http://www.w3.org/1999/xhtml" class="replaceable"><code>&lt;expression&gt;</code></em> ]*
<code xmlns="http://www.w3.org/1999/xhtml" class="literal">}</code></pre><p>The parenthesized <span class="emphasis"><em>&lt;fact-expression&gt;</em></span>
      must yield a fact object reference. The expression list in the block
      should consist of setter calls for the given object, to be written
      without the usual object reference, which is automatically prepended by
      the compiler.</p><p>The example illustrates a simple fact modification.</p><div class="example"><a id="d0e5555"/><p class="title"><b>Example 5.71. A modify statement</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">rule "modify stilton"
when
    $stilton : Cheese(type == "stilton")
then
    modify( $stilton ){
        setPrice( 20 ),
        setAge( "overripe" )
    }
end</pre></div></div><br class="example-break"/></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e5560"/>5.8.5. A Note on Auto-boxing and Primitive Types</h3></div></div></div><p>Drools attempts to preserve numbers in their primitive or object
    wrapper form, so a variable bound to an int primitive when used in a code
    block or expression will no longer need manual unboxing; unlike Drools 3.0
    where all primitives were autoboxed, requiring manual unboxing. A variable
    bound to an object wrapper will remain as an object; the existing JDK 1.5
    and JDK 5 rules to handle auto-boxing and unboxing apply in this case.
    When evaluating field constraints, the system attempts to coerce one of
    the values into a comparable format; so a primitive is comparable to an
    object wrapper.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e5565"/>5.9. Query</h2></div></div></div><div class="figure"><a id="d0e5568"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Rule_Language/query.png" align="middle" alt="query"/></div></div><p class="title"><b>Figure 5.44. query</b></p></div><br class="figure-break"/><p>A query is a simple way to search the working memory for facts that
  match the stated conditions. Therefore, it contains only the structure of
  the LHS of a rule, so that you specify neither "when" nor "then". A query
  has an optional set of parameters, each of which can be optionally typed. If
  the type is not given, the type Object is assumed. The engine will attempt
  to coerce the values as needed. Query names are global to the KnowledgeBase;
  so do not add queries of the same name to different packages for the same
  RuleBase.</p><p>To return the results use
  <code class="code">ksession.getQueryResults("name")</code>, where "name" is the query's
  name. This returns a list of query results, which allow you to retrieve the
  objects that matched the query.</p><p>The first example presents a simple query for all the people over the
  age of 30. The second one, using parameters, combines the age limit with a
  location.</p><div class="example"><a id="d0e5583"/><p class="title"><b>Example 5.72. Query People over the age of 30</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">query "people over the age of 30" 
    person : Person( age &gt; 30 )
end</pre></div></div><br class="example-break"/><div class="example"><a id="d0e5588"/><p class="title"><b>Example 5.73. Query People over the age of x, and who live in y</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">query "people over the age of x"  (int x, String y)
    person : Person( age &gt; x, location == y )
end</pre></div></div><br class="example-break"/><p>We iterate over the returned QueryResults using a standard "for" loop.
  Each element is a QueryResultsRow which we can use to access each of the
  columns in the tuple. These columns can be accessed by bound declaration
  name or index position.</p><div class="example"><a id="d0e5595"/><p class="title"><b>Example 5.74. Query People over the age of 30</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">QueryResults results = ksession.getQueryResults( "people over the age of 30" );
System.out.println( "we have " + results.size() + " people over the age  of 30" );

System.out.println( "These people are are over 30:" );

for ( QueryResultsRow row : results ) {
    Person person = ( Person ) row.get( "person" );
    System.out.println( person.getName() + "\n" );
}</pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e5600"/>5.10. Domain Specific Languages</h2></div></div></div><p><a id="d0e5604" class="indexterm"/>Domain Specific Languages (or DSLs) are a way of creating a rule
  language that is dedicated to your problem domain. A set of DSL definitions
  consists of transformations from DSL "sentences" to DRL constructs, which lets
  you use of all the underlying rule language and engine features. Given a
  DSL, you write rules in DSL rule (or DSLR) files, which will be translated
  into DRL files.</p><p>DSL and DSLR files are plain text files, and you can use any text
  editor to create and modify them. But there are also DSL and DSLR editors,
  both in the IDE as well as in the web based BRMS, and you can use those
  as well, although they may not provide you with the full DSL functionality.
  </p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e5610"/>5.10.1. When to Use a DSL</h3></div></div></div><p>DSLs can serve as a layer of separation between rule authoring (and
    rule authors) and the technical intricacies resulting from the modelling
    of domain object and the rule engine's native language and methods. If your
    rules need to be read and validated by domain experts (such as business
    analysts, for instance) who are not programmers, you should consider 
    using a DSL; it hides implementation details and focuses on the rule logic
    proper. DSL sentences can also act as "templates" for conditional elements and
    consequence actions that are used repeatedly in your rules, possibly with
    minor variations. You may define DSL sentences as being mapped to these
    repeated phrases, with parameters providing a means for accomodating those
    variations.</p><p>DSLs have no impact on the rule engine at runtime, they are just a
    compile time feature, requiring a special parser and transformer.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e5617"/>5.10.2. DSL Basics</h3></div></div></div><p>The Drools DSL mechanism allows you to customise conditional
    expressions and consequence actions. A global substitution mechanism
    ("keyword") is also available.</p><div class="example"><a id="d0e5622"/><p class="title"><b>Example 5.75. Example <a id="d0e5625" class="indexterm"/>DSL mapping</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">[when]Something is {colour}=Something(colour=="{colour}")</pre></div></div><br class="example-break"/><p>In the preceding example, <code class="code">[when]</code> indicates the scope of
    the expression, i.e., whether it is valid for the LHS or the RHS of a rule. The
    part after the bracketed keyword is the expression that you use in the rule;
    typically a natural language expression, but it doesn't have to be. The
    part to the right of the equal sign ("=") is the mapping of the expression into
    the rule language. The form of this string depends on its destination, RHS or 
    LHS. If it is for the LHS, then it ought to be a term according to the regular
    LHS syntax; if it is for the RHS then it might be a Java statement.</p><p>Whenever the DSL parser matches a line from the rule file written in the
    DSL with an expression in the DSL definition, it performs three steps of
    string manipulation. First, it extracts the string values appearing where the
    expression contains variable names in braces (here: <code class="code">{colour}</code>). Then,
    the values obtained from these captures are then interpolated wherever that name,
    again enclosed in braces, occurs on the right hand side of the mapping. Finally, the
    interpolated string replaces whatever was matched by the entire expression
    in the line of the DSL rule file.</p><p>Note that the expressions (i.e., the strings on the left hand side of the
    equal sign) are used as regular expressions in a pattern matching operation
    against a line of the DSL rule file, matching all or part of a line. This means
    you can use (for instance) a '?' to indicate that the preceding character is
    optional. One good reason to use this is to overcome variations in natural language
    phrases of your DSL. But, given that these expressions are regular
    expression patterns, this also means that all "magic" characters of Java's
    pattern syntax have to be escaped with a preceding backslash ('\').</p><p>It is important to note that the compiler transforms DSL rule files
    line by line. In the above example, all the text after "Something is " to
    the end of the line is captured as the replacement value for "{colour}",
    and this is used for interpolating the target string. This may not be exactly
    what you want. For instance, when you intend to merge different DSL
    expressions to generate a composite DRL pattern, you need to transform a DSLR
    line in several independent operations. The best way to achieve this is to
    ensure that the captures are surrounded by characteristic text - words or 
    even single characters. As a result,
    the matching operation done by the parser plucks out a substring from 
    somewhere within the line. In the example below, quotes are used as 
    distinctive characters. Note that the characters that surround the capture
    are not included during interpolation, just the contents between them.</p><p>As a rule of thumb, use quotes for textual data that a rule editor
    may want to enter. You can also enclose the capture with words to ensure
    that the text is correctly matched. Both is illustrated by the following
    example. Note that a single line such as <code class="code">Something is "green" and
    another solid thing</code> is now correctly expanded.</p><div class="example"><a id="d0e5651"/><p class="title"><b>Example 5.76. Example with quotes</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">[when]something is "{colour}"=Something(colour=="{colour}")
[when]another {state} thing=OtherThing(state=="{state}"</pre></div></div><br class="example-break"/><p>It is a good idea to avoid punctuation (other than quotes or
    apostrophes) in your DSL expressions as much as possible. The main reason
    is that punctuation is easy to forget for rule authors using your DSL.
    Another reason is that parentheses, the period and the question mark are magic
    characters, requiring escaping in the DSL definition.</p><p>In a DSL mapping, the braces "{" and "}" should only be used to
    enclose a variable definition or reference, resulting in a capture. If they
    should occur literally, either in the expression or within the replacement
    text on the right hand side, they must be escaped with a preceding backslash
    ("\"):</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">[then]do something= if (foo) \{ doSomething(); \}
    </pre><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>If braces "{" and "}" should appear in the replacement string of a
    DSL definition, escape them with a backslash ('\').</p></div><div class="example"><a id="d0e5665"/><p class="title"><b>Example 5.77. Examples of DSL mapping entries</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class=""># This is a comment to be ignored.
[when]There is a person with name of "{name}"=Person(name=="{name}")
[when]Person is at least {age} years old and lives in "{location}"=
      Person(age &gt;= {age}, location=="{location}")
[then]Log "{message}"=System.out.println("{message}");
[when]And = and</pre></div></div><br class="example-break"/><p>Given the above DSL examples, the following examples show the expansion of various
    DSLR snippets:</p><div class="example"><a id="d0e5672"/><p class="title"><b>Example 5.78. Examples of DSL expansions </b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">There is a person with name of "Kitty"
   ==&gt; Person(name="Kitty")
Person is at least 42 years old and lives in "Atlanta"
   ==&gt; Person(age &gt;= 42, location="Atlanta")
Log "boo"
   ==&gt; System.out.println("boo");
There is a person with name of "Bob" and Person is at least 30 years old and lives in "Utah"
   ==&gt; Person(name="Bob") and Person(age &gt;= 30, location="Utah")</pre></div></div><br class="example-break"/><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>Don't forget that if you are capturing plain text from a DSL rule line
    and want to use it as a string literal in the expansion, you must provide
    the quotes on the right hand side of the mapping.</p></div><p>You can chain DSL expressions together on one line, as long as it is
    clear to the parser where one ends and the next one begins and where the
    text representing a parameter ends. (Otherwise you risk getting all the
    text until the end of the line as a parameter value.) The DSL expressions are
    tried, one after the other, according to their order in the DSL definition
    file. After any match, all remaining DSL expressions are investigated,
    too.</p><p>The resulting DRL text may consist of more than one line. Line ends
    are in the replacement text are written as <code class="code">\n</code>.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e5687"/>5.10.3. Adding Constraints to Facts</h3></div></div></div><p>A common requirement when writing rule conditions is to be able to
    add an arbitrary combination of constraints to a pattern. Given that a
    fact type may have many fields, having to provide an individual DSL
    statement for each combination would be plain folly.</p><p>The DSL facility allows you to add constraints to a pattern by a
    simple convention: if your DSL expression starts with a hyphen
    (minus character, "-") it is assumed to be a field constraint and,
    consequently, is is added to the last pattern line preceding it.</p><p>For an example, lets take look at class <code class="code">Cheese</code>,
    with the following fields: type, price, age and country. We can
    express some LHS condition in normal DRL like the following</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Cheese(age &lt; 5, price == 20, type=="stilton", country=="ch")</pre><p>The DSL definitions given below result in three DSL phrases which
    may be used to create any combination of constraint involving these fields.</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">[when]There is a Cheese with=Cheese()
[when]- age is less than {age}=age&lt;{age}
[when]- type is '{type}'=type=='{type}'
[when]- country equal to '{country}'=country=='{country}'</pre><p>You can then write rules with conditions like the following:
    </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">There is a Cheese with
        - age is less than 42
        - type is 'stilton'</pre><p> The parser will pick up a line
    beginning with "-" and add it as a constraint to  the preceding pattern,
    inserting a comma when it is required. For the preceding example, the
    resulting DRL is: </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Cheese(age&lt;42, type=='stilton')</pre><p>
    </p><p>Combining all all numeric fields with all relational operators
    (according to the DSL expression "age is less than..." in the preceding
    example) produces an unwieldy amount of DSL entries. But you can define
    DSL phrases for the various operators and even a generic expression
    that handles any field constraint, as shown below. (Notice that
    the expression definition contains a regular expression in addition
    to the variable name.)</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">[when][]is less than or equal to=&lt;=
[when][]is less than=&lt;
[when][]is greater than or equal to=&gt;=
[when][]is greater than=&gt;
[when][]is equal to===
[when][]equals===
[when][]There is a Cheese with=Cheese()</pre>
[when][]- {field:\w*} {operator} {value:\d*}={field} {operator} {value} 

    <p>Given these DSL definitions, you can write rules with conditions
    such as:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">There is a Cheese with
   - age is less than 42
   - rating is greater than 50
   - type equals 'stilton'</pre><p>In this specific case, a phrase such as "is less than" is replaced by
    <code class="code">&lt;</code>, and then the line matches the last DSL entry. This
    removes the hyphen, but the final result is still added as a constraint
    to the preceding pattern. After processing all of the lines, the resulting
    DRL text is:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Cheese(age&lt;42, rating &gt; 50, type=='stilton')</pre><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>The order of the entries in the DSL is important if separate DSL
    expressions are intended to match the same line, one after the other.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e5732"/>5.10.4. Developing a DSL</h3></div></div></div><p>A good way to get started is to write representative samples of the
    rules your application requires, and to test them as you develop. This will
    provide you with a stable framework of conditional elements and their
    constraints. Rules, both in DRL and in DSLR, refer to entities according
    to the data model representing the application data that should be subject
    to the reasoning process defined in rules. Notice that writing rules
    is generally easier if most of the data model's types are facts.</p><p>Given an initial set of rules, it should be possible to identify
    recurring or similar code snippets and to mark variable parts as
    parameters. This provides reliable leads as to what might be a handy
    DSL entry. Also, make sure you have a full grasp of the jargon the 
    domain experts are using, and base your DSL phrases on this vocabulary.</p><p>You may postpone implementation decisions concerning conditions
    and actions during this first design phase by leaving certain conditional
    elements and actions in their DRL form by prefixing a line with a
    greater sign ("&gt;"). (This is also handy for inserting debugging
    statements.)</p><p>During the next development phase, you should find that the DSL
    configuration stabilizes pretty quickly. New rules can be written by
    reusing the existing DSL definitions, or by adding a parameter to an
    existing condition or consequence entry.</p><p>Try to keep the number of DSL entries small. Using parameters
    lets you apply the same DSL sentence for similar rule patterns or
    constraints. But do not exaggerate: authors using the DSL should still
    be able to identify DSL phrases by some fixed text.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e5745"/>5.10.5. DSL and DSLR Reference</h3></div></div></div><p>A DSL file is a text file in a line-oriented format. Its
    entries are used for transforming a DSLR file into a file according
    to DRL syntax.</p><div class="itemizedlist"><ul><li><p>A line starting with "#" or "//"
        (with or without preceding white space) is treated as a comment.
        A comment line starting with "#/" is scanned for
        words requesting a debug option, see below.</p></li><li><p>Any line starting with an opening bracket ("[") is assumed to
        be the first line of a DSL entry definition.</p></li><li><p>Any other line is appended to the preceding DSL entry
        definition, with the line end replaced by a space.</p></li></ul></div><p>A DSL entry consists of the following four parts:</p><div class="itemizedlist"><ul><li><p>A scope definition, written as one of the keywords
        "when" or "condition", "then" or "consequence", "*"
        and "keyword", enclosed in brackets ("[" and "]"). This indicates
        whether the DSL entry is valid for the condition or the
        consequence of a rule, or both. A scope indication of "keyword"
        means that the entry has global significance, i.e., it is
        recognized anywhere in a DSLR file.</p></li><li><p>A type definition, written as a Java class name,
        enclosed in brackets. This part is optional unless the
        the next part begins with an opening bracket. An empty
        pair of brackets is valid, too.</p></li><li><p>A DSL expression consists of a (Java) regular expression,
        with any number of embedded <span class="emphasis"><em>variable definitions,</em></span>
        terminated by an equal sign ("="). A variable definition is enclosed
        in braces ("{" and "}"). It
        consists of a variable name and two optional attachements, separated
        by colons (":"). If there is one attachment, it is a regular expression
        for matching text that is to be assigned to the variable; if there
        are two attachments, the first one is a hint for the GUI
        editor and the second one the regular expression.</p><p>Note that all characters that are "magic" in regular
        expressions must be escaped with a preceding backslash ("\")
        if they should occur literally within the expression.</p></li><li><p>The remaining part of the line after the delimiting equal
        sign is the replacement text for any DSLR text matching the
        regular expression. It may contain variable references, i.e.,
        a variable name enclosed in braces. Optionally, the variable name
        may be followed by an exclamation mark ("!") and a transformation
        function, see below.</p><p>Note that braces ("{" and "}") must be escaped with a
        preceding backslash ("\") if they should occur literally
        within the replacement string.</p></li></ul></div><p>Debugging of DSL expansion can be turned on, selectively,
    by using a comment line starting with "#/" which
    may contain one or more words from the table presented below.
    The resulting output is written to standard output.</p><div class="table"><a id="d0e5784"/><p class="title"><b>Table 5.1. Debug options for DSL expansion</b></p><div class="table-contents"><table summary="Debug options for DSL expansion" border="1"><colgroup><col/><col/></colgroup><thead><tr><th>Word</th><th>Description</th></tr></thead><tbody><tr><td>result</td><td>Prints the resulting DRL text, with line numbers.</td></tr><tr><td>steps</td><td>Prints each expansion step of condition and consequence
            lines.</td></tr><tr><td>keyword</td><td>Dumps the internal representation of all DSL entries with
            scope "keyword".</td></tr><tr><td>when</td><td>Dumps the internal representation of all DSL entries with
            scope "when" or "*".</td></tr><tr><td>then</td><td>Dumps the internal representation of all DSL entries with
            scope "then" or "*".</td></tr><tr><td>usage</td><td>Displays a usage statistic of all DSL entries.</td></tr></tbody></table></div></div><br class="table-break"/><p>Below are some sample DSL definitions, with comments describing the
    language features they illustrate.</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class=""># Comment: DSL examples

#/ debug: display result and usage

# keyword definition: replaces "regula" by "rule"
[keyword][]regula=rule

# conditional element: "T" or "t", "a" or "an", convert matched word
[when][][Tt]here is an? {entity:\w+}=
        ${entity!lc}: ${entity!ucfirst} ()

# consequence statement: convert matched word, literal braces
[then][]update {entity:\w+}=modify( ${entity!lc} )\{ \}
</pre><p>The transformation of a DSLR file proceeds as follows:</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>The text is read into memory.</p></li><li><p>Each of the "keyword" entries is applied to the entire text.
        First, the regular expression from the keyword definition is modified
        by replacing white space sequences with a pattern matching any number
        of white space characters, and by replacing variable definitions with
        a capture made from the regular expression provided with the definition,
        or with the default (".*?"). Then, the DSLR text is searched exhaustively
        for occurrences of strings matching the modified regular expression.
        Substrings of a matching string corresponding to variable captures are
        extracted and replace variable references in the corresponding
        replacement text, and this text replaces the matching string in the
        DSLR text.</p></li><li><p>Sections of the DSLR text between "when" and "then", and
        "then" and "end", respectively, are located and processed in a
        uniform manner, line by line, as described below.</p><p>For a line, each DSL entry pertaining to the line's section
        is taken in turn, in the order it appears in the DSL file. Its
        regular expression part is modified: white space is replaced by
        a pattern matching any number of white space characters; variable
        definitions with a regular expression are replaced by a capture
        with this regular expression, its default being ".*?".
        If the resulting regular expression matches all or part of the
        line, the matched part is replaced by the suitably modified
        replacement text.</p><p>Modification of the replacement text is done by replacing
        variable references with the text corresponding to the regular
        expression capture. This text may be modified according to the
        string transformation function given in the variable reference;
        see below for details.</p><p>If there is a variable reference naming a variable that is not
        defined in the same entry, the expander substitutes a value bound to
        a variable of that name, provided it was defined in one of the
        preceding lines of the current rule.</p></li><li><p>If a DSLR line in a condition is written with a leading
        hyphen, the expanded result is inserted into the last line, which
        should contain a pattern CE, i.e., a type name followed by a pair
        of parentheses. if this pair is empty, the expanded line (which
        should contain a valid constraint) is simply inserted, otherwise
        a comma (",") is inserted beforehand.  </p><p>If a DSLR line in a consequence is written with a leading
        hyphen, the expanded result is inserted into the last line, which
        should contain a "modify" statement, ending in a pair of braces
        ("{" and "}"). If this pair is empty, the expanded line (which
        should contain a valid method call) is simply inserted, otherwise
        a comma (",") is inserted beforehand.
        </p></li></ol></div><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>It is currently <span class="emphasis"><em>not</em></span> possible to use a line
    with a leading hyphen to insert text into other conditional element
    forms (e.g., "accumulate") or it may only work for the first insertion
    (e.g., "eval").</p></div><p>All string transformation functions are described in the following
    table.</p><div class="table"><a id="d0e5860"/><p class="title"><b>Table 5.2. String transformation functions</b></p><div class="table-contents"><table summary="String transformation functions" border="1"><colgroup><col/><col/></colgroup><thead><tr><th>Name</th><th>Description</th></tr></thead><tbody><tr><td>uc</td><td>Converts all letters to upper case.</td></tr><tr><td>lc</td><td>Converts all letters to lower case.</td></tr><tr><td>ucfirst</td><td>Converts the first letter to upper case, and
            all other letters to lower case.</td></tr><tr><td>num</td><td>Extracts all digits and "-" from the string. If the
            last two digits in the original string are preceded by "." or
            ",", a decimal period is inserted in the corresponding position.</td></tr><tr><td><span class="emphasis"><em>a</em></span>?<span class="emphasis"><em>b</em></span>/<span class="emphasis"><em>c</em></span></td><td>Compares the string with string <span class="emphasis"><em>a</em></span>, and if they
            are equal, replaces it with <span class="emphasis"><em>b</em></span>, otherwise with
            <span class="emphasis"><em>c</em></span>. But <span class="emphasis"><em>c</em></span> can be another triplet
            <span class="emphasis"><em>a</em></span>, <span class="emphasis"><em>b</em></span>, <span class="emphasis"><em>c</em></span>, so
            that the entire structure is, in fact, a translation table.</td></tr></tbody></table></div></div><br class="table-break"/><p>The following DSL examples show how to use string transformation functions.</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class=""># definitions for conditions
[when][]There is an? {entity}=${entity!lc}: {entity!ucfirst}()
[when][]- with an? {attr} greater than {amount}={attr} &lt;= {amount!num}
[when][]- with a {what} {attr}={attr} {what!positive?&gt;0/negative?%lt;0/zero?==0/ERROR}</pre><p>A file containing a DSL definition is customarily given the extension
    <code class="code">.dsl</code>. It is passed to the Knowledge Builder with 
    <code class="code">ResourceType.DSL</code>. For a file using DSL definition, the extension
    <code class="code">.dslr</code> should be used. The Knowledge Builder expects
    <code class="code">ResourceType.DSLR</code>. The IDE, however, relies on file extensions
    to correctly recognize and work with your rules file.</p><p>The DSL must be passed to the Knowledge Builder ahead of any rules
    file using the DSL.</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">KnowledgeBuilder kBuilder = new KnowledgeBuilder();
Resource dsl = ResourceFactory.newClassPathResource( dslPath, getClass() );
kBuilder.add( dsl, ResourceType.DSL );
Resource dslr = ResourceFactory.newClassPathResource( dslrPath, getClass() );
kBuilder.add( dslr, ResourceType.DSLR );
</pre><p>For parsing and expanding a DSLR file the DSL configuration is read
    and supplied to the parser. Thus, the parser can "recognize" the DSL
    expressions and transform them into native rule language expressions.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e5948"/>5.11. XML Rule Language</h2></div></div></div><p>As an option, Drools also supports a "native" <a id="d0e5953" class="indexterm"/> rule language as an alternative to DRL. This allows you to
  capture and manage your rules as XML data. Just like the non-XML DRL format,
  the XML format is parsed into the internal "AST" representation - as fast as
  possible (using a SAX parser). There is no external transformation step
  required. All the features are available with XML that are available to
  DRL.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e5957"/>5.11.1. When to use XML</h3></div></div></div><p>There are several scenarios that XML is desirable. However, we
    recommend that it is not a default choice, as XML is not readily human
    readable (unless you like headaches) and can create visually bloated
    rules.</p><p>If you do want to edit XML by hand, use a good schema aware editor
    that provides nice hierarchical views of the XML, ideally visually
    (commercial tools like XMLSpy, Oxygen etc are good, but cost money, but
    then so do headache tablets).</p><p>Other scenarios where you may want to use the XML format are if you
    have a tool that generates rules from some input (programmatically
    generated rules), or perhaps interchange from another rule language, or
    from another tool that emits XML (using XSLT you can easily transform
    between XML formats). Note you can always generate normal DRL as
    well.</p><p>Alternatively you may be embedding Drools in a product that already
    uses XML for configuration, so you would like the rules to be in an XML
    format. You may be creating your own rule language on XML - note that you
    can always use the AST objects directly to create your own rule language
    as well (the options are many, due to the open architecture).</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e5968"/>5.11.2. The XML format</h3></div></div></div><p>A full W3C standards (XMLSchema) compliant XSD is provided that
    describes the XML language, which will not be repeated here verbatim. A
    summary of the language follows.</p><div class="example"><a id="d0e5973"/><p class="title"><b>Example 5.79. A rule in XML<a id="d0e5976" class="indexterm"/></b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_processing_instruction">&lt;?xml&nbsp;version=&quot;1.0&quot;&nbsp;encoding=&quot;UTF-8&quot;?&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">package</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;com.sample&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">xmlns</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://drools.org/drools-4.0&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">xmlns:xs</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">xs:schemaLocation</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://drools.org/drools-4.0&nbsp;drools-4.0.xsd&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">import</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;java.util.HashMap&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">import</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;org.drools.*&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">global</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">identifier</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;x&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">type</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;com.sample.X&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">global</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">identifier</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;yada&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">type</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;com.sample.Yada&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">function</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">return-type</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;void&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;myFunc&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">parameter</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">identifier</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;foo&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">type</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;Bar&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">parameter</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">identifier</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;bada&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">type</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;Bing&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">body</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.println(&quot;hello&nbsp;world&quot;);</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">body</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">function</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">rule</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;simple_rule&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">rule-attribute</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;salience&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;10&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">rule-attribute</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;no-loop&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;true&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">rule-attribute</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;agenda-group&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;agenda-group&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">rule-attribute</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;activation-group&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;activation-group&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">lhs</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">pattern</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">identifier</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;foo2&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">object-type</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;Bar&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">or-constraint-connective</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">and-constraint-connective</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">field-constraint</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">field-name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;a&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">or-restriction-connective</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">and-restriction-connective</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">literal-restriction</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">evaluator</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_attribute_value">&quot;&nbsp;value=&quot;</span><span class="xml_plain">60</span><span class="xml_attribute_value">&quot;&nbsp;/</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;</span><span class="xml_attribute_name">literal-restriction</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">evaluator</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_attribute_value">&quot;&nbsp;value=&quot;</span><span class="xml_plain">70</span><span class="xml_attribute_value">&quot;&nbsp;/</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/</span><span class="xml_attribute_name">and-restriction-connective</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">and-restriction-connective</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">literal-restriction</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">evaluator</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_attribute_value">&quot;&nbsp;value=&quot;</span><span class="xml_plain">50</span><span class="xml_attribute_value">&quot;&nbsp;/</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;</span><span class="xml_attribute_name">literal-restriction</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">evaluator</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_attribute_value">&quot;&nbsp;value=&quot;</span><span class="xml_plain">55</span><span class="xml_attribute_value">&quot;&nbsp;/</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/</span><span class="xml_attribute_name">and-restriction-connective</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">or-restriction-connective</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">field-constraint</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">field-constraint</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">field-name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;a3&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">literal-restriction</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">evaluator</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;==&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;black&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">field-constraint</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">and-constraint-connective</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">and-constraint-connective</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">field-constraint</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">field-name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;a&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">literal-restriction</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">evaluator</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;==&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;40&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">field-constraint</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">field-constraint</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">field-name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;a3&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">literal-restriction</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">evaluator</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;==&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;pink&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">field-constraint</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">and-constraint-connective</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">and-constraint-connective</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">field-constraint</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">field-name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;a&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">literal-restriction</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">evaluator</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;==&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;12&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">field-constraint</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">field-constraint</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">field-name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;a3&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">or-restriction-connective</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">literal-restriction</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">evaluator</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;==&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;yellow&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">literal-restriction</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">evaluator</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;==&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;blue&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">or-restriction-connective</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">field-constraint</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">and-constraint-connective</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">or-constraint-connective</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">pattern</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">not</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">pattern</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">object-type</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;Person&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">field-constraint</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">field-name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;likes&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">variable-restriction</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">evaluator</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;==&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">identifier</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;type&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">field-constraint</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">pattern</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">exists</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">pattern</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">object-type</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;Person&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">field-constraint</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">field-name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;likes&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">variable-restriction</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">evaluator</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;==&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">identifier</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;type&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">field-constraint</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">pattern</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">exists</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">not</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">or-conditional-element</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">pattern</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">identifier</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;foo3&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">object-type</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;Bar&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">field-constraint</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">field-name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;a&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">or-restriction-connective</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">literal-restriction</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">evaluator</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;==&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;3&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">literal-restriction</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">evaluator</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;==&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;4&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">or-restriction-connective</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">field-constraint</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">field-constraint</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">field-name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;a3&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">literal-restriction</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">evaluator</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;==&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;hello&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">field-constraint</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">field-constraint</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">field-name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;a4&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">literal-restriction</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">evaluator</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;==&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;null&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">field-constraint</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">pattern</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">pattern</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">identifier</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;foo4&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">object-type</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;Bar&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">field-binding</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">field-name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;a&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">identifier</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;a4&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">field-constraint</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">field-name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;a&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">literal-restriction</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">evaluator</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;!=&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;4&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">literal-restriction</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">evaluator</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;!=&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;5&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">field-constraint</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">pattern</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">or-conditional-element</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">pattern</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">identifier</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;foo5&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">object-type</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;Bar&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">field-constraint</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">field-name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;b&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">or-restriction-connective</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">return-value-restriction</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">evaluator</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;==&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">a4&nbsp;+&nbsp;1</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">return-value-restriction</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">variable-restriction</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">evaluator</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_attribute_value">&quot;&nbsp;identifier=&quot;</span><span class="xml_attribute_name">a4</span><span class="xml_attribute_value">&quot;&nbsp;/</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;</span><span class="xml_attribute_name">qualified-identifier-restriction</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">evaluator</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;==&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;org.drools.Bar.BAR_ENUM_VALUE</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">qualified-identifier-restriction</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">or-restriction-connective</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">field-constraint</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">pattern</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">pattern</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">identifier</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;foo6&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">object-type</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;Bar&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">field-binding</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">field-name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;a&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">identifier</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;a4&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">field-constraint</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">field-name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;b&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">literal-restriction</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">evaluator</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;==&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;6&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">field-constraint</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">pattern</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">lhs</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">rhs</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(&nbsp;a&nbsp;==&nbsp;b&nbsp;)&nbsp;{</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert(&nbsp;foo3&nbsp;);</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;retract(&nbsp;foo4&nbsp;);</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;}</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;System.out.println(&nbsp;a4&nbsp;);</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">rhs</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">rule</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">package</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
</pre></div></div><br class="example-break"/><p>In the preceding XML text you will see the typical XML
      element, the package declaration, imports, globals, functions,
      and the rule itself. Most of the elements are self explanatory
      if you have some  understanding of the Drools features.</p><p>The <code class="code">import</code> elements import the types you wish to
      use in the rule.</p><p>The <code class="code">global</code> elements define global objects that can
      be referred to in the rules.</p><p>The <code class="code">function</code> contains a function declaration, for
      a function to be used in the rules. You have to specify a return type,
      a unique name and parameters, in the body goes a snippet of code.</p><p>The rule is discussed below.</p><div class="example"><a id="d0e6000"/><p class="title"><b>Example 5.80. Detail of rule element</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">rule</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;simple_rule&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">rule-attribute</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;salience&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;10&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">rule-attribute</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;no-loop&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;true&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">rule-attribute</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;agenda-group&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;agenda-group&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">rule-attribute</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;activation-group&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;activation-group&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">lhs</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">pattern</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">identifier</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;cheese&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">object-type</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;Cheese&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">from</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">accumulate</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">pattern</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">object-type</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;Person&quot;</span><span class="xml_tag_symbols">&gt;&lt;/</span><span class="xml_tag_name">pattern</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">init</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;total&nbsp;=&nbsp;0;</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">init</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">action</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;total&nbsp;+=&nbsp;$cheese.getPrice();</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">action</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">result</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new&nbsp;Integer(&nbsp;total&nbsp;)&nbsp;);</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">result</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">accumulate</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">from</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">pattern</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">pattern</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">identifier</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;max&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">object-type</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;Number&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">from</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">accumulate</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">pattern</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">identifier</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;cheese&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">object-type</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;Cheese&quot;</span><span class="xml_tag_symbols">&gt;&lt;/</span><span class="xml_tag_name">pattern</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">external-function</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">evaluator</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;max&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">expression</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;$price&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">accumulate</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">from</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">pattern</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">lhs</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">rhs</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;list1.add(&nbsp;$cheese&nbsp;);</span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">rhs</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">rule</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><br />
</pre></div></div><br class="example-break"/><p>In the above detail of the rule we see that the rule has LHS
      and RHS (conditions and consequence) sections.
    The RHS is simple, it is just a block of semantic code that will be
    executed when the rule is activated. The LHS is slightly more
    complicated as it contains nested elements for conditional elements,
    constraints and restrictions.</p><p>A key element of the LHS is the Pattern element. This allows you to
    specify a type (class) and perhaps bind a variable to an instance of that
    class. Nested under the pattern object are constraints and restrictions
  that have to be met. The Predicate and Return Value constraints
  allow Java expressions to be embedded.</p><p>That leaves the conditional elements, not, exists, and, or etc. They
    work like their DRL counterparts. Elements that are nested under and an
    "and" element are logically "anded" together. Likewise with "or" (and you
    can nest things further). "Exists" and "Not" work around patterns, to check
    for the existence or nonexistence of a fact meeting the pattern's
    constraints.</p><p>The Eval element allows the execution of a valid snippet of Java
    code - as long as it evaluates to a boolean (do not end it with a
    semi-colon, as it is just a fragment) - this can include calling a
    function. The Eval is less efficient than the columns, as the rule engine
    has to evaluate it each time, but it is a "catch all" feature for when you
    can express what you need to do with Column constraints.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e6014"/>5.11.3. Legacy Drools 2.x XML rule format</h3></div></div></div><p>The Drools 2.x legacy XML format is no longer supported by Drools XML parser</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e6019"/>5.11.4. Automatic transforming between formats (XML and DRL)</h3></div></div></div><p>Drools comes with some utility classes to transform between formats.
    This works by parsing the rules from the source format into the AST, and
    then "dumping" out to the appropriate target format. This allows you, for
    example, to write rules in DRL, and when needed, export to XML if
    necessary at some point in the future.</p><p>The classes to look at if you need to do this are: </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">XmlDumper - for exporting XML.
DrlDumper - for exporting DRL.
DrlParser - reading DRL.
XmlPackageReader - reading XML.
</pre><p> Using combinations of the above, you can convert between any
    format (including round trip). Note that DSLs will not be preserved (from
    DRLs that are using a DSL) - but they will be able to be converted.</p><p>Feel free to make use of XSLT to provide all sorts of possibilities
  for XML, XSLT and its ilk are what make XML powerful.</p></div></div></div><ul xmlns:d="http://docbook.org/ns/docbook" class="docnav"><li class="previous"><a accesskey="p" href="ch04.html"><strong>Prev</strong>Chapter 4. User Guide</a></li><li class="up"><a accesskey="u" href="#"><strong>Top of page</strong></a></li><li class="home"><a accesskey="h" href="index.html"><strong>Front page</strong></a></li><li class="next"><a accesskey="n" href="ch06.html"><strong>Next</strong>Chapter 6. Authoring</a></li></ul></body></html>