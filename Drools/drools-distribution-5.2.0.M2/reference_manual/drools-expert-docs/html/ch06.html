<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory">Chapter 6. Authoring</title><link rel="stylesheet" href="css/jbossorg.css" type="text/css"/><meta xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" name="generator" content="DocBook XSL-NS Stylesheets V1.74.0"/><link rel="home" href="index.html" title="Drools Expert User Guide"/><link rel="up" href="index.html" title="Drools Expert User Guide"/><link rel="prev" href="ch05.html" title="Chapter 5. The Rule Language"/><link rel="next" href="ch07.html" title="Chapter 7. The Java Rule Engine API"/></head><body><p xmlns:d="http://docbook.org/ns/docbook" id="title"><a href="http://www.jboss.org" class="site_href"><strong>JBoss.org</strong></a><a href="http://docs.jboss.org/" class="doc_href"><strong>Community Documentation</strong></a></p><ul xmlns:d="http://docbook.org/ns/docbook" class="docnav"><li class="previous"><a accesskey="p" href="ch05.html"><strong>Prev</strong></a></li><li class="next"><a accesskey="n" href="ch07.html"><strong>Next</strong></a></li></ul><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e6031"/>Chapter 6. Authoring</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="ch06.html#d0e6034">6.1. Decision Tables in Spreadsheets</a></span></dt><dd><dl><dt><span class="section"><a href="ch06.html#d0e6046">6.1.1. When to Use Decision Tables</a></span></dt><dt><span class="section"><a href="ch06.html#d0e6064">6.1.2. Overview</a></span></dt><dt><span class="section"><a href="ch06.html#d0e6102">6.1.3. How Decision Tables Work</a></span></dt><dt><span class="section"><a href="ch06.html#d0e6175">6.1.4. Spreadsheet Syntax</a></span></dt><dt><span class="section"><a href="ch06.html#d0e6649">6.1.5. Creating and integrating Spreadsheet based Decision Tables</a></span></dt><dt><span class="section"><a href="ch06.html#d0e6668">6.1.6. Managing Business Rules in Decision Tables</a></span></dt><dt><span class="section"><a href="ch06.html#d0e6713">6.1.7. Rule Templates</a></span></dt></dl></dd><dt><span class="section"><a href="ch06.html#d0e6765">6.2. Templates</a></span></dt><dd><dl><dt><span class="section"><a href="ch06.html#d0e6778">6.2.1. The Rule Template File</a></span></dt><dt><span class="section"><a href="ch06.html#d0e6874">6.2.2. Expanding a Template</a></span></dt><dt><span class="section"><a href="ch06.html#d0e6930">6.2.3. Example</a></span></dt></dl></dd></dl></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e6034"/>6.1. Decision Tables in Spreadsheets</h2></div></div></div><p>Decision tables are a "precise yet compact" (ref. Wikipedia) way of representing conditional logic, and are well
  suited to <span class="emphasis"><em>business</em></span> level rules.</p><p>Drools supports managing rules in a spreadsheet format. Supported formats are Excel (XLS), and CSV, which means
  that a variety of spreadsheet programs (such as Microsoft Excel, OpenOffice.org Calc amongst others) can be utilized.
  It is expected that web based decision table editors will be included in a near future release.</p><p>Decision tables are an old concept (in software terms) but have proven useful over the years. Very briefly
  speaking, in Drools decision tables are a way to generate rules driven from the data entered into a spreadsheet. All
  the usual features of a spreadsheet for data capture and manipulation can be taken advantage of.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e6046"/>6.1.1. When to Use Decision Tables</h3></div></div></div><p>Consider decision tables as a course of action if rules exist that can be expressed as rule
    templates and data: each row of a decision table provides data that is combined with a template to
    generate a rule.</p><p>Many businesses already use spreadsheets for managing data, calculations, etc. If you are happy to continue
    this way, you can also manage your business rules this way. This also assumes you are happy to manage packages of
    rules in <code class="filename">.xls</code> or <code class="filename">.csv</code> files. Decision tables are not recommended for rules
    that do not follow a set of templates, or where there are a small number of rules (or if there is a dislike towards
    software like Excel or OpenOffice.org). They are ideal in the sense that there can be control over what
    <span class="emphasis"><em>parameters</em></span> of rules can be edited, without exposing the rules directly.</p><p>Decision tables also provide a degree of insulation from the underlying object model.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e6064"/>6.1.2. Overview</h3></div></div></div><p>Here are some examples of real world decision tables (slightly edited to protect the innocent).</p><div class="screenshot"><div class="mediaobject"><img src="images/Chapter-Decision_Tables/excel.png"/></div></div><div class="screenshot"><div class="mediaobject"><img src="images/Chapter-Decision_Tables/actions.png"/></div></div><div class="screenshot"><div class="mediaobject"><img src="images/Chapter-Decision_Tables/open_office.png"/></div></div><p>In the above examples, the technical aspects of the decision table have been collapsed away (using a standard
    spreadsheet feature).</p><p>The rules start from row 17, with each row resulting in a rule. The conditions are in columns C, D, E, etc.,
    the actions being off-screen. The values in the cells are quite simple, and their meaning is indicated by the
    headers in Row 16. Column B is just a description. It is customary to use color to make it obvious what the
    different areas of the table mean.</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>Note that although the decision tables look like they process top down, this is not necessarily the case.
      Ideally, rules are authored without regard for the order of rows, simply because this makes maintenance easier, as
      rows will not need to be shifted around all the time.</p></div><p>As each row is a rule, the same principles apply. As the rule engine processes the facts, any rules that match
    may fire. (Some people are confused by this. It is possible to clear the agenda when a rule fires and simulate a
    very simple decision table where only the first match effects an action.) Also note that you can have multiple tables on one
    spreadsheet. This way, rules can be grouped where they share common templates, yet at the end of the day they are
    all combined into one rule package. Decision tables are essentially a tool to generate DRL rules
    automatically.</p><div class="screenshot"><div class="mediaobject"><img src="images/Chapter-Decision_Tables/multi_table.png"/></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e6102"/>6.1.3. How Decision Tables Work</h3></div></div></div><p>The key point to keep in mind is that in a decision table each row is a rule, and each column in that row is
    either a condition or action for that rule.</p><div class="screenshot"><div class="mediaobject"><img src="images/Chapter-Decision_Tables/row_col.png"/></div></div><p>The spreadsheet looks for the <em class="firstterm">RuleTable</em> keyword to indicate the start of a rule table
    (both the starting row and column). Other keywords are also used to define other package level attributes (covered
    later). It is important to keep the keywords in one column. By convention the second column ("B") is used for this,
    but it can be any column (convention is to leave a margin on the left for notes). In the following diagram, C is
    actually the column where it starts. Everything to the left of this is ignored.</p><p>If we expand the hidden sections, it starts to make more sense how it works; note the keywords in column
    C.</p><div class="screenshot"><div class="mediaobject"><img src="images/Chapter-Decision_Tables/expanded.png"/></div></div><p>Now the hidden magic which makes it work can be seen. The RuleSet keyword indicates the name to be used in the
    <span class="emphasis"><em>rule package</em></span> that will encompass all the rules. This name is optional, using a default, but it
    <span class="emphasis"><em>must</em></span> have the <span class="emphasis"><em>RuleSet</em></span> keyword in the cell immediately to the right.</p><p>The other keywords visible in Column C are Import and Sequential which will be covered later. The RuleTable
    keyword is important as it indicates that a chunk of rules will follow, based on some rule templates. After the
    RuleTable keyword there is a name, used to prefix the names of the generated rules. The row numbers are appended to
    guarantee unique rule names. The column of RuleTable indicates the column in which the rules start; columns to the
    left are ignored.</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>In general the keywords make up name-value pairs.</p></div><p>Referring to row 14 (the row immediately after RuleTable), the keywords CONDITION and ACTION indicate that the
    data in the columns below are for either the LHS or the RHS parts of a rule. There are other attributes on the rule
    which can also be optionally set this way.</p><p>Row 15 contains declarations of <em class="firstterm">ObjectTypes</em>. The content in this row is optional, but
    if this option is not in use, the row must be left blank; however this option is usually found to be quite useful.
    When using this row, the values in the cells below (row 16) become constraints on that object type. In the above
    case, it generates <code class="code">Person(age=="42")</code> and <code class="code">Cheese(type=="stilton")</code>, where 42 and
    "stilton" come from row 18. In the above example, the "==" is implicit; if just a field name is given the
    translator assumes that it is to generate an exact match.</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>An ObjectType declaration can span columns (via merged cells), meaning that all columns below the merged
      range are to be combined into one set of constraints within a single pattern matching a single fact at a time,
      as opposed to non-merged cells containing the same ObjectType, but resulting in different patterns, potentially
      matching different or identical facts.</p></div><p>Row 16 contains the rule templates themselves. They can use the "$param" placeholder to indicate where data
    from the cells below should be interpolated. (For multiple insertions, use "$1", "$2", etc., indicating parameters
    from a comma-separated list in a cell below.) Row 17 is ignored; it may contain textual descriptions of the column's
    purpose.</p><p>Rows 18 and 19 show data, which will be combined (interpolated) with the templates in row 15, to generate
    rules. If a cell contains no data, then its template is ignored. (This would mean that some condition or action does
    not apply for that rule row.) Rule rows are read until there is a blank row. Multiple RuleTables can exsist in a
    sheet. Row 20 contains another keyword, and a value. The row positions of keywords like this do not matter (most
    people put them at the top) but their column should be the same one where the RuleTable or RuleSet keywords should
    appear. In our case column C has been chosen to be significant, but any other column could be used instead.</p><p>In the above example, rules would be rendered like the following (as it uses the "ObjectType" row):</p><pre class="screen">//row 18
rule "Cheese_fans_18"
when
    Person(age=="42")
    Cheese(type=="stilton")
then
    list.add("Old man stilton");
end
</pre><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>The constraints <code class="code">age=="42"</code> and <code class="code">type=="stilton"</code> are interpreted as single
      constraints, to be added to the respective ObjectType in the cell above. If the cells above were spanned, then
      there could be multiple constraints on one "column".</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e6175"/>6.1.4. Spreadsheet Syntax</h3></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e6178"/>6.1.4.1. Spreadsheet Structure</h4></div></div></div><p>There are two types of rectangular areas defining data that is used for generating a DRL file.
      One, marked by a cell labelled <code class="code">RuleSet</code>, defines all DRL items except rules. The
      other one may occur repeatedly and is to the right and below a cell whose contents begin with
      <code class="code">RuleTable</code>. These areas represent the actual decision tables, each area resulting
      in a set of rules of similar structure.</p><p>A Rule Set area may contain cell pairs, one below the <code class="code">RuleSet</code> cell and containing
      a keyword designating the kind of value contained in the other one that follows in the same row.
      </p><p>The columns of a Rule Table area define patterns and constraints for the left hand sides of
      the rules derived from it, actions for the consequences of the rules, and the values of
      individual rule attributes. Thus, a Rule Table area should contain one or more columns, both for
      conditions and actions, and an arbitrary selection of columns for rule attributes, at most one
      column for each of these. The first four rows following the row with the cell marked with
      <code class="code">RuleTable</code> are earmarked as header area, mostly used for the definition of code to
      construct the rules. It is any additional row below these four header rows that spawns another
      rule, with its data providing for variations in the code defined in the Rule Table header.</p><p>All keywords are case insensitive.</p><p>Only the first worksheet is examined for decision tables.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e6203"/>6.1.4.2. Rule Set Entries</h4></div></div></div><p>Entries in a Rule Set area may define DRL constructs (except rules), and specify rule
      attributes. While entries for constructs may be used repeatedly, each rule attribute may be
      given at most once, and it applies to all rules unless it is overruled by the same attribute
      being defined within the Rule Table area.</p><p>Entries must be given in a vertically stacked sequence of cell pairs. The first one
      contains a keyword and the one to its right the value, as shown in the table below.
      This sequence of cell pairs may be interrupted by blank rows or even a Rule Table, as long
      as the column marked by <code class="code">RuleSet</code> is upheld as the one containing the keyword.
      </p><div class="table"><a id="d0e6213"/><p class="title"><b>Table 6.1. Entries in the Rule Set area</b></p><div class="table-contents"><table summary="Entries in the Rule Set area" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th>Keyword</th><th>Value</th><th>Usage</th></tr></thead><tbody><tr><td>RuleSet</td><td>The package name for the generated DRL file.
                     Optional, the default is <code class="code">rule_table</code>.</td><td>Must be First entry.</td></tr><tr><td>Sequential</td><td>"true" or "false". If "true", then salience is used to ensure that
              rules fire from the top down.</td><td>Optional, at most once. If omitted, no firing order is imposed.</td></tr><tr><td>Import</td><td>A comma-separated list of Java classes to import.</td><td>Optional, may be used repeatedly.</td></tr><tr><td>Variables</td><td>Declarations of DRL globals, i.e., a type followed by a variable name.
              Multiple global definitions must be separated with a comma.</td><td>Optional, may be used repeatedly.</td></tr><tr><td>Functions</td><td>One or more function definitions, according to DRL syntax.</td><td>Optional, may be used repeatedly.</td></tr><tr><td>Queries</td><td>One or more query definitions, according to DRL syntax.</td><td>Optional, may be used repeatedly.</td></tr></tbody></table></div></div><br class="table-break"/><p>For defining rule attributes that apply to all rules in the generated DRL file
      you can use any of the entries in the following table. Notice, however, that the
      proper keyword must be used. Also, each of these attributes may be used only once.
      </p><div class="table"><a id="d0e6273"/><p class="title"><b>Table 6.2. Rule attribute entries in the Rule Set area</b></p><div class="table-contents"><table summary="Rule attribute entries in the Rule Set area" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th>Keyword</th><th>Initial</th><th>Value</th></tr></thead><tbody><tr><td>PRIORITY</td><td>P</td><td>An integer defining the "salience" value for the rule. Overriden by the "Sequential" flag.</td></tr><tr><td>DURATION</td><td>D</td><td>A long integer value defining the "duration" value for the rule.</td></tr><tr><td>NO-LOOP</td><td>U</td><td>A Boolean value. "true" inhibits looping of rules due to changes made by its consequence.</td></tr><tr><td>LOCK-ON-ACTIVE</td><td>L</td><td>A Boolean value. "true" inhibits additional activations of all rules with this flag set within
              the same ruleflow or agenda group.</td></tr><tr><td>AUTO-FOCUS</td><td>F</td><td>A Boolean value. "true" for a rule within an agenda group causes activations of the rule to
              automatically give the focus to the group.</td></tr><tr><td>ACTIVATION-GROUP</td><td>X</td><td>A string identifying an activation (or XOR) group. Only one rule within
              an activation group will fire, i.e., the first one to fire cancels any existing activations of
              other rules within the same group.</td></tr><tr><td>AGENDA-GROUP</td><td>G</td><td>A string identifying an agenda group, which has to be activated by giving it the
              "focus", which is one way of controlling the flow between groups of rules.</td></tr><tr><td>RULEFLOW-GROUP</td><td>R</td><td>A string identifying a rule-flow group.</td></tr></tbody></table></div></div><br class="table-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e6342"/>6.1.4.3. Rule Tables</h4></div></div></div><p>All Rule Tables begin with a cell containing "RuleTable", optionally followed by a string
      within the same cell. The string is used as the initial part of the name for all rules derived
      from this Rule Table, with the row number appended for distinction. (This automatic naming can
      be overridden by using a NAME column.) All other cells defining rules of this Rule Table are
      below and to the right of this cell.</p><p>The next row defines the column type, with each column resulting in a part of the
      condition or the consequence, or providing some rule attribute, the rule name or a comment.
      The table below shows which column headers are available; additional columns may be used
      according to the table showing rule attribute entries given in the preceding section.
      Note that each attribute column may be used at most once. For a column header, either
      use the keyword or any other word beginning with the letter given in the "Initial" column
      of these tables.</p><div class="table"><a id="d0e6349"/><p class="title"><b>Table 6.3. Column Headers in the Rule Table </b></p><div class="table-contents"><table summary="Column Headers in the Rule Table " border="1"><colgroup><col/><col/><col/><col/></colgroup><thead><tr><th>Keyword</th><th>Initial</th><th>Value</th><th>Usage</th></tr></thead><tbody><tr><td>NAME</td><td>N</td><td>Provides the name for the rule generated from that row. The default is constructed
              from the text following the RuleTable tag and the row number.</td><td>At most one column</td></tr><tr><td>DESCRIPTION</td><td>I</td><td>A text, resulting in a comment within the generated rule.</td><td>At most one column</td></tr><tr><td>CONDITION</td><td>C</td><td>Code snippet and interpolated values for constructing a constraint within
              a pattern in a condition.</td><td>At least one per rule table</td></tr><tr><td>ACTION</td><td>A</td><td>Code snippet and interpolated values for constructing an action for the
              consequence of the rule.</td><td>At least one per rule table</td></tr><tr><td>METADATA</td><td>@</td><td>Code snippet and interpolated values for constructing a metadata entry
              for the rule.</td><td>Optional, any number of columns</td></tr></tbody></table></div></div><br class="table-break"/><p>Given a column headed CONDITION, the cells in successive lines result in a conditional element.</p><div class="itemizedlist"><ul><li><p>Text in the first cell below CONDITION develops into a pattern for the rule condition, with
          the snippet in the next line becoming a constraint. If the cell is merged with one or more neighbours,
          a single pattern with multiple constraints is formed: all constraints are combined into a parenthesized
          list and appended to the text in this cell. The cell may be left blank, which means that the code
          snippet in the next row must result in a valid conditional element on its own.</p><p>To include a pattern without constraints, you can write the pattern in front of the text
          for another pattern.</p><p>The pattern may be written with or without an empty pair of parentheses. A "from" clause may be
          appended to the pattern.</p><p>If the pattern ends with "eval", code snippets are supposed to produce boolean expressions
          for inclusion into a pair of parentheses after "eval".</p></li><li><p>Text in the second cell below CONDITION is processed in two steps.</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>The code snippet in this cell is modified by interpolating values from cells farther down in the column.
              If you want to create a constraint consisting of a comparison using "==" with the value from the cells below,
              the field selector alone is sufficient. Any other comparison operator must be specified as the last item
              within the snippet, and the value from the cells below is appended. For all other constraint forms, you must
              mark the position for including the contents of
              a cell with the symbol <code class="code">$param</code>. Multiple insertions are possible by using the symbols
              <code class="code">$1</code>, <code class="code">$2</code>, etc., and a comma-separated list of values in the cells below.</p><p>A text according to the pattern
              <code class="code">forall(</code><span class="emphasis"><em>delimiter</em></span><code class="code">){</code><span class="emphasis"><em>snippet</em></span><code class="code">}</code>
              is expanded by repeating the <span class="emphasis"><em>snippet</em></span> once for each of the values of the comma-separated
              list of values in each of the cells below, inserting the value in place of the symbol <code class="code">$</code> and
              by joining these expansions by the given <span class="emphasis"><em>delimiter</em></span>. Note that the forall construct may
              be surrounded by other text.
              </p></li><li><p>If the cell in the preceding row is not empty, the completed code snippet is added to the
              conditional element from that cell. A pair of parentheses is provided automatically, as well as
              a separating comma if multiple constraints are added to a pattern in a merged cell.</p><p>If the cell above is empty, the interpolated result is used as is.</p></li></ol></div></li><li><p>Text in the third cell below CONDITION is for documentation only. It should be used to
          indicate the column's purpose to a human reader.</p></li><li><p>From the fourth row on, non-blank entries provide data for interpolation as described
          above. A blank cell results in the omission of the conditional element or constaint for this
          rule.</p></li></ul></div><p>Given a column headed ACTION, the cells in successive lines result in an action statement.</p><div class="itemizedlist"><ul><li><p>Text in the first cell below ACTION is optional. If present, it is interpreted as an object
          reference.</p></li><li><p>Text in the second cell below ACTION is processed in two steps.</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>The code snippet in this cell is modified by interpolating values from cells farther down in the column.
              For a singular insertion, mark the position for including the contents of a cell with the symbol
              <code class="code">$param</code>. Multiple insertions are possible by using the symbols <code class="code">$1</code>, <code class="code">$2</code>,
              etc., and a comma-separated list of values in the cells below.</p><p>A method call without interpolation can be achieved by a text without any marker symbols. In this case,
              use any non-blank entry in a row below to include the statement.</p><p>The forall construct is available here, too.</p></li><li><p>If the first cell is not empty, its text, followed by a period, the text in the second cell
              and a terminating semicolon are stringed together, resulting in a method call which is added as an
              action statement for the consequence.
              </p><p>If the cell above is empty, the interpolated result is used as is.</p></li></ol></div></li><li><p>Text in the third cell below ACTION is for documentation only. It should be used to indicate the
          column's purpose to a human reader.</p></li><li><p>From the fourth row on, non-blank entries provide data for interpolation as described
          above. A blank cell results in the omission of the action statement for this rule.</p></li></ul></div><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>Using <code class="code">$1</code> instead of <code class="code">$param</code> works in most cases, but it will fail
        if the replacement text contains a comma: then, only the part preceding the first comma is inserted.
        Use this "abbreviation" judiciously.</p></div><p>Given a column headed METADATA, the cells in successive lines result in a metadata annotation
      for the generated rules.</p><div class="itemizedlist"><ul><li><p>Text in the first cell below METADATA is ignored.</p></li><li><p>Text in the second cell below METADATA is subject to interpolation, as described above,
          using values from the cells in the rule rows. The metadata marker character <code class="code">@</code>
          is prefixed automatically, and thus it should not be included in the text for this cell.</p></li><li><p>Text in the third cell below METADATA is for documentation only. It should be used to
          indicate the column's purpose to a human reader.</p></li><li><p>From the fourth row on, non-blank entries provide data for interpolation as described
          above. A blank cell results in the omission of the metadata annotation for this rule.</p></li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e6534"/>6.1.4.4. Examples</h4></div></div></div><p>The various interpolations are illustrated in the following example.</p><div class="example"><a id="d0e6539"/><p class="title"><b>Example 6.1. Interpolating cell data</b></p><div class="example-contents"><p>If the template is <code class="code">Foo(bar == $param)</code> and the cell is <code class="code">42</code>, then the result is
        <code class="code">Foo(bar == 42)</code>.</p><p>If the template is <code class="code">Foo(bar &lt; $1, baz == $2)</code> and the cell contains <code class="code">42,43</code>,
        the result will be <code class="code">Foo(bar &lt; 42, baz ==43)</code>.</p><p>The template <code class="code">forall(&amp;&amp;){bar != $}</code> with a cell containing <code class="code">42,43</code>
        results in <code class="code">bar != 42 &amp;&amp; bar != 43</code>.</p></div></div><br class="example-break"/><p>The next example demonstrates the joint effect of a cell defining the pattern type and the code
       snippet below it.
        </p><div class="screenshot"><div class="mediaobject"><img src="images/Chapter-Decision_Tables/spanned_column.png"/></div></div><p>
      This spreadsheet section shows how the <code class="code">Person</code> type declaration spans 2 columns, and thus
      both constraints will appear as <code class="code">Person(age == ..., type == ...)</code>. Since only
      the field names are present in the snippet, they imply an equality test.</p><p>In the following example the marker symbol <code class="code">$param</code> is used. 
        </p><div class="screenshot"><div class="mediaobject"><img src="images/Chapter-Decision_Tables/with_param.png"/></div></div><p>
      The result of this column is the pattern <code class="code">Person(age == "42"))</code>. You may have
      noticed that the marker and the operator "==" are redundant.</p><p>The next example illustrates that a trailing insertion marker can be omitted.
        </p><div class="screenshot"><div class="mediaobject"><img src="images/Chapter-Decision_Tables/operator_completion.png"/></div></div><p>
      Here, appending the value from the cell is implied, resulting in <code class="code">Person(age &lt; "42")).</code>
      </p><p>You can provide the definition of a binding variable, as in the example below.
      . </p><div class="screenshot"><div class="mediaobject"><img src="images/Chapter-Decision_Tables/with_binding.png"/></div></div><p>
      Here, the result is <code class="code">c: Cheese(type == "stilton").</code> Note that the quotes are provided
      automatically. Actually, anything can be placed in the object type row. Apart from the definition
      of a binding variable,  it could alse be an additional pattern that is to be inserted literally.
      </p><p>A simple construction of an action statement with the insertion of a single value is shown
      below.
        </p><div class="screenshot"><div class="mediaobject"><img src="images/Chapter-Decision_Tables/consequence.png"/></div></div><p>
      The cell below the ACTION header is left blank. Using this style, anything can be placed in the
      consequence, not just a sinle method call. (The same technique is applicable within a 
      CONDITION column as well.)</p><p>Below is a comprehensive example, showing the use of various column headers. It is not
      an error to have no value below a column header (as in the NO-LOOP column): here, the attribute
      will not be applied in any of the rules.
        </p><div class="screenshot"><div class="mediaobject"><img src="images/Chapter-Decision_Tables/Key.png"/></div></div><p>
      </p><p>And, finally, here is an example of Import, Variables and Functions.
      </p><div class="screenshot"><div class="mediaobject"><img src="images/Chapter-Decision_Tables/keywords.png"/></div></div><p>
      Multiple package names within the same cell must be separated by a comma. Also, the
      pairs of type and variable names must be comma-separated. Functions, however, must be
      written as they appear in a DRL file. This should appear in the same column as the
      "RuleSet" keyword; it could be above, between or below all the rule rows.</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>It may be more convenient to use Import, Variables, Functions and Queries repeatedly
        rather than packing several definitions into a single cell.</p></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e6649"/>6.1.5. Creating and integrating Spreadsheet based Decision Tables</h3></div></div></div><p>The API to use spreadsheet based decision tables is in the drools-decisiontables module. There is really only
    one class to look at: <code class="literal">SpreadsheetCompiler</code>. This class will take spreadsheets in various formats,
    and generate rules in DRL (which you can then use in the normal way). The <code class="literal">SpreadsheetCompiler</code> can
    just be used to generate partial rule files if it is wished, and assemble it into a complete rule package after the
    fact (this allows the separation of technical and non-technical aspects of the rules if needed).</p><p>To get started, a sample spreadsheet can be used as a base. Alternatively, if the plug-in is being used (Rule
    Workbench IDE), the wizard can generate a spreadsheet from a template (to edit it an xls compatible spreadsheet
    editor will need to be used). </p><div class="screenshot"><div class="mediaobject"><img src="images/Chapter-Decision_Tables/wizard.png"/></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e6668"/>6.1.6. Managing Business Rules in Decision Tables</h3></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e6671"/>6.1.6.1. Workflow and Collaboration</h4></div></div></div><p>Spreadsheets are well established business tools (in use for over 25 years). Decision tables lend themselves
      to close collaboration between IT and domain experts, while making the business rules clear to business analysts,
      it is an ideal separation of concerns.</p><p>Typically, the whole process of authoring rules (coming up with a new decision table) would be something
      like:</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>Business analyst takes a template decision table (from a repository, or from IT)</p></li><li><p>Decision table business language descriptions are entered in the table(s)</p></li><li><p>Decision table rules (rows) are entered (roughly)</p></li><li><p>Decision table is handed to a technical resource, who maps the business language (descriptions) to
          scripts (this may involve software development of course, if it is a new application or data model)</p></li><li><p>Technical person hands back and reviews the modifications with the business analyst.</p></li><li><p>The business analyst can continue editing the rule rows as needed (moving columns around is also fine
          etc).</p></li><li><p>In parallel, the technical person can develop test cases for the rules (liaising with business analysts)
          as these test cases can be used to verify rules and rule changes once the system is running.</p></li></ol></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e6700"/>6.1.6.2. Using spreadsheet features</h4></div></div></div><p>Features of applications like Excel can be used to provide assistance in entering data into spreadsheets,
      such as validating fields. Lists that are stored in other worksheets can be used to provide valid lists of values
      for cells, like in the following diagram. </p><div class="screenshot"><div class="mediaobject"><img src="images/Chapter-Decision_Tables/lists.png"/></div></div><p>Some applications provide a limited ability to keep a history of changes, but it is recommended to use an
      alternative means of revision control. When changes are being made to rules over time, older versions are archived
      (many open source solutions exist for this, such as Subversion or Git).</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e6713"/>6.1.7. Rule Templates</h3></div></div></div><p>Related to decision tables (but not necessarily requiring a spreadsheet) are "Rule Templates" (in the
    drools-templates module). These use any tabular data source as a source of rule data - populating a template to
    generate many rules. This can allow both for more flexible spreadsheets, but also rules in existing databases for
    instance (at the cost of developing the template up front to generate the rules).</p><p>With Rule Templates the data is separated from the rule and there are no restrictions on which part of the
    rule is data-driven. So whilst you can do everything you could do in decision tables you can also do the
    following:</p><div class="itemizedlist"><ul><li><p>store your data in a database (or any other format)</p></li><li><p>conditionally generate rules based on the values in the data</p></li><li><p>use data for any part of your rules (e.g. condition operator, class name, property name)</p></li><li><p>run different templates over the same data</p></li></ul></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e6733"/>6.1.7.1. A decision table-like example</h4></div></div></div><p>As an example, a more classic decision table is shown, but without any hidden rows for the rule meta data
      (so the spreadsheet only contains the raw data to generate the rules).</p><div class="screenshot"><div class="mediaobject"><img src="images/Chapter-Decision_Tables/template1.png"/></div></div><p>See the <code class="filename">ExampleCheese.xls</code> in the examples download for the above spreadsheet.</p><p>If this was a regular decision table there would be hidden rows before row 1 and between rows 1 and 2
      containing rule metadata. With rule templates the data is completely separate from the rules. This has two handy
      consequences - you can apply multiple rule templates to the same data and your data is not tied to your rules at
      all. So what does the template look like?</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
1  template header
2  age
3  type
4  log
5
6  package org.drools.examples.templates;
7
8  global java.util.List list;
9
10 template "cheesefans"
11
12 rule "Cheese fans_@{row.rowNumber}"
13 when
14    Person(age == @{age})
15    Cheese(type == "@{type}")
16 then
17    list.add("@{log}");
18 end
19
20 end template
  </pre><p>Referring to the above:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
Line 1: all rule templates start with "template header"
Lines 2-4: following the header is the list of columns in the order they appear in the data. In this case we are calling the first column "age", the second "type" and the third "log".
Lines 5: empty line signifying the end of the column definitions
Lines 6-9: standard rule header text. This is standard rule DRL and will appear at the top of the generated DRL. Put the package statement and any imports and global definitions
Line 10: The "template" keyword signals the start of a rule template. There can be more than one template in a template file. The template should have a unique name.
Lines 11-18: The rule template - see below
Line 20: "end template" signifies the end of the template.
</pre><p>The rule templates rely on MVEL to do substitution using the syntax @{token_name}. There is currently one
      built-in expression, @{row.rowNumber} which gives a unique number for each row of data and enables you to generate
      unique rule names. For each row of data a rule will be generated with the values in the data substituted for the
      tokens in the template. With the example data above the following rule file would be generated:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
package org.drools.examples.templates;

global java.util.List list;

rule "Cheese fans_1"
when
  Person(age == 42)
  Cheese(type == "stilton")
then
  list.add("Old man stilton");
end

rule "Cheese fans_2"
when
  Person(age == 21)
  Cheese(type == "cheddar")
then
  list.add("Young man cheddar");
end
</pre><p>The code to run this is simple:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">DecisionTableConfiguration</span><!-- <br/> --><span class="java_plain">&nbsp;dtableconfiguration&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">KnowledgeBuilderFactory</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">newDecisionTableConfiguration</span><!-- <br/> --><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">dtableconfiguration</span><span class="java_separator">.</span><span class="java_plain">setInputType</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">DecisionTableInputType</span><span class="java_separator">.</span><span class="java_plain">XLS&nbsp;</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_type">KnowledgeBuilder</span><span class="java_plain">&nbsp;kbuilder&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">KnowledgeBuilderFactory</span><span class="java_separator">.</span><span class="java_plain">newKnowledgeBuilder</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">kbuilder</span><span class="java_separator">.</span><span class="java_plain">add</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">ResourceFactory</span><span class="java_separator">.</span><span class="java_plain">newClassPathResource</span><span class="java_separator">(</span><span class="java_plain">&nbsp;getSpreadsheetName</span><span class="java_separator">(),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;getClass</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">ResourceType</span><span class="java_separator">.</span><span class="java_plain">DTABLE</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dtableconfiguration&nbsp;</span><span class="java_separator">);</span>
</pre></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e6765"/>6.2. Templates</h2></div></div></div><p>If you discover that you have a group of rules following
    the same arrangement of patterns, constraints and actions on
    the RHS, differing only in constants or names for objects or
    fields, you might think of employing Drool's rule template feature
    for generating the actual rules. You would write a 
    <span class="emphasis"><em>rule template</em></span> file, containing the
    textual skeleton of your rule and use the Drools template
    compiler in combination with a collection of objects providing
    the actual values for the "flesh" of the rules for their
    instantiation.</p><p>The mechanism is very similar to what a macro processor
    does. The major advantage proffered by template expansion is
    that it's nicely integrated in the overall handling of
    Knowledge Resources.</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="caution"><h2>Caution</h2><p>This is an experimental feature. In particular,
    the API is subject to change.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e6778"/>6.2.1. The Rule Template File</h3></div></div></div><p>A rule template file begins with a header defining the
      placeholders, or <span class="emphasis"><em>formal template parameters</em></span> 
      for the strings that are to be inserted during instantiation. 
      After the first line, which invariably contains <code class="literal">template header</code>,
      you should write a number of lines, each of which contains a single
      parameter name.</p><div class="example"><a id="d0e6789"/><p class="title"><b>Example 6.2. Rule template file: template header</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
<span xmlns="http://www.w3.org/1999/xhtml" class="bold"><strong>template header</strong></span>
<span xmlns="http://www.w3.org/1999/xhtml" class="emphasis"><em>parameter-name-1</em></span>
...
<span xmlns="http://www.w3.org/1999/xhtml" class="emphasis"><em>parameter-name-n</em></span>
...</pre></div></div><br class="example-break"/><p>The template header is followed by the text that is to
      be replicated and interpolated with the actual parameters. It
      may begin with a <code class="literal">package</code> statement, followed by some
      additional lines. These 
      may be sectioned into one or more templates, each of them
      between a pair of matching <code class="literal">template</code> and
      <code class="literal">end template</code> statements. The <code class="literal">template</code> takes
      an argument, which puts a name to the template. The name
      can be a simple unquoted name or an arbitrary string enclosed
      in double quotes. The template text between these lines may
      contain one or more rules, constituting the "raw material"
      for the expansion.</p><div class="example"><a id="d0e6817"/><p class="title"><b>Example 6.3. Rule template file: templates</b></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
<span xmlns="http://www.w3.org/1999/xhtml" class="bold"><strong>template header</strong></span>
<span xmlns="http://www.w3.org/1999/xhtml" class="bold"><strong><span class="emphasis"><em>parameter-name-1</em></span></strong></span>
...
<span xmlns="http://www.w3.org/1999/xhtml" class="emphasis"><em>parameter-name-n</em></span>
<span xmlns="http://www.w3.org/1999/xhtml" class="bold"><strong>package ...</strong></span>     # optional
<span xmlns="http://www.w3.org/1999/xhtml" class="emphasis"><em>header text</em></span>    # optional
<span xmlns="http://www.w3.org/1999/xhtml" class="bold"><strong>template</strong></span> <span xmlns="http://www.w3.org/1999/xhtml" class="emphasis"><em>template-name</em></span>
...
// template text
...
<span xmlns="http://www.w3.org/1999/xhtml" class="bold"><strong>end template</strong></span>
...</pre></div></div><br class="example-break"/><p>The resulting text will begin with the package line and the
      header text following it, if present. Then, each template text
      will be expanded individually, yielding one set of rules for each
      of the actual parameter sets. Therefore, the structure of the
      template sections affect the order of the generated rules, since
      the generator iterates over the sections and then over the
      set of actual parameters.</p><p>Any interpolation takes place between a pair of <code class="literal">template</code>
      and <code class="literal">end template</code> statements, when this template is
      expanded. The template text is scanned for occurrences of
      <span class="emphasis"><em>parameter expansions</em></span> written according to:
      </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
<span xmlns="http://www.w3.org/1999/xhtml" class="bold"><strong>@{<span class="emphasis"><em>parameter-name</em></span>}</strong></span></pre><p>
      The name between '@{' and '}' should be one of the parameter names
      defined in the template header. The substitution is effected anywhere,
      even within string literals.</p><p>An important parameter is available without having to be
      included in the data source providing the actual values. The
      parameter substitution
      <span class="bold"><strong><code class="code">@{row.rowNumber}</code></strong></span>
      expands to the integers 0, 1, 2, etc., providing a unique distinction
      for the instantiation derived from a parameter set. You would use this
      as part of each rule name, because, without this precaution, there
      would be duplicate rule names. (You are, of course, free to use your
      own identification included as an extra parameter.)</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e6874"/>6.2.2. Expanding a Template</h3></div></div></div><p>To expand a template, you must prepare a data source. This can
      be a spreadsheet, as explained in the previous section. Here, we'll
      concentrate on expansion driven by Java objects. There are two
      straightforward ways of supplying values for a fixed set of names:
      Java objects, in the JavaBeans style, and Maps. Both of them can
      be arranged in a <code class="code">Collection</code>, whose elements will be
      processed during the expansion, resulting in an instantiation
      for each element.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e6882"/>6.2.2.1. Instantiation from Java Objects</h4></div></div></div><p>You may use a Java object that provides getter methods
        corresponding to all of the parameter names of your template
        file. If, for instance, you have defined a header</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
template header
type
limit
word</pre><p>the following Java class could be used:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"></span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">ParamSet</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">ParamSet</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;t</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;l</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">boolean</span><span class="java_plain">&nbsp;w&nbsp;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;&nbsp;getType</span><span class="java_separator">(){...}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;getLimit</span><span class="java_separator">(){...}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">boolean</span><span class="java_plain">&nbsp;isWord</span><span class="java_separator">(){...}</span>
<!--  --><br/><span class="java_separator">}</span></pre><p>Although interpolation is pure text manipulation, the actual values
        supplied may be of any type, just as long as this type provides a
        reasonable <code class="code">toString()</code> method. (For simple types, the
        eponymous static method of the related class from <code class="code">java.lang</code>
        is used.)</p><p>Assuming that we have created a <code class="code">Collection&lt;ParamSet&gt;</code>
        for a template file <code class="code">template.drl</code>, we can now proceed to
        request its expansion.</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"></span>
<!--  --><br/><span class="java_type">Collection</span><span class="java_operator">&lt;</span><span class="java_type">ParamSet</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;paramSets&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">ArrayList</span><span class="java_operator">&lt;</span><span class="java_type">ParamSet</span><span class="java_operator">&gt;</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;populate&nbsp;paramSets</span>
<!--  --><br/><span class="java_plain">paramSets</span><span class="java_separator">.</span><span class="java_plain">add</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">ParamSet</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;Foo&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">42</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">true</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">paramSets</span><span class="java_separator">.</span><span class="java_plain">add</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">ParamSet</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;Bar&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">13</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">false</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_type">ObjectDataCompiler</span><span class="java_plain">&nbsp;converter&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">ObjectDataCompiler</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_type">InputStream</span><span class="java_plain">&nbsp;templateStream&nbsp;</span><span class="java_operator">=</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">getClass</span><span class="java_separator">().</span><span class="java_plain">getResourceAsStream</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;template.drl&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_type">String</span><span class="java_plain">&nbsp;drl&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;converter</span><span class="java_separator">.</span><span class="java_plain">compile</span><span class="java_separator">(</span><span class="java_plain">&nbsp;objs</span><span class="java_separator">,</span><span class="java_plain">&nbsp;templateStream&nbsp;</span><span class="java_separator">);</span></pre>

        The resulting string contains the expanded rules text. You could
        write it to a file and proceed as usual, but it's also possible to
        feed this to a <code class="code">KnowledgeBuilder</code> and continue with the
        resulting Knowledge Packages.

        <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"></span>
<!--  --><br/><span class="java_type">KnowledgeBase</span><span class="java_plain">&nbsp;kBase&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">KnowledgeBaseFactory</span><span class="java_separator">.</span><span class="java_plain">newKnowledgeBase</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_type">KnowledgeBuilder</span><span class="java_plain">&nbsp;kBuilder&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">KnowledgeBuilderFactory</span><span class="java_separator">.</span><span class="java_plain">newKnowledgeBuilder</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_type">Reader</span><span class="java_plain">&nbsp;rdr&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">StringReader</span><span class="java_separator">(</span><span class="java_plain">&nbsp;drl&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">kBuilder</span><span class="java_separator">.</span><span class="java_plain">add</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">ResourceFactory</span><span class="java_separator">.</span><span class="java_plain">newReaderResource</span><span class="java_separator">(</span><span class="java_plain">&nbsp;rdr&nbsp;</span><span class="java_separator">),</span><span class="java_plain">&nbsp;</span><span class="java_type">ResourceType</span><span class="java_separator">.</span><span class="java_plain">DRL&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_keyword">if</span><span class="java_separator">(</span><span class="java_plain">&nbsp;kBuilder</span><span class="java_separator">.</span><span class="java_plain">hasErrors</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">){</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">throw</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">IllegalStateException</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;DRL&nbsp;errors&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">kBase</span><span class="java_separator">.</span><span class="java_plain">addKnowledgePackages</span><span class="java_separator">(</span><span class="java_plain">&nbsp;kBuilder</span><span class="java_separator">.</span><span class="java_plain">getKnowledgePackages</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span></pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e6917"/>6.2.2.2. Instantiation from Maps</h4></div></div></div><p>A <code class="code">Map</code> that provides the values for substituting
        template parameters should have a (string) key set matching all of
        the parameter names. Again, values could be from any class, as long
        as they provide a good <code class="code">toString()</code> method. The expansion
        would use the same approach, just differing in the way the
        map collection is composed.</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"></span>
<!--  --><br/><span class="java_type">Collection</span><span class="java_operator">&lt;</span><span class="java_type">Map</span><span class="java_operator">&lt;</span><span class="java_type">String</span><span class="java_separator">,</span><span class="java_type">Object</span><span class="java_operator">&gt;&gt;</span><span class="java_plain">&nbsp;paramMaps&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">ArrayList</span><span class="java_operator">&lt;</span><span class="java_type">Map</span><span class="java_operator">&lt;</span><span class="java_type">String</span><span class="java_separator">,</span><span class="java_type">Object</span><span class="java_operator">&gt;&gt;</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;populate&nbsp;paramMaps</span>
<!--  --><br/><span class="java_type">ObjectDataCompiler</span><span class="java_plain">&nbsp;converter&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">ObjectDataCompiler</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_type">InputStream</span><span class="java_plain">&nbsp;templateStream&nbsp;</span><span class="java_operator">=</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">getClass</span><span class="java_separator">().</span><span class="java_plain">getResourceAsStream</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;template.drl&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_type">String</span><span class="java_plain">&nbsp;drl&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;converter</span><span class="java_separator">.</span><span class="java_plain">compile</span><span class="java_separator">(</span><span class="java_plain">&nbsp;objs</span><span class="java_separator">,</span><span class="java_plain">&nbsp;templateStream&nbsp;</span><span class="java_separator">);</span></pre></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e6930"/>6.2.3. Example</h3></div></div></div><p>The following example illustrates template expansion. It is based on simple
       objects of class <code class="code">Item</code> containing a couple of integer fields and an
       <code class="code">enum</code> field of type <code class="code">ItemCode</code>.</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"></span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Item</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Item</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;n</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;p</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;w</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">ItemCode</span><span class="java_plain">&nbsp;c&nbsp;</span><span class="java_separator">){...}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;&nbsp;&nbsp;getName</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{...}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;getWeight</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{...}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;getPrice</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{...}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">ItemCode</span><span class="java_plain">&nbsp;getCode</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{...}</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;enum&nbsp;</span><span class="java_type">ItemCode</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;LOCK</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;STOCK</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;BARREL</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_separator">}</span></pre><p>The rule template contains a single rule. Notice that the field
         name for the range test is a parameter, which enables us to instantiate
         the template for different fields.</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
template header
field
lower
upper
codes

package range;
template "inRange"
rule "is in range @{row.rowNumber}"
when
    Item( $name : name, $v : @{field} &gt;= @{lower} &amp;&amp; &lt;= @{upper}, $code : code @{codes} )
then
    System.out.println( "Item " + $name + " @{field} in range: " + $v + " code: " + $code );
end
end template</pre><p>The next code snippet is from the application, where several
         parameter sets have to be set up. First, there is class
         <code class="code">ParamSet</code>, for storing a set of actual parameters.</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"></span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">ParamSet</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">EnumSet</span><span class="java_operator">&lt;</span><span class="java_type">ItemCode</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;codeSet</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">ParamSet</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;f</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;l</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;u</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">EnumSet</span><span class="java_operator">&lt;</span><span class="java_type">ItemCode</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;cs&nbsp;</span><span class="java_separator">){...}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;getField</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;field</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;getLower</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;lower</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;getUpper</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;upper</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;getCodes</span><span class="java_separator">(){</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">StringBuilder</span><span class="java_plain">&nbsp;sb&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">StringBuilder</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;conn&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;&quot;</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">for</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">ItemCode</span><span class="java_plain">&nbsp;ic</span><span class="java_operator">:</span><span class="java_plain">&nbsp;codeSet&nbsp;</span><span class="java_separator">){</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sb</span><span class="java_separator">.</span><span class="java_plain">append</span><span class="java_separator">(</span><span class="java_plain">&nbsp;conn&nbsp;</span><span class="java_separator">).</span><span class="java_plain">append</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;&nbsp;==&nbsp;ItemCode.&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">).</span><span class="java_plain">append</span><span class="java_separator">(</span><span class="java_plain">&nbsp;ic&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;conn&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;&nbsp;||&quot;</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;sb</span><span class="java_separator">.</span><span class="java_plain">toString</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span></pre><p>Note that the method <code class="code">getCodes()</code> does returns the
        <code class="code">EnumSet&lt;ItemCode&gt;</code> field value as a <code class="code">String</code>
        value representing a multiple restriction, i.e., a test for one out
        of a list of values.</p><p>The task of expanding a template, passing the resulting DRL text
        to a Knowledge Builder and adding the resulting Knowledge Packages
        to a Knowledge Base is generic. The utility class <code class="code">Expander</code>
        takes care of this, using a Knowledge Base, the <code class="code">InputStream</code>
        with the rule template and the collection of parameter sets.</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"></span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Expander</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;expand</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">KnowledgeBase</span><span class="java_plain">&nbsp;kBase</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">InputStream</span><span class="java_plain">&nbsp;is</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Collection</span><span class="java_operator">&lt;?&gt;</span><span class="java_plain">&nbsp;act&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">throws</span><span class="java_plain">&nbsp;</span><span class="java_type">Exception</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">ObjectDataCompiler</span><span class="java_plain">&nbsp;converter&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">ObjectDataCompiler</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;drl&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;converter</span><span class="java_separator">.</span><span class="java_plain">compile</span><span class="java_separator">(</span><span class="java_plain">&nbsp;act</span><span class="java_separator">,</span><span class="java_plain">&nbsp;is&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">KnowledgeBuilder</span><span class="java_plain">&nbsp;kBuilder&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">KnowledgeBuilderFactory</span><span class="java_separator">.</span><span class="java_plain">newKnowledgeBuilder</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Reader</span><span class="java_plain">&nbsp;rdr&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">StringReader</span><span class="java_separator">(</span><span class="java_plain">&nbsp;drl&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;kBuilder</span><span class="java_separator">.</span><span class="java_plain">add</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">ResourceFactory</span><span class="java_separator">.</span><span class="java_plain">newReaderResource</span><span class="java_separator">(</span><span class="java_plain">&nbsp;rdr&nbsp;</span><span class="java_separator">),</span><span class="java_plain">&nbsp;</span><span class="java_type">ResourceType</span><span class="java_separator">.</span><span class="java_plain">DRL&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">if</span><span class="java_separator">(</span><span class="java_plain">&nbsp;kBuilder</span><span class="java_separator">.</span><span class="java_plain">hasErrors</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">){</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">for</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">KnowledgeBuilderError</span><span class="java_plain">&nbsp;err</span><span class="java_operator">:</span><span class="java_plain">&nbsp;kBuilder</span><span class="java_separator">.</span><span class="java_plain">getErrors</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">){</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">System</span><span class="java_separator">.</span><span class="java_plain">err</span><span class="java_separator">.</span><span class="java_plain">println</span><span class="java_separator">(</span><span class="java_plain">&nbsp;err</span><span class="java_separator">.</span><span class="java_plain">toString</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">throw</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">IllegalStateException</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;DRL&nbsp;errors&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;kBase</span><span class="java_separator">.</span><span class="java_plain">addKnowledgePackages</span><span class="java_separator">(</span><span class="java_plain">&nbsp;kBuilder</span><span class="java_separator">.</span><span class="java_plain">getKnowledgePackages</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span></pre><p>We are now all set to prepare the Knowledge Base with some
        generated rules. First, we define several parameter sets,
        constructed as <code class="code">ParamSet</code> objects, and add them to a
        <code class="code">List</code>, which is passed to the <code class="code">expand</code>
        method shown above. Then we launch a stateful session, insert a
        few <code class="code">Item</code>, and watch what happens.</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"></span>
<!--  --><br/><span class="java_type">Collection</span><span class="java_operator">&lt;</span><span class="java_type">ParamSet</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;cfl&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">ArrayList</span><span class="java_operator">&lt;</span><span class="java_type">ParamSet</span><span class="java_operator">&gt;</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">cfl</span><span class="java_separator">.</span><span class="java_plain">add</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">ParamSet</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;weight&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;&nbsp;</span><span class="java_literal">10</span><span class="java_separator">,</span><span class="java_plain">&nbsp;&nbsp;</span><span class="java_literal">99</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">EnumSet</span><span class="java_separator">.</span><span class="java_plain">of</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">ItemCode</span><span class="java_separator">.</span><span class="java_plain">LOCK</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">ItemCode</span><span class="java_separator">.</span><span class="java_plain">STOCK&nbsp;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">cfl</span><span class="java_separator">.</span><span class="java_plain">add</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">ParamSet</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;price&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_literal">10</span><span class="java_separator">,</span><span class="java_plain">&nbsp;&nbsp;</span><span class="java_literal">50</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">EnumSet</span><span class="java_separator">.</span><span class="java_plain">of</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">ItemCode</span><span class="java_separator">.</span><span class="java_plain">BARREL&nbsp;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_type">KnowledgeBase</span><span class="java_plain">&nbsp;kBase&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">KnowledgeBaseFactory</span><span class="java_separator">.</span><span class="java_plain">newKnowledgeBase</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_type">Expander</span><span class="java_plain">&nbsp;ex&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">Expander</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_type">InputStream</span><span class="java_plain">&nbsp;dis&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">FileInputStream</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">File</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;rangeTemp.drl&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">ex</span><span class="java_separator">.</span><span class="java_plain">expand</span><span class="java_separator">(</span><span class="java_plain">&nbsp;kBase</span><span class="java_separator">,</span><span class="java_plain">&nbsp;dis</span><span class="java_separator">,</span><span class="java_plain">&nbsp;cfl&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_type">StatefulKnowledgeSession</span><span class="java_plain">&nbsp;session&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;kBase</span><span class="java_separator">.</span><span class="java_plain">newStatefulKnowledgeSession</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">session</span><span class="java_separator">.</span><span class="java_plain">insert</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">Item</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;A&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">130</span><span class="java_separator">,</span><span class="java_plain">&nbsp;&nbsp;</span><span class="java_literal">42</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">ItemCode</span><span class="java_separator">.</span><span class="java_plain">LOCK&nbsp;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">session</span><span class="java_separator">.</span><span class="java_plain">insert</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">Item</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;B&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;&nbsp;</span><span class="java_literal">44</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">100</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">ItemCode</span><span class="java_separator">.</span><span class="java_plain">STOCK&nbsp;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">session</span><span class="java_separator">.</span><span class="java_plain">insert</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">Item</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;C&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">123</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">180</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">ItemCode</span><span class="java_separator">.</span><span class="java_plain">BARREL&nbsp;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">session</span><span class="java_separator">.</span><span class="java_plain">insert</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">Item</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;D&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;&nbsp;</span><span class="java_literal">85</span><span class="java_separator">,</span><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_literal">9</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">ItemCode</span><span class="java_separator">.</span><span class="java_plain">LOCK&nbsp;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">session</span><span class="java_separator">.</span><span class="java_plain">fireAllRules</span><span class="java_separator">();</span></pre><p>Notice that the two resulting rules deal with
         <span class="emphasis"><em>different</em></span> fields, one with an item's weight,
         the other one with its price. - Below is the output.</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
Item E price in range: 25 code: BARREL
Item A weight in range: 42 code: LOCK</pre></div></div></div><ul xmlns:d="http://docbook.org/ns/docbook" class="docnav"><li class="previous"><a accesskey="p" href="ch05.html"><strong>Prev</strong>Chapter 5. The Rule Language</a></li><li class="up"><a accesskey="u" href="#"><strong>Top of page</strong></a></li><li class="home"><a accesskey="h" href="index.html"><strong>Front page</strong></a></li><li class="next"><a accesskey="n" href="ch07.html"><strong>Next</strong>Chapter 7. The Java Rule Engine API</a></li></ul></body></html>