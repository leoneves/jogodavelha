<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory">Drools Planner User Guide</title><link rel="stylesheet" href="css/jbossorg.css" type="text/css"/><meta xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" name="generator" content="DocBook XSL-NS Stylesheets V1.74.0"/></head><body><div class="book" lang="en-US"><div class="titlepage"><div><p xmlns:d="http://docbook.org/ns/docbook" id="title"><a href="http://www.jboss.org" class="site_href"><strong>JBoss.org</strong></a><a href="http://docs.jboss.org/" class="doc_href"><strong>Community Documentation</strong></a></p><div><h1 class="title"><a id="d0e1"/>Drools Planner User Guide</h1></div><div><div xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="authorgroup"><div class="authors">by <span xmlns="http://www.w3.org/1999/xhtml" class="orgname"><a class="link" href="http://www.jboss.org/drools/team.html" target="">The JBoss Drools team</a></span></div><div class="editors"/><div class="others"/></div></div><div><p class="releaseinfo">5.2.0.M2</p></div></div><hr/></div><div class="toc"><dl><dt><span class="preface"><a href="#d0e19"/></span></dt><dt><span class="chapter"><a href="#d0e23">1. Planner introduction</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e26">1.1. What is Drools Planner?</a></span></dt><dt><span class="section"><a href="#d0e126">1.2. Status of Drools Planner</a></span></dt><dt><span class="section"><a href="#d0e137">1.3. Getting Drools Planner and running the examples</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e140">1.3.1. Getting the release package and running the examples</a></span></dt><dt><span class="section"><a href="#d0e161">1.3.2. Get it with maven</a></span></dt><dt><span class="section"><a href="#d0e184">1.3.3. Build it from source</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e195">1.4. Questions, issues and blogs</a></span></dt></dl></dd><dt><span class="chapter"><a href="#d0e230">2. Use cases and examples</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e233">2.1. Introduction</a></span></dt><dt><span class="section"><a href="#d0e243">2.2. The n queens example</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e246">2.2.1. Screenshot</a></span></dt><dt><span class="section"><a href="#d0e257">2.2.2. Problem statement</a></span></dt><dt><span class="section"><a href="#d0e290">2.2.3. Solution(s)</a></span></dt><dt><span class="section"><a href="#d0e303">2.2.4. Problem size</a></span></dt><dt><span class="section"><a href="#d0e393">2.2.5. Domain class diagram</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e490">2.3. The ITC 2007 curriculum course example</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e493">2.3.1. Problem statement</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e501">2.4. The ITC 2007 examination example</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e504">2.4.1. Screenshot</a></span></dt><dt><span class="section"><a href="#d0e515">2.4.2. Problem statement</a></span></dt><dt><span class="section"><a href="#d0e581">2.4.3. Problem size</a></span></dt><dt><span class="section"><a href="#d0e764">2.4.4. Domain class diagram</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e795">2.5. The INRC 2010 nurse rostering example</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e798">2.5.1. Problem statement</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e806">2.6. The traveling tournament example</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e809">2.6.1. Screenshot</a></span></dt><dt><span class="section"><a href="#d0e820">2.6.2. Problem statement</a></span></dt><dt><span class="section"><a href="#d0e847">2.6.3. Simple and smart implementation</a></span></dt><dt><span class="section"><a href="#d0e859">2.6.4. Problem size</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e1005">2.7. The Manners 2009 example</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e1008">2.7.1. Problem statement</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e1029">2.8. The patient admission scheduling (PAS) example</a></span></dt></dl></dd><dt><span class="chapter"><a href="#d0e1069">3. Planner configuration</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e1072">3.1. Types of solvers</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e1077">3.1.1. Brute force</a></span></dt><dt><span class="section"><a href="#d0e1099">3.1.2. Branch and bound</a></span></dt><dt><span class="section"><a href="#d0e1121">3.1.3. Simplex</a></span></dt><dt><span class="section"><a href="#d0e1140">3.1.4. Genetic algorithms</a></span></dt><dt><span class="section"><a href="#d0e1163">3.1.5. Local search (tabu search, simulated annealing, ...)</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e1195">3.2. The size of real world problems</a></span></dt><dt><span class="section"><a href="#d0e1207">3.3. The Solver interface</a></span></dt><dt><span class="section"><a href="#d0e1242">3.4. Building a Solver</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e1265">3.4.1. Environment mode</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e1312">3.5. The Solution interface</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e1336">3.5.1. The getScore and setScore methods</a></span></dt><dt><span class="section"><a href="#d0e1363">3.5.2. The getFacts method</a></span></dt><dt><span class="section"><a href="#d0e1379">3.5.3. The cloneSolution method</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e1405">3.6. The starting solution</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e1412">3.6.1. A simple filler algorithm</a></span></dt><dt><span class="section"><a href="#d0e1429">3.6.2. StartingSolutionInitializer</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e1471">3.7. Solving a problem</a></span></dt></dl></dd><dt><span class="chapter"><a href="#d0e1491">4. Score calculation with a rule engine</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e1494">4.1. Rule based score calculation</a></span></dt><dt><span class="section"><a href="#d0e1509">4.2. Defining the score rules source</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e1514">4.2.1. A scoreDrl resource on the classpath</a></span></dt><dt><span class="section"><a href="#d0e1529">4.2.2. A RuleBase (possibly defined by Guvnor)</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e1548">4.3. Implementing a score rule</a></span></dt><dt><span class="section"><a href="#d0e1582">4.4. Delta based score calculation</a></span></dt><dt><span class="section"><a href="#d0e1610">4.5. The ScoreDefinition interface</a></span></dt><dt><span class="section"><a href="#d0e1695">4.6. Tips and tricks</a></span></dt></dl></dd><dt><span class="chapter"><a href="#d0e1759">5. Local search solver</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e1762">5.1. Overview</a></span></dt><dt><span class="section"><a href="#d0e1810">5.2. A move</a></span></dt><dt><span class="section"><a href="#d0e1964">5.3. Move generation</a></span></dt><dt><span class="section"><a href="#d0e1996">5.4. A step</a></span></dt><dt><span class="section"><a href="#d0e2066">5.5. Getting stuck in local optima</a></span></dt><dt><span class="section"><a href="#d0e2089">5.6. Deciding the next step</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e2128">5.6.1. Selector</a></span></dt><dt><span class="section"><a href="#d0e2142">5.6.2. Acceptor</a></span></dt><dt><span class="section"><a href="#d0e2247">5.6.3. Forager</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e2306">5.7. Best solution</a></span></dt><dt><span class="section"><a href="#d0e2321">5.8. Termination</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e2339">5.8.1. TimeMillisSpendTermination</a></span></dt><dt><span class="section"><a href="#d0e2357">5.8.2. StepCountTermination</a></span></dt><dt><span class="section"><a href="#d0e2364">5.8.3. ScoreAttainedTermination</a></span></dt><dt><span class="section"><a href="#d0e2375">5.8.4. UnimprovedStepCountTermination</a></span></dt><dt><span class="section"><a href="#d0e2384">5.8.5. Combining Terminations</a></span></dt><dt><span class="section"><a href="#d0e2397">5.8.6. Another thread can ask a Solver to terminate early</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e2421">5.9. Using a custom Selector, Acceptor, Forager or Termination</a></span></dt></dl></dd><dt><span class="chapter"><a href="#d0e2459">6. Benchmarking and tweaking</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e2462">6.1. Finding the best configuration</a></span></dt><dt><span class="section"><a href="#d0e2469">6.2. Building a Benchmarker</a></span></dt><dt><span class="section"><a href="#d0e2513">6.3. Best score over time statistic (graph and CSV)</a></span></dt></dl></dd><dt><span class="index"><a href="#d0e2536">Index</a></span></dt></dl></div><div class="preface" lang="en-US"><div class="titlepage"/><div class="mediaobject"><img src="images/droolsPlannerLogo.png"/></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e23"/>Chapter 1. Planner introduction</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#d0e26">1.1. What is Drools Planner?</a></span></dt><dt><span class="section"><a href="#d0e126">1.2. Status of Drools Planner</a></span></dt><dt><span class="section"><a href="#d0e137">1.3. Getting Drools Planner and running the examples</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e140">1.3.1. Getting the release package and running the examples</a></span></dt><dt><span class="section"><a href="#d0e161">1.3.2. Get it with maven</a></span></dt><dt><span class="section"><a href="#d0e184">1.3.3. Build it from source</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e195">1.4. Questions, issues and blogs</a></span></dt></dl></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e26"/>1.1. What is Drools Planner?</h2></div></div></div><p><span class="bold"><strong><a class="link" href="http://www.jboss.org/drools/drools-planner" target="">Drools Planner</a>
    optimizes automated planning</strong></span> by combining a search algorithm with the power of the Drools rule engine.
    Use cases of planning problems include:</p><div class="itemizedlist"><ul><li><p>Employee shift rostering, such as nurse rostering</p></li><li><p>Vehicle routing, freight routing and people routing, such as <a class="link" href="http://en.wikipedia.org/wiki/Travelling_salesman_problem" target="">The traveling salesman problem</a> and
        <a class="link" href="http://mat.gsia.cmu.edu/TOURN/" target="">The traveling tournament problem</a></p></li><li><p>Educational timetabling, such as lesson scheduling, course schedule, exam scheduling and conference
        scheduling</p></li><li><p>Bin packing, stock sorting and storage organizing</p></li><li><p>Machine queue planning</p></li><li><p>Miss manners too (although the Drools Planner example solves this differently than the pure Drools Expert
        example)</p></li></ul></div><p>A planning problem consists out of a number of constraints. Generally, there are 3 types of
    constraints:</p><div class="itemizedlist"><ul><li><p>A <span class="emphasis"><em>(negative) hard constraint</em></span> must not be broken. For example: <span class="emphasis"><em>1 teacher can
        not teach 2 different lessons at the same time</em></span>.</p></li><li><p>A <span class="emphasis"><em>(negative) soft constraint</em></span> should not be broken if it can be avoided. For example:
        <span class="emphasis"><em>Teacher A does not like to teach on Friday afternoon</em></span>.</p></li><li><p>A <span class="emphasis"><em>positive constraint (or reward)</em></span> should be fulfilled if possible. For example:
        <span class="emphasis"><em>Teacher B likes to teach on Monday morning</em></span>.</p></li></ul></div><p>These constraints define the <span class="emphasis"><em>score function</em></span> of a planning problem. This is where the
    drools rule engine comes into play: <span class="bold"><strong>adding constraints with score rules is easy and
    scalable</strong></span>.</p><p>A planning problem has a number of <span class="emphasis"><em>solutions</em></span>. Each solution has a score. There are 3
    categories of solutions:</p><div class="itemizedlist"><ul><li><p>A <span class="emphasis"><em>possible solution</em></span> is a solution that does or does not break any number of
        constraints. Planning problems tend to have a incredibly large number of possible solutions. Most of those
        solutions are worthless.</p></li><li><p>A <span class="emphasis"><em>feasible solution</em></span> is a solution that does not break any (negative) hard
        constraints. The number of feasible solutions tends to be relative to the number of possible solutions.
        Sometimes there are no feasible solutions. Every feasible solution is a possible solution.</p></li><li><p>An <span class="emphasis"><em>optimal solution</em></span> is a solution with the highest score. Planning problems tend to
        have 1 or a few optimal solutions. There is always at least 1 optimal solution, even in the remote case that
        it's not a feasible solution because there are no feasible solutions.</p></li></ul></div><p>Drools Planner supports several search algorithms to efficiently wade through the incredibly large number of
    possible solutions. <span class="bold"><strong>It makes it easy to switch the search algorithm</strong></span>, by simply
    changing the solver configuration.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e126"/>1.2. Status of Drools Planner</h2></div></div></div><p>Drools Planner is production ready. The API is almost stable but backward incompatible changes can
    occur. With the recipe called
    <a class="link" href="https://github.com/droolsjbpm/drools-planner/blob/master/drools-planner-distribution/src/main/assembly/docs/UpgradeFromPreviousVersionRecipe.txt" target=""><code class="filename">UpgradeFromPreviousVersionRecipe.txt</code></a>
    you can easily upgrade and deal with any backwards incompatible changes between versions.
    This recipe is included in every release.</p><p>Drools Planner, like Drools, is open source software under the Apache Software License.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e137"/>1.3. Getting Drools Planner and running the examples</h2></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e140"/>1.3.1. Getting the release package and running the examples</h3></div></div></div><p>You can download a release of Drools Planner from <a class="link" href="http://www.jboss.org/drools/downloads.html" target="">the drools download site</a>. To run an example, just
      open the directory <code class="filename">examples</code> and run the script (<code class="filename">runExamples.sh</code> on linux
      or <code class="filename">runExamples.bat</code> on windows) and pick an example:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">$ cd examples
$ ./runExamples.sh</pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">$ cd examples
$ runExamples.bat</pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e161"/>1.3.2. Get it with maven</h3></div></div></div><p>The Drools Planner jars are available on <a class="link" href="http://repository.jboss.com/maven2/" target="">the jboss
      maven repository</a>. If you use maven 2 or 3, just add a dependency to <code class="literal">drools-planner-core</code>
      in your project's <code class="filename">pom.xml</code>:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">dependency</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">groupId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.drools.planner</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">groupId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">artifactId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">drools-planner-core</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">artifactId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">version</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">5.x</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">version</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">dependency</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre><p>You might also need to add the jboss repository in your repository manager (nexus, archiva, ...) or your
      <code class="filename">~/settings.xml</code>:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">repositories</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">repository</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">id</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">jboss-public-repository-group</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">id</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">name</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">JBoss&nbsp;Public&nbsp;Maven&nbsp;Repository&nbsp;Group</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">name</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">url</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">https://repository.jboss.org/nexus/content/groups/public/</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">url</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">releases</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">enabled</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">true</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">enabled</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">releases</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">snapshots</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">enabled</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">true</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">enabled</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">snapshots</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">repository</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">repositories</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e184"/>1.3.3. Build it from source</h3></div></div></div><p>You can also easily build it from source yourself. Clone drools from GitHub and do a maven 2
      build:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">$ git clone git@github.com:droolsjbpm/drools-planner.git drools-planner
...
$ cd drools-planner
$ mvn -DskipTests clean install
...</pre><p>After that, you can run any example directly from the command line, just run this command and pick an
      example:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">$ cd drools-planner-examples
$ mvn exec:exec
...</pre></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e195"/>1.4. Questions, issues and blogs</h2></div></div></div><p>Your questions and remarks are welcome on <a class="link" href="http://www.jboss.org/drools/lists.html" target="">the user
    mailing list</a>. Start the subject of your mail with <code class="literal">[planner]</code>. You can read/write to the
    user mailing list without littering your mailbox through <a class="link" href="http://n3.nabble.com/Drools-User-f47000.html" target="">this web forum</a> or <a class="link" href="nntp://news.gmane.org/gmane.comp.java.drools.user" target="">this newsgroup</a>.</p><p>Feel free to report an issue (such as a bug, improvement or a new feature request) for the Drools Planner code
    or for this manual to <a class="link" href="https://jira.jboss.org/jira/browse/JBRULES" target="">the drools issue tracker</a>.
    Select the component <code class="literal">drools-planner</code>.</p><p>Pull requests (and patches) are very welcome and get priority treatment! Attach them to a JIRA issue and optionally send a mail to
    the dev mailing list to get the issue fixed fast. By open sourcing your improvements, you 'll benefit from our peer
    review, improvements made upon your improvements and maybe even a thank you on our blog.</p><p>Check <a class="link" href="http://blog.athico.com/search/label/planner" target="">our blog</a> and twitter (<a class="link" href="http://twitter.com/geoffreydesmet" target="">Geoffrey De Smet</a>) for news.
    If Drools Planner helps you, don't forget to blog or to twitter about it!</p></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e230"/>Chapter 2. Use cases and examples</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#d0e233">2.1. Introduction</a></span></dt><dt><span class="section"><a href="#d0e243">2.2. The n queens example</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e246">2.2.1. Screenshot</a></span></dt><dt><span class="section"><a href="#d0e257">2.2.2. Problem statement</a></span></dt><dt><span class="section"><a href="#d0e290">2.2.3. Solution(s)</a></span></dt><dt><span class="section"><a href="#d0e303">2.2.4. Problem size</a></span></dt><dt><span class="section"><a href="#d0e393">2.2.5. Domain class diagram</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e490">2.3. The ITC 2007 curriculum course example</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e493">2.3.1. Problem statement</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e501">2.4. The ITC 2007 examination example</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e504">2.4.1. Screenshot</a></span></dt><dt><span class="section"><a href="#d0e515">2.4.2. Problem statement</a></span></dt><dt><span class="section"><a href="#d0e581">2.4.3. Problem size</a></span></dt><dt><span class="section"><a href="#d0e764">2.4.4. Domain class diagram</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e795">2.5. The INRC 2010 nurse rostering example</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e798">2.5.1. Problem statement</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e806">2.6. The traveling tournament example</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e809">2.6.1. Screenshot</a></span></dt><dt><span class="section"><a href="#d0e820">2.6.2. Problem statement</a></span></dt><dt><span class="section"><a href="#d0e847">2.6.3. Simple and smart implementation</a></span></dt><dt><span class="section"><a href="#d0e859">2.6.4. Problem size</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e1005">2.7. The Manners 2009 example</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e1008">2.7.1. Problem statement</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e1029">2.8. The patient admission scheduling (PAS) example</a></span></dt></dl></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e233"/>2.1. Introduction</h2></div></div></div><p>Drools Planner has several examples. In this manual we explain Drools Planner mainly using the n queens
    example. So it's advisable to read at least the section about that example. For advanced users, the following
    examples are recommended: curriculum course, examination and nurse rostering.</p><p>You can find the source code of all these examples in the drools source distribution and also in subversion
    under <code class="filename">drools-planner/drools-planner-examples</code>.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e243"/>2.2. The n queens example</h2></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e246"/>2.2.1. Screenshot</h3></div></div></div><p>Here is a screenshot of the example:</p><div class="figure"><a id="d0e251"/><div class="figure-contents"><div class="mediaobject"><img src="images/Chapter-Use_cases_and_examples/screenshotNQueens.png" alt="Screenshot of the n queens example"/></div></div><p class="title"><b>Figure 2.1. Screenshot of the n queens example</b></p></div><br class="figure-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e257"/>2.2.2. Problem statement</h3></div></div></div><p>The <span class="emphasis"><em>n queens puzzle</em></span> is a puzzle with the follow constraints:</p><div class="itemizedlist"><ul><li><p>Use a chessboard of n rows and n columns.</p></li><li><p>Place n queens on the chessboard.</p></li><li><p>No 2 queens can attack each other. Note that a queen can attack any other queen on the same horizontal,
          vertical or diagonal line.</p></li></ul></div><p>The most common n queens puzzle is the 8 queens puzzle, with <span class="emphasis"><em>n = 8</em></span>. We 'll explain
      Drools Planner using the 4 queens puzzle as the primary example.</p><p>A proposed solution could be:</p><div class="figure"><a id="d0e282"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Use_cases_and_examples/partiallySolvedNQueens04Explained.png" align="middle" alt="A wrong solution for the 4 queens puzzle"/></div></div><p class="title"><b>Figure 2.2. A wrong solution for the 4 queens puzzle</b></p></div><br class="figure-break"/><p>The above solution is wrong because queens A1 and B0 can attack each other (as can queens B0 and D0).
      Removing queen B0 would respect the "no 2 queens can attack each other" constraint, but would break the "place n
      queens" constraint.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e290"/>2.2.3. Solution(s)</h3></div></div></div><p>Below is a correct solution:</p><div class="figure"><a id="d0e295"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Use_cases_and_examples/solvedNQueens04.png" align="middle" alt="A correct solution for the 4 queens puzzle"/></div></div><p class="title"><b>Figure 2.3. A correct solution for the 4 queens puzzle</b></p></div><br class="figure-break"/><p>All the constraints have been met, so the solution is correct. Note that most n queens puzzles have multiple
      correct solutions. We 'll focus on finding a single correct solution for a given n, not on finding the number of
      possible correct solutions for a given n.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e303"/>2.2.4. Problem size</h3></div></div></div><p>These numbers might give you some insight on the size of this problem.</p><div class="table"><a id="d0e308"/><p class="title"><b>Table 2.1. NQueens problem size</b></p><div class="table-contents"><table summary="NQueens problem size" border="1"><colgroup><col/><col/><col/><col/><col/></colgroup><thead><tr><th># queens (n)</th><th># possible solutions (each queen its own column)</th><th># feasible solutions (distinct)</th><th># optimal solutions (distinct)</th><th># possible / # optimal</th></tr></thead><tbody><tr><td>4</td><td>256</td><td>2</td><td>2</td><td>128</td></tr><tr><td>8</td><td>16777216</td><td>64</td><td>64</td><td>262144</td></tr><tr><td>16</td><td>18446744073709551616</td><td>14772512</td><td>14772512</td><td>1248720872503</td></tr><tr><td>32</td><td>1.46150163733090291820368483e+48</td><td>?</td><td>?</td><td>?</td></tr><tr><td>64</td><td>3.94020061963944792122790401e+115</td><td>?</td><td>?</td><td>?</td></tr><tr><td>n</td><td>n ^ n</td><td>?</td><td># feasible solutions</td><td>?</td></tr></tbody></table></div></div><br class="table-break"/><p>The Drools Planner implementation has not been optimized because it functions as a beginner example.
      Nevertheless, it can easily handle 64 queens.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e393"/>2.2.5. Domain class diagram</h3></div></div></div><p>Use a good domain model and it will be easier to understand and solve your problem with Drools Planner. We
      'll use this domain model for the n queens example:</p><div class="figure"><a id="d0e398"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Use_cases_and_examples/nQueensDomainDiagram.png" align="middle" alt="NQueens domain class diagram"/></div></div><p class="title"><b>Figure 2.4. NQueens domain class diagram</b></p></div><br class="figure-break"/><p>A <code class="literal">Queen</code> instance has an x (its column, for example: 0 is column A, 1 is column B, ...)
      and a y (its row, for example: 0 is row 0, 1 is row 1, ...). Based on the x and y, the ascending diagonal line as
      well as the descending diagonal line can be calculated. The x and y indexes start from the upper left corner of
      the chessboard.</p><div class="table"><a id="d0e409"/><p class="title"><b>Table 2.2. A solution for the 4 queens puzzle shown in the domain model</b></p><div class="table-contents"><table summary="A solution for the 4 queens puzzle shown in the domain model" border="1"><colgroup><col/><col/><col/><col/><col/><col/></colgroup><thead><tr><th align="center">A solution</th><th align="center">Queen</th><th>x</th><th>y</th><th>ascendingD (x + y)</th><th>descendingD (x - y)</th></tr></thead><tbody><tr><td rowspan="4"><div class="mediaobject"><img src="images/Chapter-Use_cases_and_examples/partiallySolvedNQueens04Explained.png"/></div></td><td>A1</td><td>0</td><td>1</td><td>1 (**)</td><td>-1</td></tr><tr><td>B0</td><td>1</td><td>0 (*)</td><td>1 (**)</td><td>1</td></tr><tr><td>C2</td><td>2</td><td>2</td><td>4</td><td>0</td></tr><tr><td>D0</td><td>3</td><td>0 (*)</td><td>3</td><td>3</td></tr></tbody></table></div></div><br class="table-break"/><p>A single <code class="literal">NQueens</code> instance contains a list of all <code class="literal">Queen</code> instances. It
      is the <code class="literal">Solution</code> implementation which will be supplied to and retrieved from the Solver. Notice
      that in the 4 queens example, NQueens's <code class="literal">getN()</code> method will always return 4.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e490"/>2.3. The ITC 2007 curriculum course example</h2></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e493"/>2.3.1. Problem statement</h3></div></div></div><p>Schedule lectures into rooms and time periods.</p><p><a class="link" href="http://www.cs.qub.ac.uk/itc2007/curriculmcourse/course_curriculm_index.htm" target="">You can find a
      more detailed description of this problem here.</a></p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e501"/>2.4. The ITC 2007 examination example</h2></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e504"/>2.4.1. Screenshot</h3></div></div></div><p>Here is a screenshot of the example:</p><div class="figure"><a id="d0e509"/><div class="figure-contents"><div class="mediaobject"><img src="images/Chapter-Use_cases_and_examples/screenshotExamination.png" alt="Screenshot of the examination example"/></div></div><p class="title"><b>Figure 2.5. Screenshot of the examination example</b></p></div><br class="figure-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e515"/>2.4.2. Problem statement</h3></div></div></div><p>Schedule each exam into a period and into a room. Multiple exams can share the same room during the same
      period.</p><p>There are a number of hard constraints that cannot be broken:</p><div class="itemizedlist"><ul><li><p>Exam conflict: 2 exams that share students should not occur in the same period.</p></li><li><p>Room capacity: A room's seating capacity should suffice at all times.</p></li><li><p>Period duration: A period's duration should suffice for all of its exams.</p></li><li><p>Period related hard constraints should be fulfilled:</p><div class="itemizedlist"><ul><li><p>Coincidence: 2 exams should use the same period (but possibly another room).</p></li><li><p>Exclusion: 2 exams should not use the same period.</p></li><li><p>After: 1 exam should occur in a period after another exam's period.</p></li></ul></div></li><li><p>Room related hard constraints should be fulfilled:</p><div class="itemizedlist"><ul><li><p>Exclusive: 1 exam should not have to share its room with any other exam.</p></li></ul></div></li></ul></div><p>There are also a number of soft constraints that should be minimized (each of which has parameterized
      penalty's):</p><div class="itemizedlist"><ul><li><p>2 exams in a row.</p></li><li><p>2 exams in a day.</p></li><li><p>Period spread: 2 exams that share students should be a number of periods apart.</p></li><li><p>Mixed durations: 2 exams that share a room should not have different durations.</p></li><li><p>Front load: Large exams should be scheduled earlier in the schedule.</p></li><li><p>Period penalty: Some periods have a penalty when used.</p></li><li><p>Room penalty: Some rooms have a penalty when used.</p></li></ul></div><p>It uses large test data sets of real-life universities.</p><p><a class="link" href="http://www.cs.qub.ac.uk/itc2007/examtrack/exam_track_index.htm" target="">You can find a more
      detailed description of this problem here.</a></p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e581"/>2.4.3. Problem size</h3></div></div></div><p>These numbers might give you some insight on the size of this problem.</p><div class="table"><a id="d0e586"/><p class="title"><b>Table 2.3. Examination problem size</b></p><div class="table-contents"><table summary="Examination problem size" border="1"><colgroup><col/><col/><col/><col/><col/><col/><col/><col/></colgroup><thead><tr><th>Set</th><th># students</th><th># exams/topics</th><th># periods</th><th># rooms</th><th># possible solutions</th><th># feasible solutions</th><th># optimal solutions</th></tr></thead><tbody><tr><td>exam_comp_set1</td><td>7883</td><td>607</td><td>54</td><td>7</td><td>10^1564</td><td>?</td><td>1?</td></tr><tr><td>exam_comp_set2</td><td>12484</td><td>870</td><td>40</td><td>49</td><td>10^2864</td><td>?</td><td>1?</td></tr><tr><td>exam_comp_set3</td><td>16365</td><td>934</td><td>36</td><td>48</td><td>10^3023</td><td>?</td><td>1?</td></tr><tr><td>exam_comp_set4</td><td>4421</td><td>273</td><td>21</td><td>1</td><td>10^360</td><td>?</td><td>1?</td></tr><tr><td>exam_comp_set5</td><td>8719</td><td>1018</td><td>42</td><td>3</td><td>10^2138</td><td>?</td><td>1?</td></tr><tr><td>exam_comp_set6</td><td>7909</td><td>242</td><td>16</td><td>8</td><td>10^509</td><td>?</td><td>1?</td></tr><tr><td>exam_comp_set7</td><td>13795</td><td>1096</td><td>80</td><td>28</td><td>10^3671</td><td>?</td><td>1?</td></tr><tr><td>exam_comp_set8</td><td>7718</td><td>598</td><td>80</td><td>8</td><td>10^1678</td><td>?</td><td>1?</td></tr><tr><td>?</td><td>s</td><td>t</td><td>p</td><td>r</td><td>(p * r) ^ e</td><td>?</td><td>1?</td></tr></tbody></table></div></div><br class="table-break"/><p>Geoffrey De Smet (the Drools Planner lead) finished 4th in the International Timetabling Competition 2007's
      examination track with a very early version of Drools Planner. Many improvements have been made since then.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e764"/>2.4.4. Domain class diagram</h3></div></div></div><p>Below you can see the main examination domain classes:</p><div class="figure"><a id="d0e769"/><div class="figure-contents"><div class="mediaobject"><img src="images/Chapter-Use_cases_and_examples/examinationDomainDiagram.png" alt="Examination domain class diagram"/></div></div><p class="title"><b>Figure 2.6. Examination domain class diagram</b></p></div><br class="figure-break"/><p>Notice that we've split up the exam concept into an <code class="literal">Exam</code> class and a
      <code class="literal">Topic</code> class. The <code class="literal">Exam</code> instances change during solving, when they get another
      period or room property. The <code class="literal">Topic</code>, <code class="literal">Period</code> and <code class="literal">Room</code>
      instances never change during solving.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e795"/>2.5. The INRC 2010 nurse rostering example</h2></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e798"/>2.5.1. Problem statement</h3></div></div></div><p>Schedule nurses into shifts.</p><p><a class="link" href="http://www.kuleuven-kortrijk.be/nrpcompetition" target="">You can find a more detailed description
      of this problem here.</a></p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e806"/>2.6. The traveling tournament example</h2></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e809"/>2.6.1. Screenshot</h3></div></div></div><p>Here is a screenshot of the example:</p><div class="figure"><a id="d0e814"/><div class="figure-contents"><div class="mediaobject"><img src="images/Chapter-Use_cases_and_examples/screenshotTravelingTournament.png" alt="Screenshot of the traveling tournament example"/></div></div><p class="title"><b>Figure 2.7. Screenshot of the traveling tournament example</b></p></div><br class="figure-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e820"/>2.6.2. Problem statement</h3></div></div></div><p>Schedule matches between N teams with the following hard constraints:</p><div class="itemizedlist"><ul><li><p>Each team plays twice against every other team: once home and once away.</p></li><li><p>Each team has exactly 1 match on each timeslot.</p></li><li><p>No team must have more than 3 consecutive home or 3 consecutive away matches.</p></li><li><p>No repeaters: no 2 consecutive matches of the same 2 opposing teams.</p></li></ul></div><p>and the following soft constraint:</p><div class="itemizedlist"><ul><li><p>Minimize the total distance traveled by all teams.</p></li></ul></div><p><a class="link" href="http://mat.gsia.cmu.edu/TOURN/" target="">You can find a detailed description as well as several
      records of this problem here.</a></p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e847"/>2.6.3. Simple and smart implementation</h3></div></div></div><p>There are 2 implementations (simple and smart) to demonstrate the importance of some performance tips. The
      <code class="literal">DroolsPlannerExamplesApp</code> always runs the smart implementation, but with these commands you can compare the 2
      implementations yourself:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">$ mvn exec:exec -Dexec.mainClass="org.drools.planner.examples.travelingtournament.app.simple.SimpleTravelingTournamentApp"
...
$ mvn exec:exec -Dexec.mainClass="org.drools.planner.examples.travelingtournament.app.smart.SmartTravelingTournamentApp"
...</pre><p>The smart implementation performs and scales exponentially better than the simple implementation.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e859"/>2.6.4. Problem size</h3></div></div></div><p>These numbers might give you some insight on the size of this problem.</p><div class="table"><a id="d0e864"/><p class="title"><b>Table 2.4. Traveling tournament problem size</b></p><div class="table-contents"><table summary="Traveling tournament problem size" border="1"><colgroup><col/><col/><col/><col/><col/><col/><col/></colgroup><thead><tr><th># teams</th><th># days</th><th># matches</th><th># possible solutions (simple)</th><th># possible solutions (smart)</th><th># feasible solutions</th><th># optimal solutions</th></tr></thead><tbody><tr><td>4</td><td>6</td><td>12</td><td>2176782336</td><td>&lt;= 518400</td><td>?</td><td>1?</td></tr><tr><td>6</td><td>10</td><td>30</td><td>1000000000000000000000000000000</td><td>&lt;= 47784725839872000000</td><td>?</td><td>1?</td></tr><tr><td>8</td><td>14</td><td>56</td><td>1.52464943788290465606136043e+64</td><td>&lt;= 5.77608277425558771434498864e+43</td><td>?</td><td>1?</td></tr><tr><td>10</td><td>18</td><td>90</td><td>9.43029892325559280477052413e+112</td><td>&lt;= 1.07573451027871200629339068e+79</td><td>?</td><td>1?</td></tr><tr><td>12</td><td>22</td><td>132</td><td>1.58414112478195320415135060e+177</td><td>&lt;= 2.01650616733413376416949843e+126</td><td>?</td><td>1?</td></tr><tr><td>14</td><td>26</td><td>182</td><td>3.35080635695103223315189511e+257</td><td>&lt;= 1.73513467024013808570420241e+186</td><td>?</td><td>1?</td></tr><tr><td>16</td><td>30</td><td>240</td><td>3.22924601799855400751522483e+354</td><td>&lt;= 2.45064610271441678267620602e+259</td><td>?</td><td>1?</td></tr><tr><td>n</td><td>2 * (n - 1)</td><td>n * (n - 1)</td><td>(2 * (n - 1)) ^ (n * (n - 1))</td><td>&lt;= (((2 * (n - 1))!) ^ (n / 2))</td><td>?</td><td>1?</td></tr></tbody></table></div></div><br class="table-break"/></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e1005"/>2.7. The Manners 2009 example</h2></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e1008"/>2.7.1. Problem statement</h3></div></div></div><p>In Manners 2009, miss Manners is throwing a party again.</p><div class="itemizedlist"><ul><li><p>This time she invited 144 guests and prepared 12 round tables with 12 seats each.</p></li><li><p>Every guest should sit next to someone (left and right) of the opposite gender.</p></li><li><p>And that neighbour should have at least one hobby in common with the guest.</p></li><li><p>Also, this time there should be 2 politicians, 2 doctors, 2 socialites, 2 sports stars, 2 teachers and 2
          programmers at each table.</p></li><li><p>And the 2 politicians, 2 doctors, 2 sports stars and 2 programmers shouldn't be the same kind.</p></li></ul></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e1029"/>2.8. The patient admission scheduling (PAS) example</h2></div></div></div><p>In this problem, we have to assign each patient (that will come to the hospital) a bed for each night that the
    patient will stay in the hospital. Each bed belongs to a room and each room belongs to a department. The arrival and
    departure dates of the patients is fixed: only a bed needs to be assigned for each night.</p><p>There are a couple of hard constraints:</p><div class="itemizedlist"><ul><li><p>2 patients shouldn't be assigned to the same bed in the same night.</p></li><li><p>A room can have a gender limitation: only females, only males, the same gender in the same night or no
        gender limitation at all.</p></li><li><p>A department can have a minimum or maximum age.</p></li><li><p>A patient can require a room with specific equipment(s).</p></li></ul></div><p>And of course, there are also some soft constraints:</p><div class="itemizedlist"><ul><li><p>A patient can prefer a maximum room size, for example if he/she want a single room.</p></li><li><p>A patient is best assigned to a department that specializes in his/her problem.</p></li><li><p>A patient is best assigned to a room that specializes in his/her problem.</p></li><li><p>A patient can prefer a room with specific equipment(s).</p></li></ul></div><p>The problem is defined on <a class="link" href="http://allserv.kahosl.be/~peter/pas/" target="">this webpage</a> and the
    test data comes from real world hospitals.</p></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e1069"/>Chapter 3. Planner configuration</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#d0e1072">3.1. Types of solvers</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e1077">3.1.1. Brute force</a></span></dt><dt><span class="section"><a href="#d0e1099">3.1.2. Branch and bound</a></span></dt><dt><span class="section"><a href="#d0e1121">3.1.3. Simplex</a></span></dt><dt><span class="section"><a href="#d0e1140">3.1.4. Genetic algorithms</a></span></dt><dt><span class="section"><a href="#d0e1163">3.1.5. Local search (tabu search, simulated annealing, ...)</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e1195">3.2. The size of real world problems</a></span></dt><dt><span class="section"><a href="#d0e1207">3.3. The Solver interface</a></span></dt><dt><span class="section"><a href="#d0e1242">3.4. Building a Solver</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e1265">3.4.1. Environment mode</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e1312">3.5. The Solution interface</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e1336">3.5.1. The getScore and setScore methods</a></span></dt><dt><span class="section"><a href="#d0e1363">3.5.2. The getFacts method</a></span></dt><dt><span class="section"><a href="#d0e1379">3.5.3. The cloneSolution method</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e1405">3.6. The starting solution</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e1412">3.6.1. A simple filler algorithm</a></span></dt><dt><span class="section"><a href="#d0e1429">3.6.2. StartingSolutionInitializer</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e1471">3.7. Solving a problem</a></span></dt></dl></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e1072"/>3.1. Types of solvers</h2></div></div></div><p>Different solvers solve problems in different ways. Each type has advantages and disadvantages. We 'll roughly
    discuss a few of the solver types here. You can safely skip this section.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e1077"/>3.1.1. Brute force</h3></div></div></div><p>Brute force creates and evaluates every possible solution, usually by creating a search tree.</p><p>Advantages:</p><div class="itemizedlist"><ul><li><p>It knows when it has found an optimal solution. If there is more then 1 optimal solution, it finds all
          optimal solutions.</p></li><li><p>It is straightforward and simple to implement.</p></li></ul></div><p>Disadvantages:</p><div class="itemizedlist"><ul><li><p>It performs and scales horribly. Mostly unusable for a real-world problem due to time
          limitations.</p></li></ul></div><p>Brute force is currently not implemented in Drools Planner. But we have plans to implement it in the future,
      as a reference for validating the output of the other solver types.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e1099"/>3.1.2. Branch and bound</h3></div></div></div><p>Branch and bound is an improvement over brute force, as it prunes away subsets of solutions which cannot
      have a better solution than the best solution already found at that point.</p><p>Advantages:</p><div class="itemizedlist"><ul><li><p>It knows when it has found an optimal solution. If there is more then 1 optimal solution, it can find
          all optimal solutions if needed.</p></li><li><p>It can determine the bounds of a problem, which gives an indication of the quality of a solution.</p></li></ul></div><p>Disadvantages:</p><div class="itemizedlist"><ul><li><p>It still scales very badly. Mostly unusable for a real-world problem due to time limitations.</p></li></ul></div><p>Branch and bound is currently not implemented in Drools Planner. But we have plans to implement it in the
      future, as a reference for validating the output of the other solver types.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e1121"/>3.1.3. Simplex</h3></div></div></div><p>Simplex is an algorithm to find the numerical solution of a linear programming problem.</p><p>Advantages:</p><div class="itemizedlist"><ul><li><p>It knows when it has found an optimal solution.</p></li></ul></div><p>Disadvantages:</p><div class="itemizedlist"><ul><li><p>It's complex and mathematical to implement constraints.</p></li></ul></div><p>Drools Planner does not implement simplex.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e1140"/>3.1.4. Genetic algorithms</h3></div></div></div><p>Advantages:</p><div class="itemizedlist"><ul><li><p>It's scalable.</p></li><li><p>Given a limited time, it can still deliver a pretty decent solution.</p></li></ul></div><p>Disadvantages:</p><div class="itemizedlist"><ul><li><p>It does not know when it has found an optimal solution.</p></li><li><p>If the optimal score is unknown (which is usually the case), it must be told when to stop looking (for
          example based on time spend, user input, ...).</p></li></ul></div><p>The genetic algorithm is currently not implemented in Drools Planner.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e1163"/>3.1.5. Local search (tabu search, simulated annealing, ...)</h3></div></div></div><p>Local search starts from an initial solution and evolves that single solution into a mostly better and
      better solution. It uses a single search path of solutions, not a search tree. At each solution in this path it
      evaluates a number of moves on the solution and applies the most suitable move to take the step to the next
      solution.</p><p>Local search works a lot like a human planner: it uses a single search path and moves facts around to find a
      good feasible solution.</p><p>A simple local search can easily get stuck in a local optima, but improvements (such as tabu search and
      simulated annealing) address this problem.</p><p>Advantages:</p><div class="itemizedlist"><ul><li><p>It's relatively simple and natural to implement constraints (at least in Drools Planner's
          implementation).</p></li><li><p>It's very scalable, even when adding extra constraints (at least in Drools Planner's
          implementation).</p></li><li><p>Given a limited time, it can still deliver a pretty decent solution.</p></li></ul></div><p>Disadvantages:</p><div class="itemizedlist"><ul><li><p>It does not know when it has found an optimal solution.</p></li><li><p>If the optimal score is unknown (which is usually the case), it must be told when to stop looking (for
          example based on time spend, user input, ...).</p></li></ul></div><p>Drools Planner implements local search, including tabu search and simulated annealing.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e1195"/>3.2. The size of real world problems</h2></div></div></div><p>As a planning problem gets bigger, the search space tends to blow up really fast. It's not uncommon to see
    that it's possible to optimally plan 5 people in less then a second, while planning 6 people optimally would take
    years. Take a look at the problem size of the examples: many instances have a lot more possible solutions than the
    minimal number of atoms in the known universe (10^80).</p><p>The cold, hard reality is that <span class="bold"><strong>for most real-world planning problems we will not find
    the optimal solution in our lifetimes.</strong></span> But that's OK, as long as we improve upon the solutions created by
    human planners (which is easy) or other systems.</p><p>Planning competitions (such as the International Timetabling Competition) show that local search variations
    (tabu search, simulated annealing, ...) usually perform best for real-world problems given real-world time
    limitations.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e1207"/>3.3. The Solver interface</h2></div></div></div><p>Solving a planning problem with Drools Planner consists out of 4 steps:</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>Build a solver, for example a tabu search solver for any NQueens puzzle.</p></li><li><p>Set a starting solution on the solver, for example a 4 Queens puzzle instance.</p></li><li><p>Solve it.</p></li><li><p>Get the best solution found by the solver.</p></li></ol></div><p>Every build-in solver implemented in Drools Planner implements the <code class="literal">Solver</code> interface:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">interface</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Solver</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setStartingSolution</span><span class="java_separator">(</span><span class="java_type">Solution</span><span class="java_plain">&nbsp;solution</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Solution</span><span class="java_plain">&nbsp;getBestSolution</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;solve</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;</span><span class="java_separator">...</span>
</span>
<!--  --><br/><span class="java_separator">}</span></pre><p>There is normally no need to implement the <code class="literal">Solver</code> interface yourself.</p><p>A <code class="literal">Solver</code> should only be accessed from a single thread, except for the methods that are
    specifically javadocced as thread-safe.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e1242"/>3.4. Building a Solver</h2></div></div></div><p>You can build a <code class="literal">Solver</code> instance with the <code class="literal">XmlSolverConfigurer</code>. Configure
    it with a solver configuration XML file:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><!-- <br/> --><span class="java_type">XmlSolverConfigurer</span><!-- <br/> --><span class="java_plain">&nbsp;configurer&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">new</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">XmlSolverConfigurer</span><!-- <br/> --><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;configurer</span><span class="java_separator">.</span><span class="java_plain">configure</span><span class="java_separator">(</span><span class="java_literal">&quot;/org/drools/planner/examples/nqueens/solver/nqueensSolverConfig.xml&quot;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Solver</span><span class="java_plain">&nbsp;solver&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;configurer</span><span class="java_separator">.</span><span class="java_plain">buildSolver</span><span class="java_separator">();</span></pre><p>A basic solver configuration file looks something like this:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_processing_instruction">&lt;?xml&nbsp;version=&quot;1.0&quot;&nbsp;encoding=&quot;UTF-8&quot;?&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">localSearchSolver</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">scoreDrl</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">/org/drools/planner/examples/nqueens/solver/nQueensScoreRules.drl</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">scoreDrl</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">scoreDefinition</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">scoreDefinitionType</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">SIMPLE</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">scoreDefinitionType</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">scoreDefinition</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">termination</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">scoreAttained</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">0</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">scoreAttained</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">termination</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">selector</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">moveFactoryClass</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.drools.planner.examples.nqueens.solver.NQueensMoveFactory</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">moveFactoryClass</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">selector</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">acceptor</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">completeSolutionTabuSize</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">1000</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">completeSolutionTabuSize</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">acceptor</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">forager</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">pickEarlyType</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">NEVER</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">pickEarlyType</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">forager</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">localSearchSolver</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre><p>This is a tabu search configuration for n queens. We 'll explain the various parts of a configuration later in
    this manual.</p><p><span class="bold"><strong>Drools Planner makes it relatively easy to switch a solver type just by changing the
    configuration.</strong></span> There's even a benchmark utility which allows you to play out different configurations
    against each other and report the most appropriate configuration for your problem. You could for example play out
    tabu search versus simulated annealing, on 4 queens and 64 queens.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e1265"/>3.4.1. Environment mode</h3></div></div></div><p>A solver has a single <code class="literal">Random</code> instance. Some solver configurations use the
      <code class="literal">Random</code> instance a lot more than others. For example simulated annealing depends highly on
      random numbers, while tabu search only depends on it to deal with score ties. The environment mode influences the
      seed of that <code class="literal">Random</code> instance.</p><p>The environment mode also allows you to detect common bugs in your implementation.</p><p>You can set the environment mode in the solver configuration XML file:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">localSearchSolver</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">environmentMode</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">DEBUG</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">environmentMode</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;...</span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">localSearchSolver</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre><p>There are 3 environment modes:</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e1287"/>3.4.1.1. DEBUG</h4></div></div></div><p>The debug mode is reproducible (see the reproducible mode) and also turns on assertions (such as assert
        that the undo Move is uncorrupted) to fail-fast on a bug in your Move implementation, your score rule,
        ...</p><p>The debug mode is slow.</p><p>It's recommended to write a test case which does a short run of your planning problem with debug mode
        on.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e1296"/>3.4.1.2. REPRODUCIBLE (default)</h4></div></div></div><p>The reproducible mode is the default mode because it is recommended during development. In this mode, 2
        runs on the same computer will execute the same code in the same order. They will also yield the same result,
        except if they use a time based termination and they have a sufficiently large difference in allocated CPU time.
        This allows you to benchmark new optimizations (such as a new move implementation or a different
        minimalAcceptedSelection setting) fairly.</p><p>The reproducible mode is not much slower than the production mode.</p><p>In practice, this mode uses the default random seed, and it also disables certain concurrency
        optimizations (such as work stealing).</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e1305"/>3.4.1.3. PRODUCTION</h4></div></div></div><p>The production mode is the fastest and the most robust, but not reproducible. It is recommended for a
        production environment.</p><p>The random seed is different on every run, which makes it more robust against an unlucky random seed. An
        unlucky random seed gives a bad result on a certain data set with a certain solver configuration. Note that in
        most use cases the impact of the random seed is relatively low on the result (even with simulated annealing). An
        occasional bad result is far more likely caused by another issue (such as a score trap).</p></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e1312"/>3.5. The Solution interface</h2></div></div></div><p>A Solver can only solve 1 problem instance at a time.</p><p>You need to present the problem as a starting <code class="literal">Solution</code> instance to the solver.</p><p>You need to implement the <code class="literal">Solution</code> interface:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">interface</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Solution</span><!-- <br/> --><span class="java_operator">&lt;</span><!-- <br/> --><span class="java_plain">S&nbsp;</span><!-- <br/> --><span class="java_keyword">extends</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Score</span><!-- <br/> --><span class="java_operator">&gt;</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;S&nbsp;getScore</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setScore</span><span class="java_separator">(</span><span class="java_plain">S&nbsp;score</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Collection</span><span class="java_operator">&lt;?</span><span class="java_plain">&nbsp;</span><span class="java_keyword">extends</span><span class="java_plain">&nbsp;</span><span class="java_type">Object</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;getFacts</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Solution</span><span class="java_operator">&lt;</span><span class="java_plain">S</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;cloneSolution</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_separator">}</span></pre><p>For example, an <code class="literal">NQueens</code> instance just holds a list of all its queens:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">class</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">NQueens</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">implements</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Solution</span><!-- <br/> --><span class="java_operator">&lt;</span><!-- <br/> --><span class="java_type">SimpleScore</span><!-- <br/> --><span class="java_operator">&gt;</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">Queen</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;queenList</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;</span><span class="java_separator">...</span>
</span>
<!--  --><br/><span class="java_separator">}</span></pre><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e1336"/>3.5.1. The getScore and setScore methods</h3></div></div></div><p>A <code class="literal">Solution</code> requires a score property. The score property is null if the
      <code class="literal">Solution</code> is uninitialized or if the score has not yet been (re)calculated. The score property
      is usually typed to the specific <code class="literal">Score</code> implementation you use. For example,
      <code class="literal">NQueens</code> uses a <code class="literal">SimpleScore</code>:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><!-- <br/> --><span class="java_keyword">private</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">SimpleScore</span><!-- <br/> --><span class="java_plain">&nbsp;score</span><!-- <br/> --><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">SimpleScore</span><span class="java_plain">&nbsp;getScore</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;score</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setScore</span><span class="java_separator">(</span><span class="java_type">SimpleScore</span><span class="java_plain">&nbsp;score</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">score&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;score</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span></pre><p>Most use cases use a <code class="literal">HardAndSoftScore</code> instead.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e1363"/>3.5.2. The getFacts method</h3></div></div></div><p>All objects returned by the <code class="literal">getFacts()</code> method will be asserted into the drools working
      memory. Those facts can be used by the score rules. For example, <code class="literal">NQueens</code> just returns all
      <code class="literal">Queen</code> instances.</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Collection</span><!-- <br/> --><span class="java_operator">&lt;?</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">extends</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Object</span><!-- <br/> --><span class="java_operator">&gt;</span><!-- <br/> --><span class="java_plain">&nbsp;getFacts</span><!-- <br/> --><span class="java_separator">()</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;queenList</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span></pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e1379"/>3.5.3. The cloneSolution method</h3></div></div></div><p>Most solvers use the <code class="literal">cloneSolution()</code> method to clone the solution each time they
      encounter a new best solution. The <code class="literal">NQueens</code> implementation just clones all
      <code class="literal">Queen</code> instances:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">NQueens</span><!-- <br/> --><span class="java_plain">&nbsp;cloneSolution</span><!-- <br/> --><span class="java_separator">()</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">NQueens</span><span class="java_plain">&nbsp;clone&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">NQueens</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">Queen</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;clonedQueenList&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">ArrayList</span><span class="java_operator">&lt;</span><span class="java_type">Queen</span><span class="java_operator">&gt;</span><span class="java_separator">(</span><span class="java_plain">queenList</span><span class="java_separator">.</span><span class="java_plain">size</span><span class="java_separator">());</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">for</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">Queen</span><span class="java_plain">&nbsp;queen&nbsp;</span><span class="java_operator">:</span><span class="java_plain">&nbsp;queenList</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;clonedQueenList</span><span class="java_separator">.</span><span class="java_plain">add</span><span class="java_separator">(</span><span class="java_plain">queen</span><span class="java_separator">.</span><span class="java_plain">clone</span><span class="java_separator">());</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;clone</span><span class="java_separator">.</span><span class="java_plain">queenList&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;clonedQueenList</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;clone</span><span class="java_separator">.</span><span class="java_plain">score&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;score</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;clone</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span></pre><p>The <code class="literal">cloneSolution()</code> method should clone no more and no less than the parts of the
      <code class="literal">Solution</code> that can change during planning. For example, in the curriculum course schedule
      example the lectures are cloned, but teachers, courses, timeslots, periods, rooms, ... are not cloned because only
      a lecture's appointed period or room changes during solving:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><!-- <br/> --><span class="java_javadoc_comment">/**</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Clone&nbsp;will&nbsp;only&nbsp;deep&nbsp;copy&nbsp;the&nbsp;{</span><span class="java_javadoc_tag">@link</span><span class="java_javadoc_comment">&nbsp;#lectureList}.</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">CurriculumCourseSchedule</span><span class="java_plain">&nbsp;cloneSolution</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">CurriculumCourseSchedule</span><span class="java_plain">&nbsp;clone&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">CurriculumCourseSchedule</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;clone</span><span class="java_separator">.</span><span class="java_plain">teacherList&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;teacherList</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;clone</span><span class="java_separator">.</span><span class="java_plain">curriculumList&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;curriculumList</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;clone</span><span class="java_separator">.</span><span class="java_plain">courseList&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;courseList</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;clone</span><span class="java_separator">.</span><span class="java_plain">dayList&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;dayList</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;clone</span><span class="java_separator">.</span><span class="java_plain">timeslotList&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;timeslotList</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;clone</span><span class="java_separator">.</span><span class="java_plain">periodList&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;periodList</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;clone</span><span class="java_separator">.</span><span class="java_plain">roomList&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;roomList</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;clone</span><span class="java_separator">.</span><span class="java_plain">unavailablePeriodConstraintList&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;unavailablePeriodConstraintList</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">Lecture</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;clonedLectureList&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">ArrayList</span><span class="java_operator">&lt;</span><span class="java_type">Lecture</span><span class="java_operator">&gt;</span><span class="java_separator">(</span><span class="java_plain">lectureList</span><span class="java_separator">.</span><span class="java_plain">size</span><span class="java_separator">());</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">for</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">Lecture</span><span class="java_plain">&nbsp;lecture&nbsp;</span><span class="java_operator">:</span><span class="java_plain">&nbsp;lectureList</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Lecture</span><span class="java_plain">&nbsp;clonedLecture&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;lecture</span><span class="java_separator">.</span><span class="java_plain">clone</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;clonedLectureList</span><span class="java_separator">.</span><span class="java_plain">add</span><span class="java_separator">(</span><span class="java_plain">clonedLecture</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;clone</span><span class="java_separator">.</span><span class="java_plain">lectureList&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;clonedLectureList</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;clone</span><span class="java_separator">.</span><span class="java_plain">score&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;score</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;clone</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span></pre></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e1405"/>3.6. The starting solution</h2></div></div></div><p>First, you will need to make a starting solution and set that on the solver:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">solver</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">setStartingSolution</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">startingSolution</span><!-- <br/> --><span class="java_separator">);</span></pre><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e1412"/>3.6.1. A simple filler algorithm</h3></div></div></div><p>For 4 queens we use a simple filler algorithm that creates a starting solution with all queens on a
      different x and on the same y (with y = 0).</p><div class="figure"><a id="d0e1417"/><div class="figure-contents"><div class="mediaobject"><img src="images/Chapter-Planner_configuration/unsolvedNQueens04.png" alt="Starting solution for the 4 queens puzzle"/></div></div><p class="title"><b>Figure 3.1. Starting solution for the 4 queens puzzle</b></p></div><br class="figure-break"/><p>Here's how we generate it:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><!-- <br/> --><span class="java_keyword">private</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">NQueens</span><!-- <br/> --><span class="java_plain">&nbsp;createNQueens</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_type">int</span><!-- <br/> --><span class="java_plain">&nbsp;n</span><!-- <br/> --><span class="java_separator">)</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">NQueens</span><span class="java_plain">&nbsp;nQueens&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">NQueens</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nQueens</span><span class="java_separator">.</span><span class="java_plain">setId</span><span class="java_separator">(</span><span class="java_literal">0L</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">Queen</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;queenList&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">ArrayList</span><span class="java_operator">&lt;</span><span class="java_type">Queen</span><span class="java_operator">&gt;</span><span class="java_separator">(</span><span class="java_plain">n</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">for</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">int</span><span class="java_plain">&nbsp;i&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">0</span><span class="java_separator">;</span><span class="java_plain">&nbsp;i&nbsp;</span><span class="java_operator">&lt;</span><span class="java_plain">&nbsp;n</span><span class="java_separator">;</span><span class="java_plain">&nbsp;i</span><span class="java_operator">++</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Queen</span><span class="java_plain">&nbsp;queen&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">Queen</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;queen</span><span class="java_separator">.</span><span class="java_plain">setId</span><span class="java_separator">((</span><span class="java_type">long</span><span class="java_separator">)</span><span class="java_plain">&nbsp;i</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;queen</span><span class="java_separator">.</span><span class="java_plain">setX</span><span class="java_separator">(</span><span class="java_plain">i</span><span class="java_separator">);</span><span class="java_plain">&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;</span><span class="java_type">Different</span><span class="java_plain">&nbsp;column</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;queen</span><span class="java_separator">.</span><span class="java_plain">setY</span><span class="java_separator">(</span><span class="java_literal">0</span><span class="java_separator">);</span><span class="java_plain">&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;</span><span class="java_type">Same</span><span class="java_plain">&nbsp;row</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;queenList</span><span class="java_separator">.</span><span class="java_plain">add</span><span class="java_separator">(</span><span class="java_plain">queen</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nQueens</span><span class="java_separator">.</span><span class="java_plain">setQueenList</span><span class="java_separator">(</span><span class="java_plain">queenList</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;nQueens</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span></pre><p>The starting solution will probably be far from optimal (or even feasible). Here, it's actually the worst
      possible solution. However, we 'll let the solver find a much better solution for us anyway.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e1429"/>3.6.2. StartingSolutionInitializer</h3></div></div></div><p>For large problems, a simple filler algorithm like <code class="literal">createNQueens(int)</code> doesn't suffice. A
      (local search) solver starting from a bad starting solution wastes a lot of time to reach a solution which an
      initializer algorithm can generate in a fraction of that time.</p><p>An initializer algorithm usually works something like this:</p><div class="itemizedlist"><ul><li><p>It sorts the unplanned elements in a queue according to some general rules, for example by exam student
          size.</p></li><li><p>Next, it plans them in the order they come from the queue. Each element is put the best, still available
          spot.</p></li><li><p>It doesn't change an already planned element. It exits when the queue is empty and all elements are
          planned.</p></li></ul></div><p>Such an algorithm is very deterministic: it's really fast, but you can't give it more time to generate an
      even better solution. In some cases the solution it generates will be feasible, but in most cases it won't. You
      'll need a real solver to get to a feasible or more optimal solution. Nevertheless you 'll want to such an
      initializer to give the real solver a serious head start. You can do this by implementing the
      <code class="literal">StartingSolutionInitializer</code> interface:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">interface</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">StartingSolutionInitializer</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">extends</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">SolverAware</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">boolean</span><span class="java_plain">&nbsp;isSolutionInitialized</span><span class="java_separator">(</span><span class="java_type">Solution</span><span class="java_plain">&nbsp;solution</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;initializeSolution</span><span class="java_separator">(</span><span class="java_type">Solution</span><span class="java_plain">&nbsp;solution</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_separator">}</span></pre><p>You'll need to set a (uninitialized) solution on the solver. Once the solver starts, it will first call the
      <code class="literal">StartingSolutionInitializer</code> to initialize the solution. If the
      <code class="literal">StartingSolutionInitializer</code> adds, edits or removes facts it needs to notify the workingMemory
      about this. It can use score calculation during its initialization process.</p><p>Here's an example on how you add the <code class="literal">StartingSolutionInitializer</code> to the
      configuration:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">localSearchSolver</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;...</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">startingSolutionInitializerClass</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.drools.planner.examples.examination.solver.solution.initializer.ExaminationStartingSolutionInitializer</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">startingSolutionInitializerClass</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;...</span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">localSearchSolver</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e1471"/>3.7. Solving a problem</h2></div></div></div><p>Solving a problem is quite easy once you have a solver and the starting solution:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;solver</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">setStartingSolution</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">startingSolution</span><!-- <br/> --><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;solver</span><span class="java_separator">.</span><span class="java_plain">solve</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Solution</span><span class="java_plain">&nbsp;bestSolution&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;solver</span><span class="java_separator">.</span><span class="java_plain">getBestSolution</span><span class="java_separator">();</span></pre><p>The <code class="literal">solve()</code> method will take a long time (depending on the problem size and the solver
    configuration). The solver will remember (actually clone) the best solution it encounters during its solving.
    Depending on a number factors (including problem size, how long you allow the solver to work, which solver type you
    use, ...), that best solution will be a feasible or even an optimal solution.</p><div class="figure"><a id="d0e1483"/><div class="figure-contents"><div class="mediaobject"><img src="images/Chapter-Planner_configuration/solvedNQueens04.png" alt="Best solution for the 4 queens puzzle (also an optimal solution)"/></div></div><p class="title"><b>Figure 3.2. Best solution for the 4 queens puzzle (also an optimal solution)</b></p></div><br class="figure-break"/><p>After a problem is solved, you can reuse the same solver instance to solve another problem (of the same
    problem type).</p></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e1491"/>Chapter 4. Score calculation with a rule engine</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#d0e1494">4.1. Rule based score calculation</a></span></dt><dt><span class="section"><a href="#d0e1509">4.2. Defining the score rules source</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e1514">4.2.1. A scoreDrl resource on the classpath</a></span></dt><dt><span class="section"><a href="#d0e1529">4.2.2. A RuleBase (possibly defined by Guvnor)</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e1548">4.3. Implementing a score rule</a></span></dt><dt><span class="section"><a href="#d0e1582">4.4. Delta based score calculation</a></span></dt><dt><span class="section"><a href="#d0e1610">4.5. The ScoreDefinition interface</a></span></dt><dt><span class="section"><a href="#d0e1695">4.6. Tips and tricks</a></span></dt></dl></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e1494"/>4.1. Rule based score calculation</h2></div></div></div><p>The score calculation (or fitness function) of a planning problem is based on constraints (such as hard
    constraints, soft constraints, rewards, ...). A rule engine, such as Drools, makes it easy to implement those
    constraints as <span class="emphasis"><em>score rules</em></span>.</p><p><span class="bold"><strong>Adding more constraints is <span class="bold"><strong>easy and </strong></span>scalable</strong></span>
    (once you understand the DRL syntax). This allows you to add a bunch of soft constraint score rules on top of the
    hard constraints score rules with little effort and at a reasonable performance cost. For example, for a freight
    routing problem you could add a soft constraint to avoid the certain flagged highways during rush hour.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e1509"/>4.2. Defining the score rules source</h2></div></div></div><p>There are 2 ways to define where your score rules live.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e1514"/>4.2.1. A scoreDrl resource on the classpath</h3></div></div></div><p>This is the simplest way: the score rule live in a DRL file which is a resource on the classpath. Just add
      your score rules <code class="filename">*.drl</code> file in the solver configuration, for example:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">scoreDrl</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">/org/drools/planner/examples/nqueens/solver/nQueensScoreRules.drl</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">scoreDrl</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre><p>You can add multiple <code class="literal">&lt;scoreDrl&gt;</code> entries if needed, but normally you 'll define all
      your score rules in 1 file.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e1529"/>4.2.2. A RuleBase (possibly defined by Guvnor)</h3></div></div></div><p>If you prefer to build the <code class="literal">RuleBase</code> yourself or if you're combining Planner with Guvnor,
      you can set the <code class="literal">RuleBase</code> on the <code class="literal">XmlSolverConfigurer</code> before building the
      <code class="literal">Solver</code>:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;xmlSolverConfigurer.getConfig().setRuleBase(ruleBase);</span><br />
</pre></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e1548"/>4.3. Implementing a score rule</h2></div></div></div><p>The score calculation of a planning problem is based on constraints (such as hard constraints, soft
    constraints, rewards, ...). A rule engine, such as Drools, makes it easy to implement those constraints as
    <span class="emphasis"><em>score rules</em></span>.</p><p>Here's an example of a constraint implemented as a score rule in such a DRL file:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">rule "multipleQueensHorizontal"
    when
        $q1 : Queen($id : id, $y : y);
        $q2 : Queen(id &gt; $id, y == $y);
    then
        insertLogical(new UnweightedConstraintOccurrence("multipleQueensHorizontal", $q1, $q2));
end</pre><p>This score rule will fire once for every 2 queens with the same <code class="literal">y</code>. The <code class="literal">(id &gt;
    $id)</code> condition is needed to assure that for 2 queens A and B, it can only fire for (A, B) and not for (B,
    A), (A, A) or (B, B). Let's take a closer look at this score rule on the starting solution of 4 queens:</p><div class="figure"><a id="d0e1568"/><div class="figure-contents"><div class="mediaobject"><img src="images/Chapter-Score_calculation/unsolvedNQueens04.png" alt="Starting solution for the 4 queens puzzle"/></div></div><p class="title"><b>Figure 4.1. Starting solution for the 4 queens puzzle</b></p></div><br class="figure-break"/><p>In this starting solution the multipleQueensHorizontal score rule will fire for 6 queen couples: (A, B), (A,
    C), (A, D), (B, C), (B, D) and (C, D). Because none of the queens are on the same vertical or diagonal line, this
    starting solution will have a score of <code class="literal">-6</code>. An optimal solution of 4 queens has a score of
    <code class="literal">0</code>.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e1582"/>4.4. Delta based score calculation</h2></div></div></div><p>It's recommended to use Drools in forward-chaining mode (which is the default behaviour), as for score
    implementations this will create the effect of a <span class="emphasis"><em>delta based score calculation</em></span> instead of a
    full score calculation on each solution evaluation. For example, if a single queen A moves from y
    <code class="literal">0</code> to <code class="literal">3</code>, it won't bother to recalculate the "multiple queens on the same
    horizontal line" constraint between 2 queens if neither of those queens is queen A. This is a huge performance gain.
    <span class="bold"><strong>Drools Planner gives you this huge performance gain without forcing you to write a very
    complicated delta based score calculation algorithm.</strong></span> Just let the Drools rule engine do the hard
    work.</p><div class="figure"><a id="d0e1599"/><div class="figure-contents"><div class="mediaobject"><img src="images/Chapter-Score_calculation/deltaBasedScoreCalculationNQueens04.png" alt="Delta based score calculation for the 4 queens puzzle"/></div></div><p class="title"><b>Figure 4.2. Delta based score calculation for the 4 queens puzzle</b></p></div><br class="figure-break"/><p>The speedup due to delta based score calculation is huge, because the speedup is relative to the size of your
    planning problem (your <span class="emphasis"><em>n</em></span>). By using score rules, you get that speedup without writing any delta
    code.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e1610"/>4.5. The ScoreDefinition interface</h2></div></div></div><p>The <code class="literal">ScoreDefinition</code> interface defines the score representation. The score must a
    <code class="literal">Score</code> instance and the instance type (for example <code class="literal">DefaultHardAndSoftScore</code>)
    must be stable throughout the solver runtime.</p><p>The solver aims to find the solution with the highest score. <span class="emphasis"><em>The best solution</em></span> is the
    solution with the highest score that it has encountered during its solving.</p><p>Most planning problems tend to use negative scores (the amount of negative constraints being broken) with an
    impossible perfect score of 0. This explains why the score of a solution of 4 queens is the negative of the number
    of queen couples which can attack each other.</p><p>A <code class="literal">ScoreDefinition</code> instance is configured in the solver configuration:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">scoreDefinition</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">scoreDefinitionType</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">SIMPLE</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">scoreDefinitionType</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">scoreDefinition</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre><p>There are a couple of build-in <code class="literal">ScoreDefinition</code> implementations:</p><div class="itemizedlist"><ul><li><p>SIMPLE: The <code class="literal">SimpleScoreDefinition</code> defines the <code class="literal">Score</code> as a
        <code class="literal">SimpleScore</code> which has a single int value, for example <code class="literal">-123</code>.</p></li><li><p>HARD_AND_SOFT: The <code class="literal">HardAndSoftScoreDefinition</code> defines the <code class="literal">Score</code> as a
        <code class="literal">HardAndSoftScore</code> which has a hard int value and a soft int value, for example
        <code class="literal">-123hard/-456soft</code>.</p></li></ul></div><p>You can implement your own <code class="literal">ScoreDefinition</code>, although the build-in score definitions should
    suffice for most needs.</p><p>A <code class="literal">ScoreCalculator</code> instance is asserted into the working memory as a global called
    <code class="literal">scoreCalculator</code>. Your score rules need to (indirectly) update that instance. Usually you 'll make
    a single rule as an aggregation of the other rules to update the score:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">global SimpleScoreCalculator scoreCalculator;

rule "multipleQueensHorizontal"
    when
        $q1 : Queen($id : id, $y : y);
        $q2 : Queen(id &gt; $id, y == $y);
    then
        insertLogical(new UnweightedConstraintOccurrence("multipleQueensHorizontal", $q1, $q2));
end

// multipleQueensVertical is obsolete because it is always 0

rule "multipleQueensAscendingDiagonal"
    when
        $q1 : Queen($id : id, $ascendingD : ascendingD);
        $q2 : Queen(id &gt; $id, ascendingD == $ascendingD);
    then
        insertLogical(new UnweightedConstraintOccurrence("multipleQueensAscendingDiagonal", $q1, $q2));
end

rule "multipleQueensDescendingDiagonal"
    when
        $q1 : Queen($id : id, $descendingD : descendingD);
        $q2 : Queen(id &gt; $id, descendingD == $descendingD);
    then
        insertLogical(new UnweightedConstraintOccurrence("multipleQueensDescendingDiagonal", $q1, $q2));
end

rule "hardConstraintsBroken"
    when
        $occurrenceCount : Number() from accumulate(
            $unweightedConstraintOccurrence : UnweightedConstraintOccurrence(),
            count($unweightedConstraintOccurrence)
        );
    then
        scoreCalculator.setScore(- $occurrenceCount.intValue());
end</pre><p>Optionally, you can also weigh your constraints differently, by multiplying the count of each score rule with
    its weight. For example in freight routing, you can make 5 broken "avoid crossroads" soft constraints count as much
    as 1 broken "avoid highways at rush hour" soft constraint. This allows your business analysts to easily tweak the
    score function as they see fit.</p><p>Here's an example of all the NQueens constraints written as a single rule, using multi pattern accumulates and
    making multipleQueensHorizontal constraint outweigh the other constraints 5 times:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// Warning: This currently triggers backwards chaining instead of forward chaining and seriously hurts performance and scalability.
rule "constraintsBroken"
    when
        $multipleQueensHorizontal : Long()
        from accumulate(
            $q1 : Queen($id : id, $y : y)
            and Queen(id &gt; $id, y == $y),
           count($q1)
        );
        $multipleQueensAscendingDiagonal : Long()
        from accumulate(
            $q2 : Queen($id : id, $ascendingD : ascendingD)
            and Queen(id &gt; $id, ascendingD == $ascendingD),
           count($q2)
        );
        $multipleQueensDescendingDiagonal : Long()
        from accumulate(
            $q3 : Queen($id : id, $descendingD : descendingD)
            and Queen(id &gt; $id, descendingD == $descendingD),
           count($q3)
        );
    then
        scoreCalculator.setScore(- (5 * $multipleQueensHorizontal) - $multipleQueensAscendingDiagonal - $multipleQueensDescendingDiagonal);
end</pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e1695"/>4.6. Tips and tricks</h2></div></div></div><div class="itemizedlist"><ul><li><p>If you know a certain constraint can never be broken, don't bother writing a score rule for it. For
        example, the n queens example doesn't have a "multipleQueensVertical" rule because a queen's
        <code class="literal">x</code> never changes and the starting solution puts each queen on a different
        <code class="literal">x</code>. This tends to give a huge performance gain, not just because the score function is faster,
        but mainly because most solver implementations will spend less time evaluating unfeasible solutions.</p></li><li><p>Be watchfull for score traps. A score trap is a state in which several moves need to be done to resolve or
        lower the weight of a single constraint occurrence. Some examples of score traps:</p><div class="itemizedlist"><ul><li><p>If you need 2 doctors at each table, but you're only moving 1 doctor at a time, then the solver has no
            insentive to move a doctor to a table with no doctors. Punish a table with no doctors more then a table with
            only 1 doctor in your score function.</p></li><li><p>If you only add the table as a cause of the ConstraintOccurrence and forget the jobType (which is
            doctor or politician), then the solver has no insentive to move a docter to table which is short of a doctor
            and a politician.</p></li></ul></div></li><li><p>If you use tabu search, combine it with a <code class="literal">minimalAcceptedSelection</code> selector. Take some
        time to tweak the value of <code class="literal">minimalAcceptedSelection</code>.</p></li><li><p>Verify that your score calculation happens in the correct <code class="literal">Number</code> type. If you're making
        the sum of integer values, don't let drools use Double's or your performance will hurt. Solver implementations
        will usually spend most of their execution time running the score function.</p></li><li><p>Always remember that premature optimization is the root of all evil. Make sure your design is flexible
        enough to allow configuration based tweaking.</p></li><li><p>Currently, don't allow drools to backward chain instead of forward chain, so avoid query's. It kills
        scalibilty.</p></li><li><p>Currently, don't allow drools to switch to MVEL mode, for performance. You can avoid this by using
        <code class="literal">eval</code> in the score rules, for example: <code class="literal">eval(day.getIndex() == $day1.getIndex() +
        3)</code>.</p></li><li><p>For optimal performance, use at least java 1.6 and always use server mode (<code class="literal">java
        -server</code>). We have seen performance increases of 30% by switching from java 1.5 to 1.6 and 50% by
        turning on server mode.</p></li><li><p>If you're doing performance tests, always remember that the JVM needs to warm up. First load your solver
        and do a short run, before you start benchmarking it.</p></li></ul></div><p>In case you haven't figured it out yet: performance (and scalability) is very important for solving planning
    problems. What good is a real-time freight routing solver that takes a day to find a feasible solution? Even small
    and innocent looking problems can hide an enormous problem size. For example, they probably still don't know the
    optimal solution of the traveling tournament problem for as little as 10 traveling teams.</p></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e1759"/>Chapter 5. Local search solver</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#d0e1762">5.1. Overview</a></span></dt><dt><span class="section"><a href="#d0e1810">5.2. A move</a></span></dt><dt><span class="section"><a href="#d0e1964">5.3. Move generation</a></span></dt><dt><span class="section"><a href="#d0e1996">5.4. A step</a></span></dt><dt><span class="section"><a href="#d0e2066">5.5. Getting stuck in local optima</a></span></dt><dt><span class="section"><a href="#d0e2089">5.6. Deciding the next step</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e2128">5.6.1. Selector</a></span></dt><dt><span class="section"><a href="#d0e2142">5.6.2. Acceptor</a></span></dt><dt><span class="section"><a href="#d0e2247">5.6.3. Forager</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e2306">5.7. Best solution</a></span></dt><dt><span class="section"><a href="#d0e2321">5.8. Termination</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e2339">5.8.1. TimeMillisSpendTermination</a></span></dt><dt><span class="section"><a href="#d0e2357">5.8.2. StepCountTermination</a></span></dt><dt><span class="section"><a href="#d0e2364">5.8.3. ScoreAttainedTermination</a></span></dt><dt><span class="section"><a href="#d0e2375">5.8.4. UnimprovedStepCountTermination</a></span></dt><dt><span class="section"><a href="#d0e2384">5.8.5. Combining Terminations</a></span></dt><dt><span class="section"><a href="#d0e2397">5.8.6. Another thread can ask a Solver to terminate early</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e2421">5.9. Using a custom Selector, Acceptor, Forager or Termination</a></span></dt></dl></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e1762"/>5.1. Overview</h2></div></div></div><p>In number of possible solutions for a planning problem can be mind blowing. For example:</p><div class="itemizedlist"><ul><li><p>4 queens has 256 possible solutions (<code class="literal">n ^ n</code>) and 2 optimal solutions.</p></li><li><p>5 queens has 3125 possible solutions (<code class="literal">n ^ n</code>) and 1 optimal solution.</p></li><li><p>8 queens has 16777216 possible solutions (<code class="literal">n ^ n</code>) and 92 optimal solutions.</p></li><li><p>Most real-life planning problems have an incredible number of possible solutions and only 1 or a few
        optimal solutions.</p></li></ul></div><p>An algorithm that checks every possible solution (even with pruning) can easily run for billions of years on a
    single real-life planning problem. Most of the time, we are happy with a feasible solution found in a limited amount
    of time. Local search tends to find a feasible solution relatively fast. Because it acts very much like a human, it
    is also pretty natural to program.</p><p>Local search solves a problem by making a move on the current solution which changes it into a better
    solution. It does that high number of iterations untill its time runs out and it is satisfied with the solution. It
    starts with the starting solution.</p><p>A local search algorithm and the drools rule engine turn out to be a really nice combination, because:</p><div class="itemizedlist"><ul><li><p>A rule engine such as Drools Expert is <span class="bold"><strong>great for calculating the score</strong></span> of
        a solution of a planning problem. It make it easy to add additional soft or hard constraints such as "a teacher
        shouldn't teach more then 7 hours a day". However it tends to be too complex to use to actually find new
        solutions.</p></li><li><p>A local search algorithm is <span class="bold"><strong>great at finding new improving solutions</strong></span> for
        a planning problem, without brute-forcing every possibility. However it needs to know the score of a solution
        and normally offers no support in calculating that score.</p></li></ul></div><p>Drools Planner's local search implementation combines both. On top of that, it also offers additional support
    for benchmarking, etc.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e1810"/>5.2. A move</h2></div></div></div><p>A move is the change from a solution A to a solution B. For example, below you can see a single move on the
    starting solution of 4 queens that moves a single queen to another row:</p><div class="figure"><a id="d0e1815"/><div class="figure-contents"><div class="mediaobject"><img src="images/Chapter-Local_search/singleMoveNQueens04.png" alt="A single move (4 queens example)"/></div></div><p class="title"><b>Figure 5.1. A single move (4 queens example)</b></p></div><br class="figure-break"/><p>A move can have a small or large impact. In the above example, the move of queen <span class="emphasis"><em>C0 to C2</em></span>
    is a small move. Some moves are the same move type. These are some possibilities for move types in n queens:</p><div class="itemizedlist"><ul><li><p>Move a single queen to another row. This is a small move. For example, move queen <span class="emphasis"><em>C0 to
        C2</em></span>.</p></li><li><p>Move all queens a number of rows down or up. This a big move.</p></li><li><p>Move a single queen to another column. This is a small move. For example, move queen <span class="emphasis"><em>C2 to
        A0</em></span> (placing it on top of queen A0).</p></li><li><p>Add a queen to the board at a certain row and column.</p></li><li><p>Remove a queen from the board.</p></li></ul></div><p>Because we have decided that all queens will be on the board at all times and each queen has an appointed
    column (for performance reasons), only the first 2 move types are usable in our example. Furthermore, we 're only
    using the first move type in the example because we think it gives the best performance, but you are welcome to
    prove us wrong.</p><p>Each of your move types will be an implementation of the <code class="literal">Move</code> interface:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">interface</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Move</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">boolean</span><span class="java_plain">&nbsp;isMoveDoable</span><span class="java_separator">(</span><span class="java_type">EvaluationHandler</span><span class="java_plain">&nbsp;evaluationHandler</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Move</span><span class="java_plain">&nbsp;createUndoMove</span><span class="java_separator">(</span><span class="java_type">EvaluationHandler</span><span class="java_plain">&nbsp;evaluationHandler</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;doMove</span><span class="java_separator">(</span><span class="java_type">EvaluationHandler</span><span class="java_plain">&nbsp;evaluationHandler</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_separator">}</span></pre><p>Let's take a look at the <code class="literal">Move</code> implementation for 4 queens which moves a queen to a
    different row:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">class</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">YChangeMove</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">implements</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Move</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Queen</span><span class="java_plain">&nbsp;queen</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;toY</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">YChangeMove</span><span class="java_separator">(</span><span class="java_type">Queen</span><span class="java_plain">&nbsp;queen</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;toY</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">queen&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;queen</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">toY&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;toY</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;</span><span class="java_separator">...</span><span class="java_plain">&nbsp;see&nbsp;below</span>
</span>
<!--  --><br/><span class="java_separator">}</span></pre><p>An instance of <code class="literal">YChangeMove</code> moves a queen from its current y to a different y.</p><p>Drools Planner calls the <code class="literal">doMove(WorkingMemory)</code> method to do a move. The
    <code class="literal">Move</code> implementation must notify the working memory of any changes it does on the solution
    facts:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">void</span><!-- <br/> --><span class="java_plain">&nbsp;doMove</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_type">WorkingMemory</span><!-- <br/> --><span class="java_plain">&nbsp;workingMemory</span><!-- <br/> --><span class="java_separator">)</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">FactHandle</span><span class="java_plain">&nbsp;queenHandle&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;workingMemory</span><span class="java_separator">.</span><span class="java_plain">getFactHandle</span><span class="java_separator">(</span><span class="java_plain">queen</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;queen</span><span class="java_separator">.</span><span class="java_plain">setY</span><span class="java_separator">(</span><span class="java_plain">toY</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;workingMemory</span><span class="java_separator">.</span><span class="java_plain">update</span><span class="java_separator">(</span><span class="java_plain">queenHandle</span><span class="java_separator">,</span><span class="java_plain">&nbsp;queen</span><span class="java_separator">);</span><span class="java_plain">&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;after&nbsp;changes&nbsp;are&nbsp;made</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span></pre><p>You need to call the <code class="literal">workingMemory.update(FactHandle, Object)</code> method after modifying the
    fact. Note that you can alter multiple facts in a single move and effectively create a big move (also known as a
    coarse-grained move).</p><p>Drools Planner automatically filters out <span class="emphasis"><em>non doable moves</em></span> by calling the
    <code class="literal">isDoable(WorkingMemory)</code> method on a move. A <span class="emphasis"><em>non doable move</em></span> is:</p><div class="itemizedlist"><ul><li><p>A move that changes nothing on the current solution. For example, moving queen B0 to row 0 is not
        doable.</p></li><li><p>A move that is impossible to do on the current solution. For example, moving queen B0 to row 10 is not
        doable because it would move it outside the board limits.</p></li></ul></div><p>In the n queens example, a move which moves the queen from its current row to the same row isn't
    doable:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">boolean</span><!-- <br/> --><span class="java_plain">&nbsp;isMoveDoable</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_type">WorkingMemory</span><!-- <br/> --><span class="java_plain">&nbsp;workingMemory</span><!-- <br/> --><span class="java_separator">)</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;fromY&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;queen</span><span class="java_separator">.</span><span class="java_plain">getY</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;fromY&nbsp;</span><span class="java_operator">!=</span><span class="java_plain">&nbsp;toY</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span></pre><p>Because we won't generate a move which can move a queen outside the board limits, we don't need to check it. A
    move that is currently not doable can become doable on a later solution.</p><p>Each move has an <span class="emphasis"><em>undo move</em></span>: a move (usually of the same type) which does the exact
    opposite. In the above example the undo move of <span class="emphasis"><em>C0 to C2</em></span> would be the move <span class="emphasis"><em>C2 to
    C0</em></span>. An undo move can be created from a move, but only before the move has been done on the current
    solution.</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Move</span><!-- <br/> --><span class="java_plain">&nbsp;createUndoMove</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_type">WorkingMemory</span><!-- <br/> --><span class="java_plain">&nbsp;workingMemory</span><!-- <br/> --><span class="java_separator">)</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">YChangeMove</span><span class="java_separator">(</span><span class="java_plain">queen</span><span class="java_separator">,</span><span class="java_plain">&nbsp;queen</span><span class="java_separator">.</span><span class="java_plain">getY</span><span class="java_separator">());</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span></pre><p>Notice that if C0 would have already been moved to C2, the undo move would create the move <span class="emphasis"><em>C2 to
    C2</em></span>, instead of the move <span class="emphasis"><em>C2 to C0</em></span>.</p><p>The local search solver can do and undo a move more than once, even on different (successive)
    solutions.</p><p>A move must implement the <code class="literal">equals()</code> and <code class="literal">hashcode()</code> methods. 2 moves which
    make the same change on a solution, must be equal.</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">boolean</span><!-- <br/> --><span class="java_plain">&nbsp;equals</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_type">Object</span><!-- <br/> --><span class="java_plain">&nbsp;o</span><!-- <br/> --><span class="java_separator">)</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">if</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_keyword">this</span><span class="java_plain">&nbsp;</span><span class="java_operator">==</span><span class="java_plain">&nbsp;o</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;</span><span class="java_literal">true</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span><span class="java_plain">&nbsp;</span><span class="java_keyword">else</span><span class="java_plain">&nbsp;</span><span class="java_keyword">if</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">o&nbsp;</span><span class="java_keyword">instanceof</span><span class="java_plain">&nbsp;</span><span class="java_type">YChangeMove</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">YChangeMove</span><span class="java_plain">&nbsp;other&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">YChangeMove</span><span class="java_separator">)</span><span class="java_plain">&nbsp;o</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">EqualsBuilder</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">append</span><span class="java_separator">(</span><span class="java_plain">queen</span><span class="java_separator">,</span><span class="java_plain">&nbsp;other</span><span class="java_separator">.</span><span class="java_plain">queen</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">append</span><span class="java_separator">(</span><span class="java_plain">toY</span><span class="java_separator">,</span><span class="java_plain">&nbsp;other</span><span class="java_separator">.</span><span class="java_plain">toY</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">isEquals</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span><span class="java_plain">&nbsp;</span><span class="java_keyword">else</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;</span><span class="java_literal">false</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;hashCode</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">HashCodeBuilder</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">append</span><span class="java_separator">(</span><span class="java_plain">queen</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">append</span><span class="java_separator">(</span><span class="java_plain">toY</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">toHashCode</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span></pre><p>In the above example, the <code class="literal">Queen</code> class uses the default <code class="literal">Object</code>
    <code class="literal">equal()</code> and <code class="literal">hashcode()</code> implementations. Notice that it checks if the other
    move is an instance of the same move type. This is important because a move will be compared to a move with another
    move type if you're using more then 1 move type.</p><p>It's also recommended to implement the <code class="literal">toString()</code> method as it allows you to read Drools
    Planner's logging more easily:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">String</span><!-- <br/> --><span class="java_plain">&nbsp;toString</span><!-- <br/> --><span class="java_separator">()</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;queen&nbsp;</span><span class="java_operator">+</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;&nbsp;=&gt;&nbsp;&quot;</span><span class="java_plain">&nbsp;</span><span class="java_operator">+</span><span class="java_plain">&nbsp;toY</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span></pre><p>Now that we can make a single move, let's take a look at generating moves.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e1964"/>5.3. Move generation</h2></div></div></div><p>At each solution, local search will try all possible moves and pick the best move to change to the next
    solution. It's up to you to generate those moves. Let's take a look at all the possible moves on the starting
    solution of 4 queens:</p><div class="figure"><a id="d0e1969"/><div class="figure-contents"><div class="mediaobject"><img src="images/Chapter-Local_search/possibleMovesNQueens04.png" alt="Possible moves at step 0 (4 queens example)"/></div></div><p class="title"><b>Figure 5.2. Possible moves at step 0 (4 queens example)</b></p></div><br class="figure-break"/><p>As you can see, not all the moves are doable. At the starting solution we have 12 doable moves (<code class="literal">n *
    (n - 1)</code>), one of which will be move which changes the starting solution into the next solution. Notice
    that the number of possible solutions is 256 (<code class="literal">n ^ n</code>), much more that the amount of doable moves.
    Don't create a move to every possible solution. Instead use moves which can be sequentially combined to reach every
    possible solution.</p><p>It's highly recommended that you verify all solutions are connected by your move set. This means that by
    combining a finite number of moves you can reach any solution from any solution. Otherwise you're already excluding
    solutions at the start. Especially if you're using only big moves, you should check it. Just because big moves
    outperform small moves in a short test run, it doesn't mean that they will outperform them in a long test
    run.</p><p>You can mix different move types. Usually you're better off preferring small (fine-grained) moves over big
    (course-grained) moves because the score delta calculation will pay off more. However, as the traveling tournament
    example proves, if you can remove a hard constraint by using a certain set of big moves, you can win performance and
    scalability. Try it yourself: run both the simple (small moves) and the smart (big moves) version of the traveling
    tournament example. The smart version evaluates a lot less unfeasible solutions, which enables it to outperform and
    outscale the simple version.</p><p>Move generation currently happens with a <code class="literal">MoveFactory</code>:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">class</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">NQueensMoveFactory</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">extends</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">CachedMoveListMoveFactory</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">Move</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;createMoveList</span><span class="java_separator">(</span><span class="java_type">Solution</span><span class="java_plain">&nbsp;solution</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">NQueens</span><span class="java_plain">&nbsp;nQueens&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">NQueens</span><span class="java_separator">)</span><span class="java_plain">&nbsp;solution</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">Move</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;moveList&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">ArrayList</span><span class="java_operator">&lt;</span><span class="java_type">Move</span><span class="java_operator">&gt;</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">for</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">Queen</span><span class="java_plain">&nbsp;queen&nbsp;</span><span class="java_operator">:</span><span class="java_plain">&nbsp;nQueens</span><span class="java_separator">.</span><span class="java_plain">getQueenList</span><span class="java_separator">())</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">for</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">int</span><span class="java_plain">&nbsp;n&nbsp;</span><span class="java_operator">:</span><span class="java_plain">&nbsp;nQueens</span><span class="java_separator">.</span><span class="java_plain">createNList</span><span class="java_separator">())</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;moveList</span><span class="java_separator">.</span><span class="java_plain">add</span><span class="java_separator">(</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">YChangeMove</span><span class="java_separator">(</span><span class="java_plain">queen</span><span class="java_separator">,</span><span class="java_plain">&nbsp;n</span><span class="java_separator">));</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;moveList</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_separator">}</span></pre><p>But we might be making move generation part of the DRL's in the future.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e1996"/>5.4. A step</h2></div></div></div><p>A step is the winning move. The local search solver tries every move on the current solution and picks the
    best accepted move as the step:</p><div class="figure"><a id="d0e2001"/><div class="figure-contents"><div class="mediaobject"><img src="images/Chapter-Local_search/decideNextStepNQueens04.png" alt="Decide the next step at step 0 (4 queens example)"/></div></div><p class="title"><b>Figure 5.3. Decide the next step at step 0 (4 queens example)</b></p></div><br class="figure-break"/><p>Because the move <span class="emphasis"><em>B0 to B3</em></span> has the highest score (<code class="literal">-3</code>), it is picked as
    the next step. Notice that <span class="emphasis"><em>C0 to C3</em></span> (not shown) could also have been picked because it also has
    the score <code class="literal">-3</code>. If multiple moves have the same highest score, one is picked randomly, in this case
    <span class="emphasis"><em>B0 to B3</em></span>.</p><p>The step is made and from that new solution, the local search solver tries all the possible moves again, to
    decide the next step after that. It continually does this in a loop, and we get something like this:</p><div class="figure"><a id="d0e2026"/><div class="figure-contents"><div class="mediaobject"><img src="images/Chapter-Local_search/allStepsNQueens04.png" alt="All steps (4 queens example)"/></div></div><p class="title"><b>Figure 5.4. All steps (4 queens example)</b></p></div><br class="figure-break"/><p>Notice that the local search solver doesn't use a search tree, but a search path. The search path is
    highlighted by the green arrows. At each step it tries all possible moves, but unless it's the step, it doesn't
    investigate that solution further. This is one of the reasons why local search is very scalable.</p><p>As you can see, the local search solver solves the 4 queens problem by starting with the starting solution and
    make the following steps sequentially:</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p><span class="emphasis"><em>B0 to B3</em></span></p></li><li><p><span class="emphasis"><em>D0 to B2</em></span></p></li><li><p><span class="emphasis"><em>A0 to B1</em></span></p></li></ol></div><p>If we turn on INFO logging, this is reflected into the logging:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">INFO  Solving with random seed (0).
INFO  Starting with time spend (0), score (-6), new best score (-6).
INFO  Step index (0), time spend (4), score (-3), new best score (-3), accepted move size (12) for picked step ([Queen-1] 1 @ 0 =&gt; 3).
INFO  Step index (1), time spend (7), score (-1), new best score (-1), accepted move size (12) for picked step ([Queen-0] 0 @ 0 =&gt; 1).
INFO  Step index (2), time spend (10), score (0), new best score (0), accepted move size (12) for picked step ([Queen-3] 3 @ 0 =&gt; 2).
INFO  Solved at step index (2) with time spend (10) for best score (0) with average calculate count per second (7300).</pre><p>Notice that the logging uses the <code class="literal">toString()</code> method of our <code class="literal">Move</code>
    implementation: <code class="literal">[Queen-1] 1 @ 0 =&gt; 3</code>.</p><p>The local search solver solves the 4 queens problem in 3 steps, by evaluating only 37 possible solutions (3
    steps with 12 moves each + 1 starting solution), which is only fraction of all 256 possible solutions. It solves 16
    queens in 31 steps, by evaluating only 7441 out of 18446744073709551616 possible solutions.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e2066"/>5.5. Getting stuck in local optima</h2></div></div></div><p>A <span class="emphasis"><em>simple local search</em></span> always takes improving moves. This may seem like a good thing, but
    it's not. It suffers from a number of problems:</p><div class="itemizedlist"><ul><li><p>It can get stuck in a local optimum. For example if it reaches a solution X with a score -1 and there is
        no improving move, it is forced to take a next step that leads to a solution Y with score -2, after that
        however, it's very real that it will pick the step back to solution X with score -1. It will then start looping
        between solution X and Y.</p></li><li><p>It can start walking in its own footsteps, picking the same next step at every step.</p></li></ul></div><p>Of course Drools Planner implements better local searches, such as <span class="emphasis"><em>tabu search</em></span> and
    <span class="emphasis"><em>simulated annealing</em></span> which can avoid these problems. We recommend to never use a simple local
    search, unless you're absolutely sure there are no local optima in your planning problem.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e2089"/>5.6. Deciding the next step</h2></div></div></div><p>The local search solver decides the next step with the aid of 3 configurable components:</p><div class="itemizedlist"><ul><li><p>A <span class="emphasis"><em>selector</em></span> which selects (or generates) the possible moves of the current
        solution.</p></li><li><p>An <span class="emphasis"><em>acceptor</em></span> which filters out unacceptable moves. It can also weigh a move it
        accepts.</p></li><li><p>A <span class="emphasis"><em>forager</em></span> which gathers all accepted moves and picks the next step from them.</p></li></ul></div><div class="figure"><a id="d0e2113"/><div class="figure-contents"><div class="mediaobject"><img src="images/Chapter-Local_search/decideNextStepNQueens04.png" alt="Decide the next step at step 0 (4 queens example)"/></div></div><p class="title"><b>Figure 5.5. Decide the next step at step 0 (4 queens example)</b></p></div><br class="figure-break"/><p>In the above example the selector generated the moves shown with the blue lines, the acceptor accepted all of
    them and the forager picked the move <span class="emphasis"><em>B0 to B3</em></span>.</p><p>If we turn on DEBUG logging, we can see the decision making in the log:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
INFO  Solving with random seed (0).
INFO  Starting with time spend (0), score (-6), new best score (-6).
DEBUG     Ignoring not doable move ([Queen-0] 0 @ 0 =&gt; 0).
DEBUG     Move score (-4), accept chance (1.0) for move ([Queen-0] 0 @ 0 =&gt; 1).
DEBUG     Move score (-4), accept chance (1.0) for move ([Queen-0] 0 @ 0 =&gt; 2).
DEBUG     Move score (-4), accept chance (1.0) for move ([Queen-0] 0 @ 0 =&gt; 3).
...
DEBUG     Move score (-3), accept chance (1.0) for move ([Queen-1] 1 @ 0 =&gt; 3).
...
DEBUG     Move score (-3), accept chance (1.0) for move ([Queen-2] 2 @ 0 =&gt; 3).
...
DEBUG     Move score (-4), accept chance (1.0) for move ([Queen-3] 3 @ 0 =&gt; 3).
INFO  Step index (0), time spend (6), score (-3), new best score (-3), accepted move size (12) for picked step ([Queen-1] 1 @ 0 =&gt; 3).
...</pre><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e2128"/>5.6.1. Selector</h3></div></div></div><p>A selector is currently based on a <code class="literal">MoveFactory</code>.</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">selector</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">moveFactoryClass</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.drools.planner.examples.nqueens.solver.NQueensMoveFactory</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">moveFactoryClass</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">selector</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre><p>You're not obligated to generate the same set of moves at each step. It's generally a good idea to use
      several selectors, mixing fine grained moves and course grained moves:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">selector</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">selector</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">moveFactoryClass</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.drools.planner.examples.nurserostering.solver.move.factory.EmployeeChangeMoveFactory</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">moveFactoryClass</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">selector</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">selector</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">moveFactoryClass</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.drools.planner.examples.nurserostering.solver.move.factory.AssignmentSwitchMoveFactory</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">moveFactoryClass</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">selector</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">selector</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">moveFactoryClass</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.drools.planner.examples.nurserostering.solver.move.factory.AssignmentPillarPartSwitchMoveFactory</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">moveFactoryClass</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">selector</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">selector</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e2142"/>5.6.2. Acceptor</h3></div></div></div><p>An acceptor is used (together with a forager) to active tabu search, simulated annealing, great deluge, ...
      For each move it generates an accept chance. If a move is rejected it is given an accept chance of
      <code class="literal">0.0</code>.</p><p>You can implement your own <code class="literal">Acceptor</code>, although the build-in acceptors should suffice for
      most needs. You can also combine multiple acceptors.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e2155"/>5.6.2.1. Tabu search acceptor</h4></div></div></div><p>When tabu search takes steps it creates tabu's. It does not accept a move as the next step if that move
        breaks tabu. Drools Planner implements several tabu types:</p><div class="itemizedlist"><ul><li><p><span class="emphasis"><em>Solution tabu</em></span> makes recently visited solutions tabu. It does not accept a move
            that leads to one of those solutions. If you can spare the memory, don't be cheap on the tabu size. We
            recommend this type of tabu because it tends to give the best results and requires little or no
            tweaking.</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">acceptor</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">completeSolutionTabuSize</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">1000</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">completeSolutionTabuSize</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">acceptor</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre></li><li><p><span class="emphasis"><em>Move tabu</em></span> makes recent steps tabu. It does not accept a move equal to one of
            those steps.</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">acceptor</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">completeMoveTabuSize</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">7</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">completeMoveTabuSize</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">acceptor</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre></li><li><p><span class="emphasis"><em>Undo move tabu </em></span>makes the undo move of recent steps tabu.</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">acceptor</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">completeUndoMoveTabuSize</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">7</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">completeUndoMoveTabuSize</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">acceptor</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre></li><li><p><span class="emphasis"><em>Property tabu</em></span> makes a property of recent steps tabu. For example, it can make the
            queen tabu, so that a recently moved queen can't be moved.</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">acceptor</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">completePropertyTabuSize</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">5</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">completePropertyTabuSize</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">acceptor</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre><p>To use property tabu, your moves must implement the <code class="literal">TabuPropertyEnabled</code> interface,
            for example:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">class</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">YChangeMove</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">implements</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Move</span><!-- <br/> --><span class="java_separator">,</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">TabuPropertyEnabled</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Queen</span><span class="java_plain">&nbsp;queen</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;toY</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;</span><span class="java_separator">...</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">List</span><span class="java_operator">&lt;?</span><span class="java_plain">&nbsp;</span><span class="java_keyword">extends</span><span class="java_plain">&nbsp;</span><span class="java_type">Object</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;getTabuPropertyList</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;</span><span class="java_type">Collections</span><span class="java_separator">.</span><span class="java_plain">singletonList</span><span class="java_separator">(</span><span class="java_plain">queen</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_separator">}</span></pre><p>You can also make multiple properties tabu (with OR or AND semantics):</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">List</span><!-- <br/> --><span class="java_operator">&lt;?</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">extends</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Object</span><!-- <br/> --><span class="java_operator">&gt;</span><!-- <br/> --><span class="java_plain">&nbsp;getTabuPropertyList</span><!-- <br/> --><span class="java_separator">()</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;tabu&nbsp;with&nbsp;other&nbsp;moves&nbsp;that&nbsp;contain&nbsp;the&nbsp;same&nbsp;leftExam&nbsp;OR&nbsp;the&nbsp;same&nbsp;rightExam</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;</span><span class="java_type">Arrays</span><span class="java_separator">.</span><span class="java_plain">asList</span><span class="java_separator">(</span><span class="java_plain">leftExam</span><span class="java_separator">,</span><span class="java_plain">&nbsp;rightExam</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span></pre><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">List</span><!-- <br/> --><span class="java_operator">&lt;?</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">extends</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Object</span><!-- <br/> --><span class="java_operator">&gt;</span><!-- <br/> --><span class="java_plain">&nbsp;getTabuPropertyList</span><!-- <br/> --><span class="java_separator">()</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;tabu&nbsp;with&nbsp;other&nbsp;moves&nbsp;that&nbsp;contain&nbsp;the&nbsp;same&nbsp;exam&nbsp;AND&nbsp;the&nbsp;same&nbsp;toPeriod&nbsp;</span><span class="java_separator">(</span><span class="java_plain">but&nbsp;not&nbsp;necessary&nbsp;the&nbsp;same&nbsp;toRoom</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;</span><span class="java_type">Collections</span><span class="java_separator">.</span><span class="java_plain">singletonList</span><span class="java_separator">(</span><span class="java_type">Arrays</span><span class="java_separator">.</span><span class="java_plain">asList</span><span class="java_separator">(</span><span class="java_plain">exam</span><span class="java_separator">,</span><span class="java_plain">&nbsp;toPeriod</span><span class="java_separator">));</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span></pre></li></ul></div><p>You can even combine tabu types:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">acceptor</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">completeSolutionTabuSize</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">1000</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">completeSolutionTabuSize</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">completeMoveTabuSize</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">7</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">completeMoveTabuSize</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">acceptor</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre><p>If you pick a too small tabu size, your solver can still get stuck in a local optimum. On the other hand,
        with the exception of solution tabu, if you pick a too large tabu size, your solver can get stuck by bouncing of
        the walls. Use the benchmarker to fine tweak your configuration. Experiments teach us that it is generally best
        to use a prime number for the move tabu, undo move tabu or property tabu size.</p><p>A tabu search acceptor should be combined with a high or no subset selection.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e2210"/>5.6.2.2. Simulated annealing acceptor</h4></div></div></div><p>Simulated annealing does not always pick the move with the highest score, neither does it evaluate many
        moves per step. At least at first. Instead, it gives unimproving moves also a chance to be picked, depending on
        its score and the time gradient of the <code class="literal">Termination</code>. In the end, it gradually turns into a
        simple local search, only accepting improving moves.</p><p>In many use cases, simulated annealing surpasses tabu search. By changing a few lines of configuration,
        you can easily switch from tabu search to simulated annealing and back.</p><p>Start with a <code class="literal">simulatedAnnealingStartingTemperature</code> set to the maximum score delta a
        single move can cause. Use the <code class="literal">Benchmarker</code> to tweak the value.</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">acceptor</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">simulatedAnnealingStartingTemperature</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">2hard/100soft</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">simulatedAnnealingStartingTemperature</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">acceptor</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">forager</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">minimalAcceptedSelection</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">4</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">minimalAcceptedSelection</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">forager</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre><p>A simulated annealing acceptor should be combined with a low subset selection. The classic algorithm uses
        a <code class="literal">minimalAcceptedSelection</code> of <code class="literal">1</code>, but usually <code class="literal">4</code> performs
        better.</p><p>You can even combine it with a tabu acceptor at the same time. Use a lower tabu size than in a pure tabu
        search configuration.</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">acceptor</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">simulatedAnnealingStartingTemperature</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">10.0</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">simulatedAnnealingStartingTemperature</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">completePropertyTabuSize</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">5</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">completePropertyTabuSize</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">acceptor</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">forager</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">minimalAcceptedSelection</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">4</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">minimalAcceptedSelection</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">forager</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre><p>This differs from phasing, another powerful technique, where first simulated annealing is used, followed
        by tabu search.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e2247"/>5.6.3. Forager</h3></div></div></div><p>A forager gathers all accepted moves and picks the move which is the next step. Normally it picks the
      accepted move with the highest score. If several accepted moves have the highest score, one is picked randomly,
      weighted on their accept chance.</p><p>You can implement your own <code class="literal">Forager</code>, although the build-in forager should suffice for most
      needs.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e2257"/>5.6.3.1. Subset selection</h4></div></div></div><p>When there are many possible moves, it becomes inefficient to evaluate all of them at every step. To
        evaluate only a random subset of all the moves, use:</p><div class="itemizedlist"><ul><li><p>An <code class="literal">minimalAcceptedSelection</code> integer, which specifies how many accepted moves should
            have be evaluated during each step. By default it is positive infinity, so all accepted moves are evaluated
            at every step.</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">forager</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">minimalAcceptedSelection</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">1000</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">minimalAcceptedSelection</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">forager</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre></li></ul></div><p>Unlike the n queens problem, real world problems require the use of subset selection. Start from an
        <code class="literal">minimalAcceptedSelection</code> that takes a step in less then 2 seconds. Turn on INFO logging to
        see the step times. Use the <code class="literal">Benchmarker</code> to tweak the value.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e2279"/>5.6.3.2. Pick early type</h4></div></div></div><p>A forager can pick a move early during a step, ignoring subsequent selected moves. There are 3 pick early
        types:</p><div class="itemizedlist"><ul><li><p><code class="literal">NEVER</code>: A move is never picked early: all accepted moves are evaluated that the
            selection allows. This is the default.</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">forager</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">pickEarlyType</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">NEVER</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">pickEarlyType</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">forager</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre></li><li><p><code class="literal">FIRST_BEST_SCORE_IMPROVING</code>: Pick the first accepted move that improves the best
            score. If none improve the best score, it behaves exactly like the pickEarlyType NEVER.</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">forager</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">pickEarlyType</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">FIRST_BEST_SCORE_IMPROVING</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">pickEarlyType</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">forager</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre></li><li><p><code class="literal">FIRST_LAST_STEP_SCORE_IMPROVING</code>: Pick the first accepted move that improves the
            last step score. If none improve the last step score, it behaves exactly like the pickEarlyType
            NEVER.</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">forager</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">pickEarlyType</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">FIRST_LAST_STEP_SCORE_IMPROVING</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">pickEarlyType</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">forager</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre></li></ul></div></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e2306"/>5.7. Best solution</h2></div></div></div><p>Because the current solution can degrade (especially in tabu search and simulated annealing), the local search
    solver remembers the best solution it has encountered through the entire search path. Each time the current solution
    is better than the last best solution, the current solution is cloned and referenced as the new best
    solution.</p><p>You can listen to solver events, including when the best solution changes during solving, by adding a
    <code class="literal">SolverEventListener</code> to the <code class="literal">Solver</code>:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">interface</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Solver</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;</span><span class="java_separator">...</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;addEventListener</span><span class="java_separator">(</span><span class="java_type">SolverEventListener</span><span class="java_plain">&nbsp;eventListener</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;removeEventListener</span><span class="java_separator">(</span><span class="java_type">SolverEventListener</span><span class="java_plain">&nbsp;eventListener</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_separator">}</span></pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e2321"/>5.8. Termination</h2></div></div></div><p>Sooner or later the local search solver will have to stop solving. This can be because of a number of reasons:
    the time is up, the perfect score has been reached, ... The only thing you can't depend on is on finding the optimal
    solution (unless you know the optimal score), because a local search algorithm doesn't know it when it finds the
    optimal solution. For real-life problems this doesn't turn out to be much of a problem, because finding the optimal
    solution would take billions of years, so you 'll want to terminate sooner anyway.</p><p>You can configure when a local search solver needs to stop by configuring a <code class="literal">Termination</code>. A
    <code class="literal">Termination</code> can calculate a time gradient, which is a ratio between the time already spend
    solving and the expected entire solving time.</p><p>You can implement your own <code class="literal">Termination</code>, although the build-in Terminations should suffice
    for most needs.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e2339"/>5.8.1. TimeMillisSpendTermination</h3></div></div></div><p>Terminates when an amount of time has been reached:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">termination</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">maximumMinutesSpend</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">2</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">maximumMinutesSpend</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">termination</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre><p>or</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">termination</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">maximumHoursSpend</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">1</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">maximumHoursSpend</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">termination</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre><p>Note that the time taken by a <code class="literal">StartingSolutionInitializer</code> also is taken into account by
      this Termination. So if you give the solver 2 minutes to solve something, but the initializer takes 1 minute, the
      local search solver will only have a minute left.</p><p>Note that if you use this Termination, you will most likely sacrifice reproducibility. The best solution
      will depend on available CPU time, not only because it influences the amount of steps taken, but also because time
      gradient based algorithms (such as simulated annealing) will probably act differently on each run.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e2357"/>5.8.2. StepCountTermination</h3></div></div></div><p>Terminates when an amount of steps has been reached:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">termination</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">maximumStepCount</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">100</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">maximumStepCount</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">termination</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e2364"/>5.8.3. ScoreAttainedTermination</h3></div></div></div><p>Terminates when a certain score has been reached. You can use this Termination if you know the perfect
      score, for example for 4 queens:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">termination</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">scoreAttained</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">0</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">scoreAttained</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">termination</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre><p>You can also use this Termination to terminate once it reaches a feasible solution. For a solver problem
      with hard and soft constraints, it could look like this:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">termination</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">scoreAttained</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">0hard/-5000soft</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">scoreAttained</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">termination</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e2375"/>5.8.4. UnimprovedStepCountTermination</h3></div></div></div><p>Terminates when the best score hasn't improved in a number of steps:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">termination</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">maximumUnimprovedStepCount</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">100</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">maximumUnimprovedStepCount</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">termination</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre><p>If it hasn't improved recently, it's probably not going to improve soon anyway and it's not worth the effort
      to continue. We have observed that once a new best solution is found (even after a long time of no improvement on
      the best solution), the next few step tend to improve the best solution too.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e2384"/>5.8.5. Combining Terminations</h3></div></div></div><p>Terminations can be combined, for example: terminate after 100 steps or if a score of 0 has been
      reached:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">termination</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">terminationCompositionStyle</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">OR</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">terminationCompositionStyle</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">maximumStepCount</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">100</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">maximumStepCount</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">scoreAttained</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">0</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">scoreAttained</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">termination</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre><p>Alternatively you can use AND, for example: terminate after reaching a feasible score of at least -100 and
      no improvements in 5 steps:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">termination</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">terminationCompositionStyle</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">AND</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">terminationCompositionStyle</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">maximumUnimprovedStepCount</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">5</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">maximumUnimprovedStepCount</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">scoreAttained</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">-100</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">scoreAttained</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">termination</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre><p>This ensures it doesn't just terminate after finding a feasible solution, but also makes any obvious
      improvements on that solution before terminating.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e2397"/>5.8.6. Another thread can ask a Solver to terminate early</h3></div></div></div><p>Sometimes you 'll want to terminate a Solver early from another thread, for example because a user action or
      a server restart. That cannot be configured by a <code class="literal">Termination</code> as it's impossible to predict when
      and if it will occur. Therefor the <code class="literal">Solver</code> interface has these 2 thread-safe methods:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">interface</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Solver</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;</span><span class="java_separator">...</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">boolean</span><span class="java_plain">&nbsp;terminateEarly</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">boolean</span><span class="java_plain">&nbsp;isTerminatedEarly</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_separator">}</span></pre><p>If you call the <code class="literal">terminateEarly()</code> method from another thread, the
      <code class="literal">Solver</code> will terminate at its earliest convenience and the <code class="literal">solve()</code> method
      will return in the original solver thread.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e2421"/>5.9. Using a custom Selector, Acceptor, Forager or Termination</h2></div></div></div><p>It is easy to plug in a custom <code class="literal">Selector</code>, <code class="literal">Acceptor</code>,
    <code class="literal">Forager</code> or <code class="literal">Termination</code> by extending the abstract class and also the config
    class.</p><p>For example, to use a custom <code class="literal">Selector</code>, extend the <code class="literal">AbstractSelector</code> class
    (see <code class="literal">AllMovesOfOneExamSelector</code>), extend the <code class="literal">SelectorConfig</code> class (see
    <code class="literal">AllMovesOfOneExamSelectorConfig</code>) and configure it in the configuration XML:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">selector</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">class</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;org.drools.planner.examples.examination.solver.selector.AllMovesOfOneExamSelectorConfig&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
</pre><p>If you build a better implementation that's not domain specific, consider adding it as a patch in our issue
    tracker and we'll take it along in future refactors and optimize it.</p></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e2459"/>Chapter 6. Benchmarking and tweaking</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#d0e2462">6.1. Finding the best configuration</a></span></dt><dt><span class="section"><a href="#d0e2469">6.2. Building a Benchmarker</a></span></dt><dt><span class="section"><a href="#d0e2513">6.3. Best score over time statistic (graph and CSV)</a></span></dt></dl></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e2462"/>6.1. Finding the best configuration</h2></div></div></div><p>Drools Planner supports several solver types, but you're probably wondering which is the best one? Although
    some solver types generally perform better then others, it really depends on your problem domain. Most solver types
    also have settings which can be tweaked. Those settings can influence the results of a solver a lot, although most
    settings perform pretty good out-of-the-box.</p><p>Luckily, Drools Planner includes a benchmarker, which allows you to play out different solver types and
    different settings against each other, so you can pick the best configuration for your problem domain.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e2469"/>6.2. Building a Benchmarker</h2></div></div></div><p>You can build a <code class="literal">Benchmarker</code> instance with the<code class="literal">XmlSolverBenchmarker</code>.
    Configure it with a benchmarker configuration xml file:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><!-- <br/> --><span class="java_type">XmlSolverBenchmarker</span><!-- <br/> --><span class="java_plain">&nbsp;benchmarker&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">new</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">XmlSolverBenchmarker</span><!-- <br/> --><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;benchmarker</span><span class="java_separator">.</span><span class="java_plain">configure</span><span class="java_separator">(</span><span class="java_literal">&quot;/org/drools/planner/examples/nqueens/benchmark/nqueensSolverBenchmarkConfig.xml&quot;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;benchmarker</span><span class="java_separator">.</span><span class="java_plain">benchmark</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;benchmarker</span><span class="java_separator">.</span><span class="java_plain">writeResults</span><span class="java_separator">(</span><span class="java_plain">resultFile</span><span class="java_separator">);</span></pre><p>A basic benchmarker configuration file looks something like this:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_processing_instruction">&lt;?xml&nbsp;version=&quot;1.0&quot;&nbsp;encoding=&quot;UTF-8&quot;?&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">solverBenchmarkSuite</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">benchmarkDirectory</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">local/data/nqueens</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">benchmarkDirectory</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">inheritedUnsolvedSolutionFile</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">data/nqueens/unsolved/unsolvedNQueens32.xml</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">inheritedUnsolvedSolutionFile</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">inheritedUnsolvedSolutionFile</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">data/nqueens/unsolved/unsolvedNQueens64.xml</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">inheritedUnsolvedSolutionFile</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">inheritedLocalSearchSolver</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">scoreDrl</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">/org/drools/planner/examples/nqueens/solver/nQueensScoreRules.drl</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">scoreDrl</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">scoreDefinition</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">scoreDefinitionType</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">SIMPLE</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">scoreDefinitionType</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">scoreDefinition</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">termination</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">maximumSecondsSpend</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">20</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">maximumSecondsSpend</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">termination</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">selector</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">moveFactoryClass</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.drools.planner.examples.nqueens.solver.move.factory.NQueensMoveFactory</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">moveFactoryClass</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">selector</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">forager</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">pickEarlyType</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">NEVER</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">pickEarlyType</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">forager</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">inheritedLocalSearchSolver</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">solverBenchmark</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">name</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">Solution&nbsp;tabu</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">name</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">localSearchSolver</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">acceptor</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">completeSolutionTabuSize</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">1000</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">completeSolutionTabuSize</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">acceptor</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">localSearchSolver</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">solverBenchmark</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">solverBenchmark</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">name</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">Move&nbsp;tabu&nbsp;5</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">name</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">localSearchSolver</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">acceptor</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">completeMoveTabuSize</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">5</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">completeMoveTabuSize</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">acceptor</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">localSearchSolver</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">solverBenchmark</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">solverBenchmark</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">name</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">Move&nbsp;tabu&nbsp;7</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">name</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">localSearchSolver</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">acceptor</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">completeMoveTabuSize</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">7</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">completeMoveTabuSize</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">acceptor</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">localSearchSolver</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">solverBenchmark</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">solverBenchmark</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">name</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">Solution&nbsp;tabu&nbsp;and&nbsp;move&nbsp;tabu&nbsp;7</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">name</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">localSearchSolver</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">acceptor</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">completeSolutionTabuSize</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">1000</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">completeSolutionTabuSize</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">completeMoveTabuSize</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">7</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">completeMoveTabuSize</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">acceptor</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">localSearchSolver</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">solverBenchmark</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">solverBenchmarkSuite</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre><p>This benchmarker will try 4 configurations (1 solution tabu, 2 move tabu's and 1 solution-move tabu) on 2 data
    sets (32 and 64 queens), so it will run 8 solvers.</p><p>Every <code class="literal">solverBenchmark</code> entity contains a solver configuration (for example a local search
    solver) and one or more <code class="literal">unsolvedSolutionFile</code> entities. It will run the solver configuration on
    each of those unsolved solution files. A <code class="literal">name</code> is optional and generated if absent. The common
    part of multiple <code class="literal">solverBenchmark</code> entities can be extracted to the <code class="literal">inherited</code>
    entities and can be overwritten per <code class="literal">solverBenchmark</code> entity.</p><p>You need to specify a <code class="literal">benchmarkDirectory</code> (relative to the working directory).
    A summary statistic and the best solution of each solver run will be written in that directory.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e2513"/>6.3. Best score over time statistic (graph and CSV)</h2></div></div></div><p>The benchmarker supports outputting the best score over time statistic as a graph and a CSV (comma separated
    values) file. Here's an example of a graph:</p><div class="figure"><a id="d0e2518"/><div class="figure-contents"><div class="mediaobject"><img src="images/Chapter-Benchmarking_and_tweaking/bestScoreOverTimeGraph.png" alt="Best score over time statistic"/></div></div><p class="title"><b>Figure 6.1. Best score over time statistic</b></p></div><br class="figure-break"/><p>To configure graph and CSV output of the best score over time, just add a
    <code class="literal">solverStatisticType</code> line:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">solverBenchmarkSuite</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">benchmarkDirectory</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">local/data/nqueens/solved</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">benchmarkDirectory</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">solverStatisticType</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">BEST_SOLUTION_CHANGED</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">solverStatisticType</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;...</span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">solverBenchmarkSuite</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre><p>It will output all graphs and CSV files in the <code class="literal">benchmarkDirectory</code>.</p></div></div><div class="index"><div class="titlepage"><div><div><h2 class="title"><a id="d0e2536"/>Index</h2></div></div></div><div class="index"/></div></div></body></html>