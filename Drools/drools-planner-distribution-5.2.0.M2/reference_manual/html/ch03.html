<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory">Chapter 3. Planner configuration</title><link rel="stylesheet" href="css/jbossorg.css" type="text/css"/><meta xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" name="generator" content="DocBook XSL-NS Stylesheets V1.74.0"/><link rel="home" href="index.html" title="Drools Planner User Guide"/><link rel="up" href="index.html" title="Drools Planner User Guide"/><link rel="prev" href="ch02.html" title="Chapter 2. Use cases and examples"/><link rel="next" href="ch04.html" title="Chapter 4. Score calculation with a rule engine"/></head><body><p xmlns:d="http://docbook.org/ns/docbook" id="title"><a href="http://www.jboss.org" class="site_href"><strong>JBoss.org</strong></a><a href="http://docs.jboss.org/" class="doc_href"><strong>Community Documentation</strong></a></p><ul xmlns:d="http://docbook.org/ns/docbook" class="docnav"><li class="previous"><a accesskey="p" href="ch02.html"><strong>Prev</strong></a></li><li class="next"><a accesskey="n" href="ch04.html"><strong>Next</strong></a></li></ul><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e1069"/>Chapter 3. Planner configuration</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="ch03.html#d0e1072">3.1. Types of solvers</a></span></dt><dd><dl><dt><span class="section"><a href="ch03.html#d0e1077">3.1.1. Brute force</a></span></dt><dt><span class="section"><a href="ch03.html#d0e1099">3.1.2. Branch and bound</a></span></dt><dt><span class="section"><a href="ch03.html#d0e1121">3.1.3. Simplex</a></span></dt><dt><span class="section"><a href="ch03.html#d0e1140">3.1.4. Genetic algorithms</a></span></dt><dt><span class="section"><a href="ch03.html#d0e1163">3.1.5. Local search (tabu search, simulated annealing, ...)</a></span></dt></dl></dd><dt><span class="section"><a href="ch03.html#d0e1195">3.2. The size of real world problems</a></span></dt><dt><span class="section"><a href="ch03.html#d0e1207">3.3. The Solver interface</a></span></dt><dt><span class="section"><a href="ch03.html#d0e1242">3.4. Building a Solver</a></span></dt><dd><dl><dt><span class="section"><a href="ch03.html#d0e1265">3.4.1. Environment mode</a></span></dt></dl></dd><dt><span class="section"><a href="ch03.html#d0e1312">3.5. The Solution interface</a></span></dt><dd><dl><dt><span class="section"><a href="ch03.html#d0e1336">3.5.1. The getScore and setScore methods</a></span></dt><dt><span class="section"><a href="ch03.html#d0e1363">3.5.2. The getFacts method</a></span></dt><dt><span class="section"><a href="ch03.html#d0e1379">3.5.3. The cloneSolution method</a></span></dt></dl></dd><dt><span class="section"><a href="ch03.html#d0e1405">3.6. The starting solution</a></span></dt><dd><dl><dt><span class="section"><a href="ch03.html#d0e1412">3.6.1. A simple filler algorithm</a></span></dt><dt><span class="section"><a href="ch03.html#d0e1429">3.6.2. StartingSolutionInitializer</a></span></dt></dl></dd><dt><span class="section"><a href="ch03.html#d0e1471">3.7. Solving a problem</a></span></dt></dl></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e1072"/>3.1. Types of solvers</h2></div></div></div><p>Different solvers solve problems in different ways. Each type has advantages and disadvantages. We 'll roughly
    discuss a few of the solver types here. You can safely skip this section.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e1077"/>3.1.1. Brute force</h3></div></div></div><p>Brute force creates and evaluates every possible solution, usually by creating a search tree.</p><p>Advantages:</p><div class="itemizedlist"><ul><li><p>It knows when it has found an optimal solution. If there is more then 1 optimal solution, it finds all
          optimal solutions.</p></li><li><p>It is straightforward and simple to implement.</p></li></ul></div><p>Disadvantages:</p><div class="itemizedlist"><ul><li><p>It performs and scales horribly. Mostly unusable for a real-world problem due to time
          limitations.</p></li></ul></div><p>Brute force is currently not implemented in Drools Planner. But we have plans to implement it in the future,
      as a reference for validating the output of the other solver types.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e1099"/>3.1.2. Branch and bound</h3></div></div></div><p>Branch and bound is an improvement over brute force, as it prunes away subsets of solutions which cannot
      have a better solution than the best solution already found at that point.</p><p>Advantages:</p><div class="itemizedlist"><ul><li><p>It knows when it has found an optimal solution. If there is more then 1 optimal solution, it can find
          all optimal solutions if needed.</p></li><li><p>It can determine the bounds of a problem, which gives an indication of the quality of a solution.</p></li></ul></div><p>Disadvantages:</p><div class="itemizedlist"><ul><li><p>It still scales very badly. Mostly unusable for a real-world problem due to time limitations.</p></li></ul></div><p>Branch and bound is currently not implemented in Drools Planner. But we have plans to implement it in the
      future, as a reference for validating the output of the other solver types.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e1121"/>3.1.3. Simplex</h3></div></div></div><p>Simplex is an algorithm to find the numerical solution of a linear programming problem.</p><p>Advantages:</p><div class="itemizedlist"><ul><li><p>It knows when it has found an optimal solution.</p></li></ul></div><p>Disadvantages:</p><div class="itemizedlist"><ul><li><p>It's complex and mathematical to implement constraints.</p></li></ul></div><p>Drools Planner does not implement simplex.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e1140"/>3.1.4. Genetic algorithms</h3></div></div></div><p>Advantages:</p><div class="itemizedlist"><ul><li><p>It's scalable.</p></li><li><p>Given a limited time, it can still deliver a pretty decent solution.</p></li></ul></div><p>Disadvantages:</p><div class="itemizedlist"><ul><li><p>It does not know when it has found an optimal solution.</p></li><li><p>If the optimal score is unknown (which is usually the case), it must be told when to stop looking (for
          example based on time spend, user input, ...).</p></li></ul></div><p>The genetic algorithm is currently not implemented in Drools Planner.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e1163"/>3.1.5. Local search (tabu search, simulated annealing, ...)</h3></div></div></div><p>Local search starts from an initial solution and evolves that single solution into a mostly better and
      better solution. It uses a single search path of solutions, not a search tree. At each solution in this path it
      evaluates a number of moves on the solution and applies the most suitable move to take the step to the next
      solution.</p><p>Local search works a lot like a human planner: it uses a single search path and moves facts around to find a
      good feasible solution.</p><p>A simple local search can easily get stuck in a local optima, but improvements (such as tabu search and
      simulated annealing) address this problem.</p><p>Advantages:</p><div class="itemizedlist"><ul><li><p>It's relatively simple and natural to implement constraints (at least in Drools Planner's
          implementation).</p></li><li><p>It's very scalable, even when adding extra constraints (at least in Drools Planner's
          implementation).</p></li><li><p>Given a limited time, it can still deliver a pretty decent solution.</p></li></ul></div><p>Disadvantages:</p><div class="itemizedlist"><ul><li><p>It does not know when it has found an optimal solution.</p></li><li><p>If the optimal score is unknown (which is usually the case), it must be told when to stop looking (for
          example based on time spend, user input, ...).</p></li></ul></div><p>Drools Planner implements local search, including tabu search and simulated annealing.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e1195"/>3.2. The size of real world problems</h2></div></div></div><p>As a planning problem gets bigger, the search space tends to blow up really fast. It's not uncommon to see
    that it's possible to optimally plan 5 people in less then a second, while planning 6 people optimally would take
    years. Take a look at the problem size of the examples: many instances have a lot more possible solutions than the
    minimal number of atoms in the known universe (10^80).</p><p>The cold, hard reality is that <span class="bold"><strong>for most real-world planning problems we will not find
    the optimal solution in our lifetimes.</strong></span> But that's OK, as long as we improve upon the solutions created by
    human planners (which is easy) or other systems.</p><p>Planning competitions (such as the International Timetabling Competition) show that local search variations
    (tabu search, simulated annealing, ...) usually perform best for real-world problems given real-world time
    limitations.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e1207"/>3.3. The Solver interface</h2></div></div></div><p>Solving a planning problem with Drools Planner consists out of 4 steps:</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>Build a solver, for example a tabu search solver for any NQueens puzzle.</p></li><li><p>Set a starting solution on the solver, for example a 4 Queens puzzle instance.</p></li><li><p>Solve it.</p></li><li><p>Get the best solution found by the solver.</p></li></ol></div><p>Every build-in solver implemented in Drools Planner implements the <code class="literal">Solver</code> interface:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">interface</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Solver</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setStartingSolution</span><span class="java_separator">(</span><span class="java_type">Solution</span><span class="java_plain">&nbsp;solution</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Solution</span><span class="java_plain">&nbsp;getBestSolution</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;solve</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;</span><span class="java_separator">...</span>
</span>
<!--  --><br/><span class="java_separator">}</span></pre><p>There is normally no need to implement the <code class="literal">Solver</code> interface yourself.</p><p>A <code class="literal">Solver</code> should only be accessed from a single thread, except for the methods that are
    specifically javadocced as thread-safe.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e1242"/>3.4. Building a Solver</h2></div></div></div><p>You can build a <code class="literal">Solver</code> instance with the <code class="literal">XmlSolverConfigurer</code>. Configure
    it with a solver configuration XML file:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><!-- <br/> --><span class="java_type">XmlSolverConfigurer</span><!-- <br/> --><span class="java_plain">&nbsp;configurer&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">new</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">XmlSolverConfigurer</span><!-- <br/> --><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;configurer</span><span class="java_separator">.</span><span class="java_plain">configure</span><span class="java_separator">(</span><span class="java_literal">&quot;/org/drools/planner/examples/nqueens/solver/nqueensSolverConfig.xml&quot;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Solver</span><span class="java_plain">&nbsp;solver&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;configurer</span><span class="java_separator">.</span><span class="java_plain">buildSolver</span><span class="java_separator">();</span></pre><p>A basic solver configuration file looks something like this:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_processing_instruction">&lt;?xml&nbsp;version=&quot;1.0&quot;&nbsp;encoding=&quot;UTF-8&quot;?&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">localSearchSolver</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">scoreDrl</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">/org/drools/planner/examples/nqueens/solver/nQueensScoreRules.drl</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">scoreDrl</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">scoreDefinition</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">scoreDefinitionType</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">SIMPLE</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">scoreDefinitionType</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">scoreDefinition</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">termination</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">scoreAttained</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">0</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">scoreAttained</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">termination</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">selector</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">moveFactoryClass</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.drools.planner.examples.nqueens.solver.NQueensMoveFactory</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">moveFactoryClass</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">selector</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">acceptor</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">completeSolutionTabuSize</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">1000</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">completeSolutionTabuSize</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">acceptor</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">forager</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">pickEarlyType</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">NEVER</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">pickEarlyType</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">forager</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">localSearchSolver</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre><p>This is a tabu search configuration for n queens. We 'll explain the various parts of a configuration later in
    this manual.</p><p><span class="bold"><strong>Drools Planner makes it relatively easy to switch a solver type just by changing the
    configuration.</strong></span> There's even a benchmark utility which allows you to play out different configurations
    against each other and report the most appropriate configuration for your problem. You could for example play out
    tabu search versus simulated annealing, on 4 queens and 64 queens.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e1265"/>3.4.1. Environment mode</h3></div></div></div><p>A solver has a single <code class="literal">Random</code> instance. Some solver configurations use the
      <code class="literal">Random</code> instance a lot more than others. For example simulated annealing depends highly on
      random numbers, while tabu search only depends on it to deal with score ties. The environment mode influences the
      seed of that <code class="literal">Random</code> instance.</p><p>The environment mode also allows you to detect common bugs in your implementation.</p><p>You can set the environment mode in the solver configuration XML file:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">localSearchSolver</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">environmentMode</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">DEBUG</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">environmentMode</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;...</span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">localSearchSolver</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre><p>There are 3 environment modes:</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e1287"/>3.4.1.1. DEBUG</h4></div></div></div><p>The debug mode is reproducible (see the reproducible mode) and also turns on assertions (such as assert
        that the undo Move is uncorrupted) to fail-fast on a bug in your Move implementation, your score rule,
        ...</p><p>The debug mode is slow.</p><p>It's recommended to write a test case which does a short run of your planning problem with debug mode
        on.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e1296"/>3.4.1.2. REPRODUCIBLE (default)</h4></div></div></div><p>The reproducible mode is the default mode because it is recommended during development. In this mode, 2
        runs on the same computer will execute the same code in the same order. They will also yield the same result,
        except if they use a time based termination and they have a sufficiently large difference in allocated CPU time.
        This allows you to benchmark new optimizations (such as a new move implementation or a different
        minimalAcceptedSelection setting) fairly.</p><p>The reproducible mode is not much slower than the production mode.</p><p>In practice, this mode uses the default random seed, and it also disables certain concurrency
        optimizations (such as work stealing).</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e1305"/>3.4.1.3. PRODUCTION</h4></div></div></div><p>The production mode is the fastest and the most robust, but not reproducible. It is recommended for a
        production environment.</p><p>The random seed is different on every run, which makes it more robust against an unlucky random seed. An
        unlucky random seed gives a bad result on a certain data set with a certain solver configuration. Note that in
        most use cases the impact of the random seed is relatively low on the result (even with simulated annealing). An
        occasional bad result is far more likely caused by another issue (such as a score trap).</p></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e1312"/>3.5. The Solution interface</h2></div></div></div><p>A Solver can only solve 1 problem instance at a time.</p><p>You need to present the problem as a starting <code class="literal">Solution</code> instance to the solver.</p><p>You need to implement the <code class="literal">Solution</code> interface:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">interface</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Solution</span><!-- <br/> --><span class="java_operator">&lt;</span><!-- <br/> --><span class="java_plain">S&nbsp;</span><!-- <br/> --><span class="java_keyword">extends</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Score</span><!-- <br/> --><span class="java_operator">&gt;</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;S&nbsp;getScore</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setScore</span><span class="java_separator">(</span><span class="java_plain">S&nbsp;score</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Collection</span><span class="java_operator">&lt;?</span><span class="java_plain">&nbsp;</span><span class="java_keyword">extends</span><span class="java_plain">&nbsp;</span><span class="java_type">Object</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;getFacts</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Solution</span><span class="java_operator">&lt;</span><span class="java_plain">S</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;cloneSolution</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_separator">}</span></pre><p>For example, an <code class="literal">NQueens</code> instance just holds a list of all its queens:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">class</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">NQueens</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">implements</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Solution</span><!-- <br/> --><span class="java_operator">&lt;</span><!-- <br/> --><span class="java_type">SimpleScore</span><!-- <br/> --><span class="java_operator">&gt;</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">Queen</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;queenList</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;</span><span class="java_separator">...</span>
</span>
<!--  --><br/><span class="java_separator">}</span></pre><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e1336"/>3.5.1. The getScore and setScore methods</h3></div></div></div><p>A <code class="literal">Solution</code> requires a score property. The score property is null if the
      <code class="literal">Solution</code> is uninitialized or if the score has not yet been (re)calculated. The score property
      is usually typed to the specific <code class="literal">Score</code> implementation you use. For example,
      <code class="literal">NQueens</code> uses a <code class="literal">SimpleScore</code>:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><!-- <br/> --><span class="java_keyword">private</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">SimpleScore</span><!-- <br/> --><span class="java_plain">&nbsp;score</span><!-- <br/> --><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">SimpleScore</span><span class="java_plain">&nbsp;getScore</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;score</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setScore</span><span class="java_separator">(</span><span class="java_type">SimpleScore</span><span class="java_plain">&nbsp;score</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">score&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;score</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span></pre><p>Most use cases use a <code class="literal">HardAndSoftScore</code> instead.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e1363"/>3.5.2. The getFacts method</h3></div></div></div><p>All objects returned by the <code class="literal">getFacts()</code> method will be asserted into the drools working
      memory. Those facts can be used by the score rules. For example, <code class="literal">NQueens</code> just returns all
      <code class="literal">Queen</code> instances.</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Collection</span><!-- <br/> --><span class="java_operator">&lt;?</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">extends</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Object</span><!-- <br/> --><span class="java_operator">&gt;</span><!-- <br/> --><span class="java_plain">&nbsp;getFacts</span><!-- <br/> --><span class="java_separator">()</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;queenList</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span></pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e1379"/>3.5.3. The cloneSolution method</h3></div></div></div><p>Most solvers use the <code class="literal">cloneSolution()</code> method to clone the solution each time they
      encounter a new best solution. The <code class="literal">NQueens</code> implementation just clones all
      <code class="literal">Queen</code> instances:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">NQueens</span><!-- <br/> --><span class="java_plain">&nbsp;cloneSolution</span><!-- <br/> --><span class="java_separator">()</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">NQueens</span><span class="java_plain">&nbsp;clone&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">NQueens</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">Queen</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;clonedQueenList&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">ArrayList</span><span class="java_operator">&lt;</span><span class="java_type">Queen</span><span class="java_operator">&gt;</span><span class="java_separator">(</span><span class="java_plain">queenList</span><span class="java_separator">.</span><span class="java_plain">size</span><span class="java_separator">());</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">for</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">Queen</span><span class="java_plain">&nbsp;queen&nbsp;</span><span class="java_operator">:</span><span class="java_plain">&nbsp;queenList</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;clonedQueenList</span><span class="java_separator">.</span><span class="java_plain">add</span><span class="java_separator">(</span><span class="java_plain">queen</span><span class="java_separator">.</span><span class="java_plain">clone</span><span class="java_separator">());</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;clone</span><span class="java_separator">.</span><span class="java_plain">queenList&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;clonedQueenList</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;clone</span><span class="java_separator">.</span><span class="java_plain">score&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;score</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;clone</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span></pre><p>The <code class="literal">cloneSolution()</code> method should clone no more and no less than the parts of the
      <code class="literal">Solution</code> that can change during planning. For example, in the curriculum course schedule
      example the lectures are cloned, but teachers, courses, timeslots, periods, rooms, ... are not cloned because only
      a lecture's appointed period or room changes during solving:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><!-- <br/> --><span class="java_javadoc_comment">/**</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Clone&nbsp;will&nbsp;only&nbsp;deep&nbsp;copy&nbsp;the&nbsp;{</span><span class="java_javadoc_tag">@link</span><span class="java_javadoc_comment">&nbsp;#lectureList}.</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">CurriculumCourseSchedule</span><span class="java_plain">&nbsp;cloneSolution</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">CurriculumCourseSchedule</span><span class="java_plain">&nbsp;clone&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">CurriculumCourseSchedule</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;clone</span><span class="java_separator">.</span><span class="java_plain">teacherList&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;teacherList</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;clone</span><span class="java_separator">.</span><span class="java_plain">curriculumList&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;curriculumList</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;clone</span><span class="java_separator">.</span><span class="java_plain">courseList&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;courseList</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;clone</span><span class="java_separator">.</span><span class="java_plain">dayList&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;dayList</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;clone</span><span class="java_separator">.</span><span class="java_plain">timeslotList&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;timeslotList</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;clone</span><span class="java_separator">.</span><span class="java_plain">periodList&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;periodList</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;clone</span><span class="java_separator">.</span><span class="java_plain">roomList&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;roomList</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;clone</span><span class="java_separator">.</span><span class="java_plain">unavailablePeriodConstraintList&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;unavailablePeriodConstraintList</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">Lecture</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;clonedLectureList&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">ArrayList</span><span class="java_operator">&lt;</span><span class="java_type">Lecture</span><span class="java_operator">&gt;</span><span class="java_separator">(</span><span class="java_plain">lectureList</span><span class="java_separator">.</span><span class="java_plain">size</span><span class="java_separator">());</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">for</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">Lecture</span><span class="java_plain">&nbsp;lecture&nbsp;</span><span class="java_operator">:</span><span class="java_plain">&nbsp;lectureList</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Lecture</span><span class="java_plain">&nbsp;clonedLecture&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;lecture</span><span class="java_separator">.</span><span class="java_plain">clone</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;clonedLectureList</span><span class="java_separator">.</span><span class="java_plain">add</span><span class="java_separator">(</span><span class="java_plain">clonedLecture</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;clone</span><span class="java_separator">.</span><span class="java_plain">lectureList&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;clonedLectureList</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;clone</span><span class="java_separator">.</span><span class="java_plain">score&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;score</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;clone</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span></pre></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e1405"/>3.6. The starting solution</h2></div></div></div><p>First, you will need to make a starting solution and set that on the solver:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">solver</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">setStartingSolution</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">startingSolution</span><!-- <br/> --><span class="java_separator">);</span></pre><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e1412"/>3.6.1. A simple filler algorithm</h3></div></div></div><p>For 4 queens we use a simple filler algorithm that creates a starting solution with all queens on a
      different x and on the same y (with y = 0).</p><div class="figure"><a id="d0e1417"/><div class="figure-contents"><div class="mediaobject"><img src="images/Chapter-Planner_configuration/unsolvedNQueens04.png" alt="Starting solution for the 4 queens puzzle"/></div></div><p class="title"><b>Figure 3.1. Starting solution for the 4 queens puzzle</b></p></div><br class="figure-break"/><p>Here's how we generate it:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><!-- <br/> --><span class="java_keyword">private</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">NQueens</span><!-- <br/> --><span class="java_plain">&nbsp;createNQueens</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_type">int</span><!-- <br/> --><span class="java_plain">&nbsp;n</span><!-- <br/> --><span class="java_separator">)</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">NQueens</span><span class="java_plain">&nbsp;nQueens&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">NQueens</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nQueens</span><span class="java_separator">.</span><span class="java_plain">setId</span><span class="java_separator">(</span><span class="java_literal">0L</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">Queen</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;queenList&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">ArrayList</span><span class="java_operator">&lt;</span><span class="java_type">Queen</span><span class="java_operator">&gt;</span><span class="java_separator">(</span><span class="java_plain">n</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">for</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">int</span><span class="java_plain">&nbsp;i&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">0</span><span class="java_separator">;</span><span class="java_plain">&nbsp;i&nbsp;</span><span class="java_operator">&lt;</span><span class="java_plain">&nbsp;n</span><span class="java_separator">;</span><span class="java_plain">&nbsp;i</span><span class="java_operator">++</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Queen</span><span class="java_plain">&nbsp;queen&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">Queen</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;queen</span><span class="java_separator">.</span><span class="java_plain">setId</span><span class="java_separator">((</span><span class="java_type">long</span><span class="java_separator">)</span><span class="java_plain">&nbsp;i</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;queen</span><span class="java_separator">.</span><span class="java_plain">setX</span><span class="java_separator">(</span><span class="java_plain">i</span><span class="java_separator">);</span><span class="java_plain">&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;</span><span class="java_type">Different</span><span class="java_plain">&nbsp;column</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;queen</span><span class="java_separator">.</span><span class="java_plain">setY</span><span class="java_separator">(</span><span class="java_literal">0</span><span class="java_separator">);</span><span class="java_plain">&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;</span><span class="java_type">Same</span><span class="java_plain">&nbsp;row</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;queenList</span><span class="java_separator">.</span><span class="java_plain">add</span><span class="java_separator">(</span><span class="java_plain">queen</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nQueens</span><span class="java_separator">.</span><span class="java_plain">setQueenList</span><span class="java_separator">(</span><span class="java_plain">queenList</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;nQueens</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span></pre><p>The starting solution will probably be far from optimal (or even feasible). Here, it's actually the worst
      possible solution. However, we 'll let the solver find a much better solution for us anyway.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e1429"/>3.6.2. StartingSolutionInitializer</h3></div></div></div><p>For large problems, a simple filler algorithm like <code class="literal">createNQueens(int)</code> doesn't suffice. A
      (local search) solver starting from a bad starting solution wastes a lot of time to reach a solution which an
      initializer algorithm can generate in a fraction of that time.</p><p>An initializer algorithm usually works something like this:</p><div class="itemizedlist"><ul><li><p>It sorts the unplanned elements in a queue according to some general rules, for example by exam student
          size.</p></li><li><p>Next, it plans them in the order they come from the queue. Each element is put the best, still available
          spot.</p></li><li><p>It doesn't change an already planned element. It exits when the queue is empty and all elements are
          planned.</p></li></ul></div><p>Such an algorithm is very deterministic: it's really fast, but you can't give it more time to generate an
      even better solution. In some cases the solution it generates will be feasible, but in most cases it won't. You
      'll need a real solver to get to a feasible or more optimal solution. Nevertheless you 'll want to such an
      initializer to give the real solver a serious head start. You can do this by implementing the
      <code class="literal">StartingSolutionInitializer</code> interface:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">interface</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">StartingSolutionInitializer</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">extends</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">SolverAware</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">boolean</span><span class="java_plain">&nbsp;isSolutionInitialized</span><span class="java_separator">(</span><span class="java_type">Solution</span><span class="java_plain">&nbsp;solution</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;initializeSolution</span><span class="java_separator">(</span><span class="java_type">Solution</span><span class="java_plain">&nbsp;solution</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_separator">}</span></pre><p>You'll need to set a (uninitialized) solution on the solver. Once the solver starts, it will first call the
      <code class="literal">StartingSolutionInitializer</code> to initialize the solution. If the
      <code class="literal">StartingSolutionInitializer</code> adds, edits or removes facts it needs to notify the workingMemory
      about this. It can use score calculation during its initialization process.</p><p>Here's an example on how you add the <code class="literal">StartingSolutionInitializer</code> to the
      configuration:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">localSearchSolver</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;...</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">startingSolutionInitializerClass</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.drools.planner.examples.examination.solver.solution.initializer.ExaminationStartingSolutionInitializer</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">startingSolutionInitializerClass</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;...</span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">localSearchSolver</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e1471"/>3.7. Solving a problem</h2></div></div></div><p>Solving a problem is quite easy once you have a solver and the starting solution:</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;solver</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">setStartingSolution</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">startingSolution</span><!-- <br/> --><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;solver</span><span class="java_separator">.</span><span class="java_plain">solve</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Solution</span><span class="java_plain">&nbsp;bestSolution&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;solver</span><span class="java_separator">.</span><span class="java_plain">getBestSolution</span><span class="java_separator">();</span></pre><p>The <code class="literal">solve()</code> method will take a long time (depending on the problem size and the solver
    configuration). The solver will remember (actually clone) the best solution it encounters during its solving.
    Depending on a number factors (including problem size, how long you allow the solver to work, which solver type you
    use, ...), that best solution will be a feasible or even an optimal solution.</p><div class="figure"><a id="d0e1483"/><div class="figure-contents"><div class="mediaobject"><img src="images/Chapter-Planner_configuration/solvedNQueens04.png" alt="Best solution for the 4 queens puzzle (also an optimal solution)"/></div></div><p class="title"><b>Figure 3.2. Best solution for the 4 queens puzzle (also an optimal solution)</b></p></div><br class="figure-break"/><p>After a problem is solved, you can reuse the same solver instance to solve another problem (of the same
    problem type).</p></div></div><ul xmlns:d="http://docbook.org/ns/docbook" class="docnav"><li class="previous"><a accesskey="p" href="ch02.html"><strong>Prev</strong>Chapter 2. Use cases and examples</a></li><li class="up"><a accesskey="u" href="#"><strong>Top of page</strong></a></li><li class="home"><a accesskey="h" href="index.html"><strong>Front page</strong></a></li><li class="next"><a accesskey="n" href="ch04.html"><strong>Next</strong>Chapter 4. Score calculation with a rule engine</a></li></ul></body></html>